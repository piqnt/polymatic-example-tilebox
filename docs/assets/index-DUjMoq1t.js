(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=e(r);fetch(r.href,s)}})();/**
 * Polymatic v0.0.12
 * @copyright Copyright 2026 Ali Shakiba
 * @license Licensed under the MIT (https://github.com/piqnt/polymatic/blob/main/LICENSE.md)
 */function getOption(i){try{const t=localStorage.getItem(i);if(t)return t}catch{}try{const t=sessionStorage.getItem(i);if(t)return t}catch{}}function isEnabled(i,t){let e=getOption(i+"_exclude"),n=getOption(i+"_include");try{if(e&&t.match(e))return!1}catch(r){console.log(r)}try{if(n&&t.match(n))return!0}catch(r){console.log(r)}return!1}function debug(i,t){const e=isEnabled("debug",i),n=isEnabled("trace",i);return e?(...r)=>{t&&!t(...r)||(console.log(i,...r),n&&console.trace())}:()=>{}}function watch(i,t){const e=isEnabled("watch",i),n=isEnabled("trace",i);return e?new Proxy(t,{set(r,s,o,a){return console.debug(i,".",s.toString(),r[s],"↬",o),n&&console.trace(),Reflect.set(r,s,o,a)}}):t}const debugEvent=debug("middleware.event",i=>!(i!=null&&i.endsWith("-move")||i==="hotsyncWorld")),debugMiddleware=debug("middleware.lifecycle");class Middleware{constructor(){this.__handlers={},this.__children=[],this.__parent=null,this._swap=t=>{const e=this.__children,n=[],r=[];for(const s of t)e.indexOf(s)===-1&&r.push(s);for(const s of e)t.indexOf(s)===-1&&n.push(s);this.__children=t;for(const s of n)s.__detach();for(const s of r)s.__attach(this)}}get activated(){return this.__parent&&this.__parent.activated}use(t){this.__children.indexOf(t)===-1&&(this.activated&&t.__attach(this),this.__children.push(t))}unuse(t){const e=this.__children.indexOf(t);e!==-1&&(this.__children.splice(e,1),t==null||t.__detach())}__attach(t){if(!this.__parent){this.__parent=t,debugMiddleware("activate","+",this.constructor.name),this._handle("activate");for(let e=0;e<this.__children.length;e++)this.__children[e].__attach(this)}}__detach(){if(this.__parent){debugMiddleware("deactivate","-",this.constructor.name),this._handle("deactivate");for(let t=0;t<this.__children.length;t++)this.__children[t].__detach();this.__parent=null}}get context(){return this.__parent?this.__parent.context:null}setContext(t){this.__parent?this.__parent.setContext(t):console.error("Middleware is not activated")}on(t,e){if(this.__handlers[t])throw Error(`Handler for ${t} already exists`);this.__handlers[t]=e}_consume(t,e){if(this._handle(t,e))return!0;for(let r=0;r<this.__children.length;r++)if(this.__children[r]._consume(t,e))return!0;return!1}_handle(t,e){if(!this.activated)return;const n=this.__handlers&&this.__handlers[t];return!!(n&&typeof n=="function"&&(debugEvent(t,"→",this.constructor.name,e),n.call(this,e)===!0))}emit(t,e){this.activated&&(debugEvent(t,"↑",this.constructor.name,e),this.__parent?this.__parent.emit(t,e):console.error(Error("Not active!")))}static activate(t,e){return Runtime.activate(t,e)}}class Runtime extends Middleware{constructor(){super(...arguments),this.__handlers={},this.__children=[],this._activated=!1,this.contextUpdateEmit=()=>{this.emit("context-change")}}get activated(){return this._activated}_activate(t){if(!this._activated){t=watch("middleware.context",t),this._context=t,this._activated=!0,this._handle("activate");for(let e=0;e<this.__children.length;e++)this.__children[e].__attach(this)}}_deactivate(){if(this._activated){this._activated=!1,this._handle("deactivate");for(let t=0;t<this.__children.length;t++)this.__children[t].__detach()}}get context(){return this._context}setContext(t){if(typeof t!="function"){console.error("Setter is not a function: ",t);return}t(this.context),clearTimeout(this.contextUpdateEmitTimeout),this.contextUpdateEmitTimeout=setTimeout(this.contextUpdateEmit)}emit(t,e){setTimeout(()=>{this._consume(t,e)})}static activate(t,e){const n=new Runtime;n.use(t),n._activate(e)}static deactivate(t){if("_deactivate"in t&&typeof t._deactivate=="function")return t._deactivate(),!0;const e=t.__parent;return e&&"_deactivate"in e&&typeof e._deactivate=="function"?(e._deactivate(),!0):!1}}class Driver{constructor(){this._componentsById={}}static create(t){return new class extends Driver{constructor(){super(...arguments),this.filter=t.filter,this.enter=t.enter,this.exit=t.exit,this.update=t.update}}}ref(t){return this._componentsById[t]}}class Binder{constructor(){this._drivers=[],this._map={},this._mapBuffer={},this._updateBuffer=[],this._enterBuffer=[],this._exitBuffer=[]}static create(t){return new class extends Binder{constructor(){super(...arguments),this.key=t.key,this._drivers=t.drivers?[...t.drivers]:[]}}}addDriver(t){if(!(t&&t.filter&&t.enter&&t.exit&&t.update))throw"Invalid driver: "+t;return this._drivers.push(t),this}data(t){if(!Array.isArray(t))throw"Invalid data: "+t;this._enterBuffer.length=0,this._exitBuffer.length=0,this._updateBuffer.length=t.length;for(let n=0;n<t.length;n++){const r=t[n];if(typeof r!="object"||r===null)continue;const s=this.key(r);this._map[s]?delete this._map[s]:this._enterBuffer.push(r),this._updateBuffer[n]=r,this._mapBuffer[s]=r}for(const n in this._map)this._exitBuffer.push(this._map[n]),delete this._map[n];const e=this._map;this._map=this._mapBuffer,this._mapBuffer=e;for(let n=0;n<this._exitBuffer.length;n++){const r=this._exitBuffer[n],s=this.key(r);for(const o of this._drivers){if(o.filter(r)){const a=o._componentsById[s];o.exit(r,a)}delete o._componentsById[s]}}for(let n=0;n<this._enterBuffer.length;n++){const r=this._enterBuffer[n],s=this.key(r);for(const o of this._drivers)if(o.filter(r)){const a=o.enter(r);a&&(o._componentsById[s]=a)}}for(let n=0;n<this._updateBuffer.length;n++){if(typeof t[n]!="object"||t[n]===null)continue;const r=this._updateBuffer[n],s=this.key(r);for(const o of this._drivers)if(o.filter(r)){const a=o._componentsById[s];o.update(r,a)}}this._enterBuffer.length=0,this._exitBuffer.length=0,this._updateBuffer.length=0}}class Memo{constructor(){this.memory=[]}static init(...t){const e=new Memo;return t.length&&e.update(...t),e}update(...t){let e=this.memory.length===t.length;for(let n=0;n<t.length;n++)e=e&&this.memory[n]===t[n],this.memory[n]=t[n];return this.memory.length=t.length,!e}clear(){this.memory.length=0}}/**
 * Stage.js v1.0.0-alpha.23
 * @copyright Copyright Ali Shakiba
 * @license Licensed under the MIT (https://github.com/piqnt/stage.js/blob/main/LICENSE.md)
 */var math_random=Math.random,math_sqrt=Math.sqrt;function random(i,t){return typeof i>"u"?(t=1,i=0):typeof t>"u"&&(t=i,i=0),i==t?i:math_random()*(t-i)+i}function wrap(i,t,e){return typeof t>"u"?(e=1,t=0):typeof e>"u"&&(e=t,t=0),e>t?(i=(i-t)%(e-t),i+(i<0?e:t)):(i=(i-e)%(t-e),i+(i<=0?t:e))}function clamp(i,t,e){return i<t?t:i>e?e:i}function length(i,t){return math_sqrt(i*i+t*t)}var math=Object.create(Math);math.random=random;math.wrap=wrap;math.clamp=clamp;math.length=length;math.rotate=wrap;math.limit=clamp;var Matrix=function(){function i(t,e,n,r,s,o){this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,typeof t=="object"?this.reset(t):this.reset(t,e,n,r,s,o)}return i.prototype.toString=function(){return"["+this.a+", "+this.b+", "+this.c+", "+this.d+", "+this.e+", "+this.f+"]"},i.prototype.clone=function(){return new i(this.a,this.b,this.c,this.d,this.e,this.f)},i.prototype.reset=function(t,e,n,r,s,o){return this._dirty=!0,typeof t=="object"?(this.a=t.a,this.d=t.d,this.b=t.b,this.c=t.c,this.e=t.e,this.f=t.f):(this.a=typeof t=="number"?t:1,this.b=typeof e=="number"?e:0,this.c=typeof n=="number"?n:0,this.d=typeof r=="number"?r:1,this.e=typeof s=="number"?s:0,this.f=typeof o=="number"?o:0),this},i.prototype.identity=function(){return this._dirty=!0,this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this},i.prototype.rotate=function(t){if(!t)return this;this._dirty=!0;var e=t?Math.cos(t):1,n=t?Math.sin(t):0,r=e*this.a-n*this.b,s=e*this.b+n*this.a,o=e*this.c-n*this.d,a=e*this.d+n*this.c,h=e*this.e-n*this.f,c=e*this.f+n*this.e;return this.a=r,this.b=s,this.c=o,this.d=a,this.e=h,this.f=c,this},i.prototype.translate=function(t,e){return!t&&!e?this:(this._dirty=!0,this.e+=t,this.f+=e,this)},i.prototype.scale=function(t,e){return!(t-1)&&!(e-1)?this:(this._dirty=!0,this.a*=t,this.b*=e,this.c*=t,this.d*=e,this.e*=t,this.f*=e,this)},i.prototype.skew=function(t,e){if(!t&&!e)return this;this._dirty=!0;var n=this.a+this.b*t,r=this.b+this.a*e,s=this.c+this.d*t,o=this.d+this.c*e,a=this.e+this.f*t,h=this.f+this.e*e;return this.a=n,this.b=r,this.c=s,this.d=o,this.e=a,this.f=h,this},i.prototype.concat=function(t){this._dirty=!0;var e=this.a*t.a+this.b*t.c,n=this.b*t.d+this.a*t.b,r=this.c*t.a+this.d*t.c,s=this.d*t.d+this.c*t.b,o=this.e*t.a+t.e+this.f*t.c,a=this.f*t.d+t.f+this.e*t.b;return this.a=e,this.b=n,this.c=r,this.d=s,this.e=o,this.f=a,this},i.prototype.inverse=function(){if(this._dirty){this._dirty=!1,this.inverted||(this.inverted=new i);var t=this.a*this.d-this.b*this.c;this.inverted.a=this.d/t,this.inverted.b=-this.b/t,this.inverted.c=-this.c/t,this.inverted.d=this.a/t,this.inverted.e=(this.c*this.f-this.e*this.d)/t,this.inverted.f=(this.e*this.b-this.a*this.f)/t}return this.inverted},i.prototype.map=function(t,e){return e=e||{x:0,y:0},e.x=this.a*t.x+this.c*t.y+this.e,e.y=this.b*t.x+this.d*t.y+this.f,e},i.prototype.mapX=function(t,e){return typeof t=="object"&&(e=t.y,t=t.x),this.a*t+this.c*e+this.e},i.prototype.mapY=function(t,e){return typeof t=="object"&&(e=t.y,t=t.x),this.b*t+this.d*e+this.f},i}();/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var extendStatics=function(i,t){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])},extendStatics(i,t)};function __extends(i,t){extendStatics(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var __assign=function(){return __assign=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t},__assign.apply(this,arguments)};function __awaiter(i,t,e,n){function r(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(_){try{c(n.next(_))}catch(p){o(p)}}function h(_){try{c(n.throw(_))}catch(p){o(p)}}function c(_){_.done?s(_.value):r(_.value).then(a,h)}c((n=n.apply(i,[])).next())})}function __generator(i,t){var e={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,r,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(_){return h([c,_])}}function h(c){if(n)throw new TypeError("Generator is already executing.");for(;e;)try{if(n=1,r&&(s=c[0]&2?r.return:c[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,c[1])).done)return s;switch(r=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return e.label++,{value:c[1],done:!1};case 5:e.label++,r=c[1],c=[0];continue;case 7:c=e.ops.pop(),e.trys.pop();continue;default:if(s=e.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){e=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){e.label=c[1];break}if(c[0]===6&&e.label<s[1]){e.label=s[1],s=c;break}if(s&&e.label<s[2]){e.label=s[2],e.ops.push(c);break}s[2]&&e.ops.pop(),e.trys.pop();continue}c=t.call(i,e)}catch(_){c=[6,_],r=0}finally{n=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}var objectToString=Object.prototype.toString;function isFn(i){var t=objectToString.call(i);return t==="[object Function]"||t==="[object GeneratorFunction]"||t==="[object AsyncFunction]"}function isHash(i){return objectToString.call(i)==="[object Object]"&&i.constructor===Object}const stats={create:0,tick:0,component:0,draw:0,fps:0};var uid=function(){return Date.now().toString(36)+Math.random().toString(36).slice(2)},Texture=function(){function i(){this.uid="texture:"+uid(),this.sx=0,this.sy=0,this.dx=0,this.dy=0}return i.prototype.setSourceCoordinate=function(t,e){this.sx=t,this.sy=e},i.prototype.setSourceDimension=function(t,e){this.sw=t,this.sh=e},i.prototype.setDestinationCoordinate=function(t,e){this.dx=t,this.dy=e},i.prototype.setDestinationDimension=function(t,e){this.dw=t,this.dh=e},i.prototype.draw=function(t,e,n,r,s,o,a,h,c){var _,p,g,m,d,l,u,v;arguments.length>5?(_=this.sx+e,p=this.sy+n,g=r??this.sw,m=s??this.sh,d=this.dx+o,l=this.dy+a,u=h??this.dw,v=c??this.dh):arguments.length>1?(_=this.sx,p=this.sy,g=this.sw,m=this.sh,d=this.dx+e,l=this.dy+n,u=r??this.dw,v=s??this.dh):(_=this.sx,p=this.sy,g=this.sw,m=this.sh,d=this.dx,l=this.dy,u=this.dw,v=this.dh),this.drawWithNormalizedArgs(t,_,p,g,m,d,l,u,v)},i}(),ImageTexture=function(i){__extends(t,i);function t(e,n){var r=i.call(this)||this;return r._pixelRatio=1,r.padding=0,typeof e=="object"&&r.setSourceImage(e,n),r}return t.prototype.setSourceImage=function(e,n){n===void 0&&(n=1),this._source=e,this._pixelRatio=n},t.prototype.setPadding=function(e){this.padding=e},t.prototype.getWidth=function(){return this._source.width/this._pixelRatio+(this.padding+this.padding)},t.prototype.getHeight=function(){return this._source.height/this._pixelRatio+(this.padding+this.padding)},t.prototype.prerender=function(e){return!1},t.prototype.drawWithNormalizedArgs=function(e,n,r,s,o,a,h,c,_){var p=this._source;if(!(p===null||typeof p!="object")){s=s??this._source.width/this._pixelRatio,o=o??this._source.height/this._pixelRatio,c=c??s,_=_??o,a+=this.padding,h+=this.padding;var g=n*this._pixelRatio,m=r*this._pixelRatio,d=s*this._pixelRatio,l=o*this._pixelRatio;try{stats.draw++,e.drawImage(p,g,m,d,l,a,h,c,_)}catch(u){this._draw_failed||(console.log("Unable to draw: ",p),console.log(u),this._draw_failed=!0)}}},t}(Texture),PipeTexture=function(i){__extends(t,i);function t(e){var n=i.call(this)||this;return n._source=e,n}return t.prototype.setSourceTexture=function(e){this._source=e},t.prototype.getWidth=function(){var e,n;return(n=(e=this.dw)!==null&&e!==void 0?e:this.sw)!==null&&n!==void 0?n:this._source.getWidth()},t.prototype.getHeight=function(){var e,n;return(n=(e=this.dh)!==null&&e!==void 0?e:this.sh)!==null&&n!==void 0?n:this._source.getHeight()},t.prototype.prerender=function(e){return this._source.prerender(e)},t.prototype.drawWithNormalizedArgs=function(e,n,r,s,o,a,h,c,_){var p=this._source;p===null||typeof p!="object"||p.draw(e,n,r,s,o,a,h,c,_)},t}(Texture),Atlas=function(i){__extends(t,i);function t(e){e===void 0&&(e={});var n=i.call(this)||this;return n.pipeSpriteTexture=function(r){var s=n._map,o=n._ppu,a=n._trim;if(r){r=Object.assign({},r),isFn(s)&&(r=s(r)),o!=1&&(r.x*=o,r.y*=o,r.width*=o,r.height*=o,r.top*=o,r.bottom*=o,r.left*=o,r.right*=o),a!=0&&(r.x+=a,r.y+=a,r.width-=2*a,r.height-=2*a,r.top-=a,r.bottom-=a,r.left-=a,r.right-=a);var h=new PipeTexture(n);return h.top=r.top,h.bottom=r.bottom,h.left=r.left,h.right=r.right,h.setSourceCoordinate(r.x,r.y),h.setSourceDimension(r.width,r.height),h}},n.findSpriteDefinition=function(r){var s=n._textures;if(s){if(isFn(s))return s(r);if(isHash(s))return s[r]}},n.select=function(r){if(!r)return new TextureSelection(new PipeTexture(n));var s=n.findSpriteDefinition(r);if(s)return new TextureSelection(s,n)},n.name=e.name,n._ppu=e.ppu||e.ratio||1,n._trim=e.trim||0,n._map=e.map||e.filter,n._textures=e.textures,typeof e.image=="object"&&isHash(e.image)?("src"in e.image?n._imageSrc=e.image.src:"url"in e.image&&(n._imageSrc=e.image.url),typeof e.image.ratio=="number"&&(n._pixelRatio=e.image.ratio)):(typeof e.imagePath=="string"?n._imageSrc=e.imagePath:typeof e.image=="string"&&(n._imageSrc=e.image),typeof e.imageRatio=="number"&&(n._pixelRatio=e.imageRatio)),deprecatedWarning(e),n}return t.prototype.load=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(n){switch(n.label){case 0:return this._imageSrc?[4,asyncLoadImage(this._imageSrc)]:[3,2];case 1:e=n.sent(),this.setSourceImage(e,this._pixelRatio),n.label=2;case 2:return[2]}})})},t}(ImageTexture);function asyncLoadImage(i){return console.debug&&console.debug("Loading image: "+i),new Promise(function(t,e){var n=new Image;n.onload=function(){console.debug&&console.debug("Image loaded: "+i),t(n)},n.onerror=function(r){console.error("Loading failed: "+i),e(r)},n.src=i})}function deprecatedWarning(i){"filter"in i&&console.warn("'filter' field of atlas definition is deprecated"),"cutouts"in i&&console.warn("'cutouts' field of atlas definition is deprecated"),"sprites"in i&&console.warn("'sprites' field of atlas definition is deprecated"),"factory"in i&&console.warn("'factory' field of atlas definition is deprecated"),"ratio"in i&&console.warn("'ratio' field of atlas definition is deprecated"),"imagePath"in i&&console.warn("'imagePath' field of atlas definition is deprecated"),"imageRatio"in i&&console.warn("'imageRatio' field of atlas definition is deprecated"),typeof i.image=="object"&&"url"in i.image&&console.warn("'image.url' field of atlas definition is deprecated")}function isAtlasSpriteDefinition(i){return typeof i=="object"&&isHash(i)&&typeof i.width=="number"&&typeof i.height=="number"}var TextureSelection=function(){function i(t,e){this.selection=t,this.atlas=e}return i.prototype.resolve=function(t,e){if(t){if(Array.isArray(t))return this.resolve(t[0]);if(t instanceof Texture)return t;if(isAtlasSpriteDefinition(t))return this.atlas?this.atlas.pipeSpriteTexture(t):NO_TEXTURE;if(typeof t=="object"&&isHash(t)&&typeof e<"u")return this.resolve(t[e]);if(typeof t=="function"&&isFn(t))return this.resolve(t(e));if(typeof t=="string")return this.atlas?this.resolve(this.atlas.findSpriteDefinition(t)):NO_TEXTURE}else return NO_TEXTURE},i.prototype.one=function(t){return this.resolve(this.selection,t)},i.prototype.array=function(t){var e=Array.isArray(t)?t:[];if(Array.isArray(this.selection))for(var n=0;n<this.selection.length;n++)e[n]=this.resolve(this.selection[n]);else e[0]=this.resolve(this.selection);return e},i}(),NO_TEXTURE=new(function(i){__extends(t,i);function t(){var e=i.call(this)||this;return e.setSourceDimension(0,0),e}return t.prototype.getWidth=function(){return 0},t.prototype.getHeight=function(){return 0},t.prototype.prerender=function(e){return!1},t.prototype.drawWithNormalizedArgs=function(e,n,r,s,o,a,h,c,_){},t.prototype.setSourceCoordinate=function(e,n){},t.prototype.setSourceDimension=function(e,n){},t.prototype.setDestinationCoordinate=function(e,n){},t.prototype.setDestinationDimension=function(e,n){},t.prototype.draw=function(){},t}(Texture)),NO_SELECTION=new TextureSelection(NO_TEXTURE),ATLAS_MEMO_BY_NAME={},ATLAS_ARRAY=[];function atlas(i){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return i instanceof Atlas?t=i:t=new Atlas(i),t.name&&(ATLAS_MEMO_BY_NAME[t.name]=t),ATLAS_ARRAY.push(t),[4,t.load()];case 1:return e.sent(),[2,t]}})})}function texture(i){if(typeof i!="string")return new TextureSelection(i);var t=null,e=i.indexOf(":");if(e>0&&i.length>e+1){var n=ATLAS_MEMO_BY_NAME[i.slice(0,e)];t=n&&n.select(i.slice(e+1))}if(!t){var r=ATLAS_MEMO_BY_NAME[i];t=r&&r.select()}if(!t)for(var s=0;s<ATLAS_ARRAY.length&&(t=ATLAS_ARRAY[s].select(i),!t);s++);return t||(console.error("Texture not found: "+i),t=NO_SELECTION),t}var ResizableTexture=function(i){__extends(t,i);function t(e,n){var r=i.call(this)||this;return r._source=e,r._resizeMode=n,r}return t.prototype.getWidth=function(){var e;return(e=this.dw)!==null&&e!==void 0?e:this._source.getWidth()},t.prototype.getHeight=function(){var e;return(e=this.dh)!==null&&e!==void 0?e:this._source.getHeight()},t.prototype.prerender=function(e){return!1},t.prototype.drawWithNormalizedArgs=function(e,n,r,s,o,a,h,c,_){var p=this._source;if(!(p===null||typeof p!="object")){var g=c,m=_,d=Number.isFinite(p.left)?p.left:0,l=Number.isFinite(p.right)?p.right:0,u=Number.isFinite(p.top)?p.top:0,v=Number.isFinite(p.bottom)?p.bottom:0,x=p.getWidth()-d-l,w=p.getHeight()-u-v;if(this._innerSize||(g=Math.max(g-d-l,0),m=Math.max(m-u-v,0)),u>0&&d>0&&p.draw(e,0,0,d,u,0,0,d,u),v>0&&d>0&&p.draw(e,0,w+u,d,v,0,m+u,d,v),u>0&&l>0&&p.draw(e,x+d,0,l,u,g+d,0,l,u),v>0&&l>0&&p.draw(e,x+d,w+u,l,v,g+d,m+u,l,v),this._resizeMode==="stretch")u>0&&p.draw(e,d,0,x,u,d,0,g,u),v>0&&p.draw(e,d,w+u,x,v,d,m+u,g,v),d>0&&p.draw(e,0,u,d,w,0,u,d,m),l>0&&p.draw(e,x+d,u,l,w,g+d,u,l,m),p.draw(e,d,u,x,w,d,u,g,m);else if(this._resizeMode==="tile")for(var y=d,b=g,S=void 0;b>0;){S=Math.min(x,b),b-=x;for(var A=u,T=m,E=void 0;T>0;)E=Math.min(w,T),T-=w,p.draw(e,d,u,S,E,y,A,S,E),b<=0&&(d&&p.draw(e,0,u,d,E,0,A,d,E),l&&p.draw(e,x+d,u,l,E,y+S,A,l,E)),A+=E;u&&p.draw(e,d,0,S,u,y,0,S,u),v&&p.draw(e,d,w+u,S,v,y,A,S,v),y+=S}}},t}(Texture);function getDevicePixelRatio(){return typeof window<"u"&&window.devicePixelRatio||1}function isValidFitMode(i){return i&&(i==="cover"||i==="contain"||i==="fill"||i==="in"||i==="in-pad"||i==="out"||i==="out-crop")}var iid$1=0,Pin=function(){function i(t){this.uid="pin:"+uid(),this._directionX=1,this._directionY=1,this._owner=t,this._parent=null,this._relativeMatrix=new Matrix,this._absoluteMatrix=new Matrix,this.reset()}return i.prototype.reset=function(){this._textureAlpha=1,this._alpha=1,this._width=0,this._height=0,this._scaleX=1,this._scaleY=1,this._skewX=0,this._skewY=0,this._rotation=0,this._pivoted=!1,this._pivotX=0,this._pivotY=0,this._handled=!1,this._handleX=0,this._handleY=0,this._aligned=!1,this._alignX=0,this._alignY=0,this._offsetX=0,this._offsetY=0,this._boxX=0,this._boxY=0,this._boxWidth=this._width,this._boxHeight=this._height,this._ts_translate=++iid$1,this._ts_transform=++iid$1,this._ts_matrix=++iid$1},i.prototype._update=function(){return this._parent=this._owner._parent&&this._owner._parent._pin,this._handled&&this._mo_handle!=this._ts_transform&&(this._mo_handle=this._ts_transform,this._ts_translate=++iid$1),this._aligned&&this._parent&&this._mo_align!=this._parent._ts_transform&&(this._mo_align=this._parent._ts_transform,this._ts_translate=++iid$1),this},i.prototype.toString=function(){return this._owner+" ("+(this._parent?this._parent._owner:null)+")"},i.prototype.absoluteMatrix=function(){this._update();var t=Math.max(this._ts_transform,this._ts_translate,this._parent?this._parent._ts_matrix:0);if(this._mo_abs==t)return this._absoluteMatrix;this._mo_abs=t;var e=this._absoluteMatrix;return e.reset(this.relativeMatrix()),this._parent&&e.concat(this._parent._absoluteMatrix),this._ts_matrix=++iid$1,e},i.prototype.relativeMatrix=function(){this._update();var t=Math.max(this._ts_transform,this._ts_translate,this._parent?this._parent._ts_transform:0);if(this._mo_rel==t)return this._relativeMatrix;this._mo_rel=t;var e=this._relativeMatrix;if(e.identity(),this._pivoted&&e.translate(-this._pivotX*this._width,-this._pivotY*this._height),e.scale(this._scaleX*this._directionX,this._scaleY*this._directionY),e.skew(this._skewX,this._skewY),e.rotate(this._rotation),this._pivoted&&e.translate(this._pivotX*this._width,this._pivotY*this._height),this._pivoted)this._boxX=0,this._boxY=0,this._boxWidth=this._width,this._boxHeight=this._height;else{var n=void 0,r=void 0;e.a>0&&e.c>0||e.a<0&&e.c<0?(n=0,r=e.a*this._width+e.c*this._height):(n=e.a*this._width,r=e.c*this._height),n>r?(this._boxX=r,this._boxWidth=n-r):(this._boxX=n,this._boxWidth=r-n),e.b>0&&e.d>0||e.b<0&&e.d<0?(n=0,r=e.b*this._width+e.d*this._height):(n=e.b*this._width,r=e.d*this._height),n>r?(this._boxY=r,this._boxHeight=n-r):(this._boxY=n,this._boxHeight=r-n)}return this._x=this._offsetX,this._y=this._offsetY,this._x-=this._boxX+this._handleX*this._boxWidth*this._directionX,this._y-=this._boxY+this._handleY*this._boxHeight*this._directionY,this._aligned&&this._parent&&(this._parent.relativeMatrix(),this._x+=this._alignX*this._parent._width,this._y+=this._alignY*this._parent._height),e.translate(this._x,this._y),this._relativeMatrix},i.prototype.get=function(t){if(typeof getters[t]=="function")return getters[t](this)},i.prototype.set=function(t,e){if(typeof t=="string")typeof setters[t]=="function"&&typeof e<"u"&&setters[t](this,e);else if(typeof t=="object")for(e in t)typeof setters[e]=="function"&&typeof t[e]<"u"&&setters[e](this,t[e],t);return this._owner&&(this._owner._ts_pin=++iid$1,this._owner.touch()),this},i.prototype.fit=function(t,e,n){this._ts_transform=++iid$1,n==="contain"&&(n="in-pad"),n==="cover"&&(n="out-crop"),typeof t=="number"&&(this._scaleX=t/this._unscaled_width,this._width=this._unscaled_width),typeof e=="number"&&(this._scaleY=e/this._unscaled_height,this._height=this._unscaled_height),typeof t=="number"&&typeof e=="number"&&typeof n=="string"&&(n==="fill"||(n==="out"||n==="out-crop"?this._scaleX=this._scaleY=Math.max(this._scaleX,this._scaleY):(n==="in"||n==="in-pad")&&(this._scaleX=this._scaleY=Math.min(this._scaleX,this._scaleY))),(n==="out-crop"||n==="in-pad")&&(this._width=t/this._scaleX,this._height=e/this._scaleY))},i}(),getters={alpha:function(i){return i._alpha},textureAlpha:function(i){return i._textureAlpha},width:function(i){return i._width},height:function(i){return i._height},boxWidth:function(i){return i._boxWidth},boxHeight:function(i){return i._boxHeight},scaleX:function(i){return i._scaleX},scaleY:function(i){return i._scaleY},skewX:function(i){return i._skewX},skewY:function(i){return i._skewY},rotation:function(i){return i._rotation},pivotX:function(i){return i._pivotX},pivotY:function(i){return i._pivotY},offsetX:function(i){return i._offsetX},offsetY:function(i){return i._offsetY},alignX:function(i){return i._alignX},alignY:function(i){return i._alignY},handleX:function(i){return i._handleX},handleY:function(i){return i._handleY}},setters={alpha:function(i,t){i._alpha=t},textureAlpha:function(i,t){i._textureAlpha=t},width:function(i,t){i._unscaled_width=t,i._width=t,i._ts_transform=++iid$1},height:function(i,t){i._unscaled_height=t,i._height=t,i._ts_transform=++iid$1},scale:function(i,t){i._scaleX=t,i._scaleY=t,i._ts_transform=++iid$1},scaleX:function(i,t){i._scaleX=t,i._ts_transform=++iid$1},scaleY:function(i,t){i._scaleY=t,i._ts_transform=++iid$1},skew:function(i,t){i._skewX=t,i._skewY=t,i._ts_transform=++iid$1},skewX:function(i,t){i._skewX=t,i._ts_transform=++iid$1},skewY:function(i,t){i._skewY=t,i._ts_transform=++iid$1},rotation:function(i,t){i._rotation=t,i._ts_transform=++iid$1},pivot:function(i,t){i._pivotX=t,i._pivotY=t,i._pivoted=!0,i._ts_transform=++iid$1},pivotX:function(i,t){i._pivotX=t,i._pivoted=!0,i._ts_transform=++iid$1},pivotY:function(i,t){i._pivotY=t,i._pivoted=!0,i._ts_transform=++iid$1},offset:function(i,t){i._offsetX=t,i._offsetY=t,i._ts_translate=++iid$1},offsetX:function(i,t){i._offsetX=t,i._ts_translate=++iid$1},offsetY:function(i,t){i._offsetY=t,i._ts_translate=++iid$1},align:function(i,t){this.alignX(i,t),this.alignY(i,t)},alignX:function(i,t){i._alignX=t,i._aligned=!0,i._ts_translate=++iid$1,this.handleX(i,t)},alignY:function(i,t){i._alignY=t,i._aligned=!0,i._ts_translate=++iid$1,this.handleY(i,t)},handle:function(i,t){this.handleX(i,t),this.handleY(i,t)},handleX:function(i,t){i._handleX=t,i._handled=!0,i._ts_translate=++iid$1},handleY:function(i,t){i._handleY=t,i._handled=!0,i._ts_translate=++iid$1},resizeMode:function(i,t,e){e&&(t=="in"?t="in-pad":t=="out"&&(t="out-crop"),i.fit(e.resizeWidth,e.resizeHeight,t))},resizeWidth:function(i,t,e){(!e||!e.resizeMode)&&i.fit(t,null)},resizeHeight:function(i,t,e){(!e||!e.resizeMode)&&i.fit(null,t)},scaleMode:function(i,t,e){e&&i.fit(e.scaleWidth,e.scaleHeight,t)},scaleWidth:function(i,t,e){(!e||!e.scaleMode)&&i.fit(t,null)},scaleHeight:function(i,t,e){(!e||!e.scaleMode)&&i.fit(null,t)},matrix:function(i,t){this.scaleX(i,t.a),this.skewX(i,t.c/t.d),this.skewY(i,t.b/t.a),this.scaleY(i,t.d),this.offsetX(i,t.e),this.offsetY(i,t.f),this.rotation(i,0)}},IDENTITY=function(i){return i},Easing=function(){function i(){}return i.init=function(t,e){if(typeof t=="function")return t;if(typeof t=="string"){var n;if(t.indexOf("(")===-1)n=initEasing(t,e);else{var r=/^((\w|-)+)?(\((.*)\))?$/i.exec(t);if(r||r.length){var s=r[1],o=JSON.parse("["+r[4]+"]");n=initEasing(s,o)}}return n}},i}(),initEasing=function(i,t){var e,n=EasingFunctions[i],r=EasingFactories[i];return n?e=n:r&&(t?e=r.apply(null,t):e=r()),e},out=function(i){return function(t){return 1-i(1-t)}},inOut=function(i){return function(t){return t<.5?i(2*t)/2:1-i(2*(1-t))/2}},outIn=function(i){return function(t){return t<.5?1-i(2*(1-t))/2:i(2*t)/2}},linear=function(i){return i},quad=function(i){return i*i},cubic=function(i){return i*i*i},quart=function(i){return i*i*i*i},quint=function(i){return i*i*i*i*i},sin=function(i){return 1-Math.cos(i*Math.PI/2)},exp=function(i){return i==0?0:Math.pow(2,10*(i-1))},circle=function(i){return 1-Math.sqrt(1-i*i)},bounce=function(i){return i<1/2.75?7.5625*i*i:i<2/2.75?7.5625*(i-=1.5/2.75)*i+.75:i<2.5/2.75?7.5625*(i-=2.25/2.75)*i+.9375:7.5625*(i-=2.625/2.75)*i+.984375},poly=function(i){return function(t){return Math.pow(t,i)}},elastic=function(i,t){i===void 0&&(i=1),t===void 0&&(t=.45);var e=t/(2*Math.PI)*Math.asin(1/i);return function(n){return 1+i*Math.pow(2,-10*n)*Math.sin((n-e)*(2*Math.PI)/t)}},back=function(i){return i===void 0&&(i=1.70158),function(t){return t*t*((i+1)*t-i)}},EasingFunctions={linear,"linear-in":linear,"linear-out":out(linear),"linear-in-out":inOut(linear),"linear-out-in":outIn(linear),quad,"quad-in":quad,"quad-out":out(quad),"quad-in-out":inOut(quad),"quad-out-in":outIn(quad),cubic,"cubic-in":cubic,"cubic-out":out(cubic),"cubic-in-out":inOut(cubic),"cubic-out-in":outIn(cubic),quart,"quart-in":quart,"quart-out":out(quart),"quart-in-out":inOut(quart),"quart-out-in":outIn(quart),quint,"quint-in":quint,"quint-out":out(quint),"quint-in-out":inOut(quint),"quint-out-in":outIn(quint),sin,"sin-in":sin,"sin-out":out(sin),"sin-in-out":inOut(sin),"sin-out-in":outIn(sin),sine:sin,"sine-in":sin,"sine-out":out(sin),"sine-in-out":inOut(sin),"sine-out-in":outIn(sin),exp,"exp-in":exp,"exp-out":out(exp),"exp-in-out":inOut(exp),"exp-out-in":outIn(exp),expo:exp,"expo-in":exp,"expo-out":out(exp),"expo-in-out":inOut(exp),"expo-out-in":outIn(exp),circle,"circle-in":circle,"circle-out":out(circle),"circle-in-out":inOut(circle),"circle-out-in":outIn(circle),circ:circle,"circ-in":circle,"circ-out":out(circle),"circ-in-out":inOut(circle),"circ-out-in":outIn(circle),bounce,"bounce-in":bounce,"bounce-out":out(bounce),"bounce-in-out":inOut(bounce),"bounce-out-in":outIn(bounce)},EasingFactories={poly,"poly-in":poly,"poly-out":function(i){return out(poly(i))},"poly-in-out":function(i){return inOut(poly(i))},"poly-out-in":function(i){return outIn(poly(i))},elastic,"elastic-in":elastic,"elastic-out":function(i,t){return out(elastic(i,t))},"elastic-in-out":function(i,t){return inOut(elastic(i,t))},"elastic-out-in":function(i,t){return outIn(elastic(i,t))},back,"back-in":back,"back-out":function(i){return out(back(i))},"back-in-out":function(i){return inOut(back(i))},"back-out-in":function(i){return outIn(back(i))}},Transition=function(){function i(t,e){e===void 0&&(e={}),this.uid="transition:"+uid(),this._ending=[],this._end={},this._duration=e.duration||400,this._delay=e.delay||0,this._owner=t,this._time=0}return i.prototype.tick=function(t,e,n,r){if(this._time+=e,!(this._time<this._delay)){var s=this._time-this._delay;if(!this._start){this._start={};for(var o in this._end)this._start[o]=this._owner._pin.get(o)}var a=Math.min(s/this._duration,1),h=a>=1;typeof this._easing=="function"&&(a=this._easing(a));var c=1-a;for(var o in this._end)this._owner._pin.set(o,this._start[o]*c+this._end[o]*a);return h}},i.prototype.finish=function(){var t=this;return this._ending.forEach(function(e){try{e.call(t._owner)}catch(n){console.error(n)}}),this._next},i.prototype.tween=function(t,e){var n;return typeof t=="object"&&t!==null?n=t:(n={},typeof t=="number"&&(n.duration=t,typeof e=="number"&&(n.delay=e))),this._next=new i(this._owner,n)},i.prototype.duration=function(t){return this._duration=t,this},i.prototype.delay=function(t){return this._delay=t,this},i.prototype.ease=function(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return this._easing=(e=Easing.init(t,n))!==null&&e!==void 0?e:IDENTITY,this},i.prototype.done=function(t){return this._ending.push(t),this},i.prototype.hide=function(){return this._ending.push(function(){this.hide()}),this._hide=!0,this},i.prototype.remove=function(){return this._ending.push(function(){this.remove()}),this._remove=!0,this},i.prototype.pin=function(t,e){if(typeof t=="object")for(var n in t)pinning(this._owner,this._end,n,t[n]);else typeof e<"u"&&pinning(this._owner,this._end,t,e);return this},i.prototype.then=function(t){return this.done(t),this},i.prototype.clear=function(t){return this},i.prototype.size=function(t,e){return this.pin("width",t),this.pin("height",e),this},i.prototype.width=function(t){return this.pin("width",t),this},i.prototype.height=function(t){return this.pin("height",t),this},i.prototype.offset=function(t,e){return typeof t=="object"&&(e=t.y,t=t.x),this.pin("offsetX",t),this.pin("offsetY",e),this},i.prototype.rotate=function(t){return this.pin("rotation",t),this},i.prototype.skew=function(t,e){return typeof t=="object"?(e=t.y,t=t.x):typeof e>"u"&&(e=t),this.pin("skewX",t),this.pin("skewY",e),this},i.prototype.scale=function(t,e){return typeof t=="object"?(e=t.y,t=t.x):typeof e>"u"&&(e=t),this.pin("scaleX",t),this.pin("scaleY",e),this},i.prototype.alpha=function(t,e){return this.pin("alpha",t),typeof e<"u"&&this.pin("textureAlpha",e),this},i}();function pinning(i,t,e,n){typeof i._pin.get(e)=="number"?t[e]=n:typeof i._pin.get(e+"X")=="number"&&typeof i._pin.get(e+"Y")=="number"&&(t[e+"X"]=n,t[e+"Y"]=n)}var iid=0;stats.create=0;function assertType(i){if(i&&i instanceof Component)return i;throw"Invalid component: "+i}function component(){return new Component}var Component=function(){function i(){var t=this;this.uid="component:"+uid(),this._label="",this._parent=null,this._next=null,this._prev=null,this._first=null,this._last=null,this._visible=!0,this._alpha=1,this._padding=0,this._spacing=0,this._pin=new Pin(this),this._listeners={},this._attrs={},this._flags={},this._transitions=[],this._tickBefore=[],this._tickAfter=[],this.MAX_ELAPSE=1/0,this.renderedBefore=!1,this._transitionTickInitied=!1,this._transitionTickLastTime=0,this._transitionTick=function(e,n,r){if(!t._transitions.length)return!1;var s=t._transitionTickLastTime!==r;if(t._transitionTickLastTime=n,s)return!0;var o=t._transitions[0],a=o.tick(t,e,n,r);if(a){o===t._transitions[0]&&t._transitions.shift();var h=o.finish();h&&t._transitions.unshift(h)}return!0},stats.create++,this instanceof i&&this.label(this.constructor.name)}return i.prototype.matrix=function(t){return t===void 0&&(t=!1),t===!0?this._pin.relativeMatrix():this._pin.absoluteMatrix()},i.prototype.getPixelRatio=function(){var t,e=(t=this._parent)===null||t===void 0?void 0:t.matrix(),n=e?Math.max(Math.abs(e.a),Math.abs(e.b))/getDevicePixelRatio():1;return n},i.prototype.getDevicePixelRatio=function(){var t,e=(t=this._parent)===null||t===void 0?void 0:t.matrix(),n=e?Math.max(Math.abs(e.a),Math.abs(e.b)):1;return n},i.prototype.getLogicalPixelRatio=function(){return this.getDevicePixelRatio()/getDevicePixelRatio()},i.prototype.pin=function(t,e){if(typeof t=="object")return this._pin.set(t),this;if(typeof t=="string")return typeof e>"u"?this._pin.get(t):(this._pin.set(t,e),this);if(typeof t>"u")return this._pin},i.prototype.fit=function(t,e,n){var r,s,o;return typeof t=="object"?this._pin.fit((r=t.width)!==null&&r!==void 0?r:t.x,(s=t.height)!==null&&s!==void 0?s:t.y,(o=t.mode)!==null&&o!==void 0?o:e):this._pin.fit(t,e,n),this},i.prototype.scaleTo=function(t,e,n){return this.fit(t,e,n)},i.prototype.toString=function(){return"["+this._label+"]"},i.prototype.id=function(t){return typeof t>"u"?this._label:(this._label=t,this)},i.prototype.label=function(t){return typeof t>"u"?this._label:(this._label=t,this)},i.prototype.attr=function(t,e){return typeof e>"u"?this._attrs!==null?this._attrs[t]:void 0:((this._attrs!==null?this._attrs:this._attrs={})[t]=e,this)},i.prototype.visible=function(t){return typeof t>"u"?this._visible:(this._visible=t,this._parent&&(this._parent._ts_children=++iid),this._ts_pin=++iid,this.touch(),this)},i.prototype.hide=function(){return this.visible(!1),this},i.prototype.show=function(){return this.visible(!0),this},i.prototype.parent=function(){return this._parent},i.prototype.next=function(t){for(var e=this._next;e&&t&&!e._visible;)e=e._next;return e},i.prototype.prev=function(t){for(var e=this._prev;e&&t&&!e._visible;)e=e._prev;return e},i.prototype.first=function(t){for(var e=this._first;e&&t&&!e._visible;)e=e._next;return e},i.prototype.last=function(t){for(var e=this._last;e&&t&&!e._visible;)e=e._prev;return e},i.prototype.visit=function(t,e){var n=t.reverse,r=t.visible;if(!(t.start&&t.start(this,e))){for(var s,o=n?this.last(r):this.first(r);s=o;)if(o=n?s.prev(r):s.next(r),s.visit(t,e))return!0;return t.end&&t.end(this,e)}},i.prototype.append=function(t,e){if(Array.isArray(t))for(var n=0;n<t.length;n++)i.append(this,t[n]);else if(typeof e<"u")for(var n=0;n<arguments.length;n++)i.append(this,arguments[n]);else typeof t<"u"&&i.append(this,t);return this},i.prototype.prepend=function(t,e){if(Array.isArray(t))for(var n=t.length-1;n>=0;n--)i.prepend(this,t[n]);else if(typeof e<"u")for(var n=arguments.length-1;n>=0;n--)i.prepend(this,arguments[n]);else typeof t<"u"&&i.prepend(this,t);return this},i.prototype.appendTo=function(t){return i.append(t,this),this},i.prototype.prependTo=function(t){return i.prepend(t,this),this},i.prototype.insertNext=function(t,e){if(Array.isArray(t))for(var n=0;n<t.length;n++)i.insertAfter(t[n],this);else if(typeof e<"u")for(var n=0;n<arguments.length;n++)i.insertAfter(arguments[n],this);else typeof t<"u"&&i.insertAfter(t,this);return this},i.prototype.insertPrev=function(t,e){if(Array.isArray(t))for(var n=t.length-1;n>=0;n--)i.insertBefore(t[n],this);else if(typeof e<"u")for(var n=arguments.length-1;n>=0;n--)i.insertBefore(arguments[n],this);else typeof t<"u"&&i.insertBefore(t,this);return this},i.prototype.insertAfter=function(t){return i.insertAfter(this,t),this},i.prototype.insertBefore=function(t){return i.insertBefore(this,t),this},i.append=function(t,e){assertType(e),assertType(t),e.remove(),t._last&&(t._last._next=e,e._prev=t._last),e._parent=t,t._last=e,t._first||(t._first=e),e._parent._flag(e,!0),e._ts_parent=++iid,t._ts_children=++iid,t.touch()},i.prepend=function(t,e){assertType(e),assertType(t),e.remove(),t._first&&(t._first._prev=e,e._next=t._first),e._parent=t,t._first=e,t._last||(t._last=e),e._parent._flag(e,!0),e._ts_parent=++iid,t._ts_children=++iid,t.touch()},i.insertBefore=function(t,e){assertType(t),assertType(e),t.remove();var n=e._parent,r=e._prev;n&&(e._prev=t,r&&(r._next=t)||n&&(n._first=t),t._parent=n,t._prev=r,t._next=e,t._parent._flag(t,!0),t._ts_parent=++iid,t.touch())},i.insertAfter=function(t,e){assertType(t),assertType(e),t.remove();var n=e._parent,r=e._next;n&&(e._next=t,r&&(r._prev=t)||n&&(n._last=t),t._parent=n,t._prev=e,t._next=r,t._parent._flag(t,!0),t._ts_parent=++iid,t.touch())},i.prototype.remove=function(t,e){if(typeof t<"u"){if(Array.isArray(t))for(var n=0;n<t.length;n++)assertType(t[n]).remove();else if(typeof e<"u")for(var n=0;n<arguments.length;n++)assertType(arguments[n]).remove();else assertType(t).remove();return this}return this._prev&&(this._prev._next=this._next),this._next&&(this._next._prev=this._prev),this._parent&&(this._parent._first===this&&(this._parent._first=this._next),this._parent._last===this&&(this._parent._last=this._prev),this._parent._flag(this,!1),this._parent._ts_children=++iid,this._parent.touch()),this._prev=this._next=this._parent=null,this._ts_parent=++iid,this},i.prototype.empty=function(){for(var t=null,e=this._first;t=e;)e=t._next,t._prev=t._next=t._parent=null,this._flag(t,!1);return this._first=this._last=null,this._ts_children=++iid,this.touch(),this},i.prototype.touch=function(){return this._ts_touch=++iid,this._parent&&this._parent.touch(),this},i.prototype._flag=function(t,e){if(typeof e>"u")return this._flags!==null&&this._flags[t]||0;if(typeof t=="string"&&(e?(this._flags=this._flags||{},!this._flags[t]&&this._parent&&this._parent._flag(t,!0),this._flags[t]=(this._flags[t]||0)+1):this._flags&&this._flags[t]>0&&(this._flags[t]==1&&this._parent&&this._parent._flag(t,!1),this._flags[t]=this._flags[t]-1)),typeof t=="object"&&t._flags)for(var n in t._flags)t._flags[n]>0&&this._flag(n,e);return this},i.prototype.hitTest=function(t){var e=this._pin._width,n=this._pin._height;return t.x>=0&&t.x<=e&&t.y>=0&&t.y<=n},i.prototype.prerender=function(){if(this._visible){this.prerenderTexture();for(var t,e=this._first;t=e;)e=t._next,t.prerender()}},i.prototype.prerenderTexture=function(){},i.prototype.render=function(t){if(this._visible){stats.component++;var e=this.matrix();t.setTransform(e.a,e.b,e.c,e.d,e.e,e.f),this._alpha=this._pin._alpha*(this._parent?this._parent._alpha:1);var n=this._pin._textureAlpha*this._alpha;t.globalAlpha!=n&&(t.globalAlpha=n),this.renderedBefore||this.prerenderTexture(),this.renderedBefore=!0,this.renderTexture(t),t.globalAlpha!=this._alpha&&(t.globalAlpha=this._alpha);for(var r,s=this._first;r=s;)s=r._next,r.render(t)}},i.prototype.renderTexture=function(t){},i.prototype._tick=function(t,e,n){if(this._visible){t>this.MAX_ELAPSE&&(t=this.MAX_ELAPSE);var r=!1;if(this._tickBefore!==null)for(var s=0;s<this._tickBefore.length;s++){stats.tick++;var o=this._tickBefore[s];r=o.call(this,t,e,n)===!0||r}for(var a,h=this._first;a=h;)h=a._next,a._flag("_tick")&&(r=a._tick(t,e,n)===!0?!0:r);if(this._tickAfter!==null)for(var s=0;s<this._tickAfter.length;s++){stats.tick++;var o=this._tickAfter[s];r=o.call(this,t,e,n)===!0||r}return r}},i.prototype.tick=function(t,e){var n,r;if(e===void 0&&(e=!1),typeof t=="function"){e?(this._tickBefore===null&&(this._tickBefore=[]),this._tickBefore.push(t)):(this._tickAfter===null&&(this._tickAfter=[]),this._tickAfter.push(t));var s=((n=this._tickAfter)===null||n===void 0?void 0:n.length)>0||((r=this._tickBefore)===null||r===void 0?void 0:r.length)>0;this._flag("_tick",s)}},i.prototype.untick=function(t){if(typeof t=="function"){var e;this._tickBefore!==null&&(e=this._tickBefore.indexOf(t))>=0&&this._tickBefore.splice(e,1),this._tickAfter!==null&&(e=this._tickAfter.indexOf(t))>=0&&this._tickAfter.splice(e,1)}},i.prototype.timeout=function(t,e){this.setTimeout(t,e)},i.prototype.setTimeout=function(t,e){function n(r){if((e-=r)<0)this.untick(n),t.call(this);else return!0}return this.tick(n),n},i.prototype.clearTimeout=function(t){this.untick(t)},i.prototype.on=function(t,e){if(!t||!t.length||typeof e!="function")return this;if(typeof t!="string"&&typeof t.join=="function")for(var n=0;n<t.length;n++)this.on(t[n],e);else if(typeof t=="string"&&t.indexOf(" ")>-1){t=t.match(/\S+/g);for(var n=0;n<t.length;n++)this._on(t[n],e)}else typeof t=="string"&&this._on(t,e);return this},i.prototype._on=function(t,e){typeof t!="string"&&typeof e!="function"||(this._listeners[t]=this._listeners[t]||[],this._listeners[t].push(e),this._flag(t,!0))},i.prototype.off=function(t,e){if(!t||!t.length||typeof e!="function")return this;if(typeof t!="string"&&typeof t.join=="function")for(var n=0;n<t.length;n++)this.off(t[n],e);else if(typeof t=="string"&&t.indexOf(" ")>-1){t=t.match(/\S+/g);for(var n=0;n<t.length;n++)this._off(t[n],e)}else typeof t=="string"&&this._off(t,e);return this},i.prototype._off=function(t,e){if(!(typeof t!="string"&&typeof e!="function")){var n=this._listeners[t];if(!(!n||!n.length)){var r=n.indexOf(e);r>=0&&(n.splice(r,1),this._flag(t,!1))}}},i.prototype.listeners=function(t){return this._listeners[t]},i.prototype.publish=function(t,e){var n=this.listeners(t);if(!n||!n.length)return 0;for(var r=0;r<n.length;r++)n[r].apply(this,e);return n.length},i.prototype.trigger=function(t,e){return this.publish(t,e),this},i.prototype.size=function(t,e){return this.pin("width",t),this.pin("height",e),this},i.prototype.width=function(t){return typeof t>"u"?this.pin("width"):(this.pin("width",t),this)},i.prototype.height=function(t){return typeof t>"u"?this.pin("height"):(this.pin("height",t),this)},i.prototype.offset=function(t,e){return typeof t=="object"&&(e=t.y,t=t.x),this.pin("offsetX",t),this.pin("offsetY",e),this},i.prototype.rotate=function(t){return this.pin("rotation",t),this},i.prototype.skew=function(t,e){return typeof t=="object"?(e=t.y,t=t.x):typeof e>"u"&&(e=t),this.pin("skewX",t),this.pin("skewY",e),this},i.prototype.scale=function(t,e){return typeof t=="object"?(e=t.y,t=t.x):typeof e>"u"&&(e=t),this.pin("scaleX",t),this.pin("scaleY",e),this},i.prototype.alpha=function(t,e){return this.pin("alpha",t),typeof e<"u"&&this.pin("textureAlpha",e),this},i.prototype.tween=function(t,e,n){var r;typeof t=="object"&&t!==null?r=t:(r={},typeof t=="number"?(r.duration=t,typeof e=="number"?(r.delay=e,typeof n=="boolean"&&(r.append=n)):typeof e=="boolean"&&(r.append=e)):typeof t=="boolean"&&(r.append=t)),this._transitionTickInitied||(this.tick(this._transitionTick,!0),this._transitionTickInitied=!0),this.touch(),r.append||(this._transitions.length=0);var s=new Transition(this,r);return this._transitions.push(s),s},i.prototype.row=function(t){return this.align("row",t),this},i.prototype.column=function(t){return this.align("column",t),this},i.prototype.align=function(t,e){var n=this;return this._padding=this._padding,this._spacing=this._spacing,this._layoutTicker&&this.untick(this._layoutTicker),this.tick(this._layoutTicker=function(){if(n._mo_seq!=n._ts_touch){n._mo_seq=n._ts_touch;var r=n._mo_seqAlign!=n._ts_children;n._mo_seqAlign=n._ts_children;for(var s=0,o=0,a,h=n.first(!0),c=!0;a=h;){h=a.next(!0),a.matrix(!0);var _=a.pin("boxWidth"),p=a.pin("boxHeight");t=="column"?(!c&&(o+=n._spacing),a.pin("offsetY")!=o&&a.pin("offsetY",o),s=Math.max(s,_),o=o+p,r&&a.pin("alignX",e)):t=="row"&&(!c&&(s+=n._spacing),a.pin("offsetX")!=s&&a.pin("offsetX",s),s=s+_,o=Math.max(o,p),r&&a.pin("alignY",e)),c=!1}s+=2*n._padding,o+=2*n._padding,n.pin("width")!=s&&n.pin("width",s),n.pin("height")!=o&&n.pin("height",o)}}),this},i.prototype.box=function(){return this.minimize()},i.prototype.layer=function(){return this.maximize()},i.prototype.minimize=function(){var t=this;return this._padding=this._padding,this._layoutTicker&&this.untick(this._layoutTicker),this.tick(this._layoutTicker=function(){if(t._mo_box!=t._ts_touch){t._mo_box=t._ts_touch;for(var e=0,n=0,r,s=t.first(!0);r=s;){s=r.next(!0),r.matrix(!0);var o=r.pin("boxWidth"),a=r.pin("boxHeight");e=Math.max(e,o),n=Math.max(n,a)}e+=2*t._padding,n+=2*t._padding,t.pin("width")!=e&&t.pin("width",e),t.pin("height")!=n&&t.pin("height",n)}}),this},i.prototype.maximize=function(){var t=this;return this._layoutTicker&&this.untick(this._layoutTicker),this.tick(this._layoutTicker=function(){var e=t.parent();if(e){var n=e.pin("width");t.pin("width")!=n&&t.pin("width",n);var r=e.pin("height");t.pin("height")!=r&&t.pin("height",r)}},!0),this},i.prototype.padding=function(t){return this._padding=t,this},i.prototype.spacing=function(t){return this._spacing=t,this},i}();function sprite(i){var t=new Sprite;return i&&t.texture(i),t}var Sprite=function(i){__extends(t,i);function t(){var e=i.call(this)||this;return e._texture=null,e._image=null,e._tiled=!1,e._stretched=!1,e.prerenderContext={},e.label("Sprite"),e}return t.prototype.texture=function(e){return this._image=texture(e).one(),this._image?(this.pin("width",this._image.getWidth()),this.pin("height",this._image.getHeight()),this._tiled?this._texture=new ResizableTexture(this._image,"tile"):this._stretched?this._texture=new ResizableTexture(this._image,"stretch"):this._texture=new PipeTexture(this._image)):(this.pin("width",0),this.pin("height",0),this._texture=null),this},t.prototype.image=function(e){return this.texture(e)},t.prototype.tile=function(e){this._tiled=!0;var n=new ResizableTexture(this._image,"tile");return this._texture=n,this},t.prototype.stretch=function(e){this._stretched=!0;var n=new ResizableTexture(this._image,"stretch");return this._texture=n,this},t.prototype.prerenderTexture=function(){if(this._image){var e=this.getDevicePixelRatio();this.prerenderContext.pixelRatio=e;var n=this._image.prerender(this.prerenderContext);if(n===!0){var r=this._image.getWidth(),s=this._image.getHeight();this.size(r,s)}}},t.prototype.renderTexture=function(e){this._texture&&(this._texture._resizeMode&&(this._texture.dw=this.pin("width"),this._texture.dh=this.pin("height")),this._texture.draw(e))},t}(Component);(function(i){__extends(t,i);function t(){var e=i.call(this,document.createElement("canvas"))||this;return e._lastPixelRatio=0,e}return t.prototype.setSize=function(e,n,r){r===void 0&&(r=1),this._source.width=e*r,this._source.height=n*r,this._pixelRatio=r},t.prototype.getContext=function(e,n){return e===void 0&&(e="2d"),this._source.getContext(e,n)},t.prototype.getDevicePixelRatio=function(){return this._lastPixelRatio},t.prototype.getOptimalPixelRatio=function(){return this.getDevicePixelRatio()},t.prototype.setMemoizer=function(e){this._memoizer=e},t.prototype.setDrawer=function(e){this._drawer=e},t.prototype.prerender=function(e){var n=e.pixelRatio,r=this._lastPixelRatio,s=r/n,o=r===0||s>1.25||s<.8;o&&(this._lastPixelRatio=n);var a=this._memoizer?this._memoizer.call(this):null,h=this._lastMemoKey!==a;if(o||h)return this._lastMemoKey=a,this._lastPixelRatio=n,typeof this._drawer=="function"&&this._drawer.call(this),!0},t.prototype.size=function(e,n,r){return this.setSize(e,n,r),this},t.prototype.context=function(e,n){return e===void 0&&(e="2d"),this.getContext(e,n)},t.prototype.canvas=function(e){return typeof e=="function"?e.call(this,this.getContext()):typeof e>"u"&&typeof this._drawer=="function"&&this._drawer.call(this),this},t})(ImageTexture);var POINTER_CLICK="click",POINTER_DOWN="touchstart mousedown",POINTER_MOVE="touchmove mousemove",POINTER_UP="touchend mouseup",EventPoint=function(){function i(){}return i.prototype.clone=function(t){return t?(t.x=this.x,t.y=this.y):t={x:this.x,y:this.y},t},i.prototype.toString=function(){return(this.x|0)+"x"+(this.y|0)},i}(),PointerSyntheticEvent=function(){function i(){this.abs=new EventPoint}return i.prototype.clone=function(t){return t?(t.x=this.x,t.y=this.y):t={x:this.x,y:this.y},t},i.prototype.toString=function(){return this.type+": "+(this.x|0)+"x"+(this.y|0)},i}(),VisitPayload=function(){function i(){this.type="",this.x=0,this.y=0,this.timeStamp=-1,this.event=null,this.root=null,this.collected=null}return i.prototype.toString=function(){return this.type+": "+(this.x|0)+"x"+(this.y|0)},i}(),syntheticEvent=new PointerSyntheticEvent,PAYLOAD=new VisitPayload,Pointer=function(){function i(){var t=this;this.ratio=1,this.clickList=[],this.cancelList=[],this.handleStart=function(e){i.DEBUG&&console.debug&&console.debug("pointer-start",e.type),e.preventDefault(),t.localPoint(e),t.dispatchEvent(e.type,e),t.findTargets("click",t.clickList),t.findTargets("mousecancel",t.cancelList)},this.handleMove=function(e){e.preventDefault(),t.localPoint(e),t.dispatchEvent(e.type,e)},this.handleEnd=function(e){var n;e.preventDefault(),i.DEBUG&&console.debug&&console.debug("pointer-end",e.type),t.dispatchEvent(e.type,e),t.clickList.length&&(i.DEBUG&&console.debug&&console.debug("pointer-click: ",e.type,(n=t.clickList)===null||n===void 0?void 0:n.length),t.dispatchEvent("click",e,t.clickList)),t.cancelList.length=0},this.handleCancel=function(e){var n;t.cancelList.length&&(i.DEBUG&&console.debug&&console.debug("pointer-cancel",e.type,(n=t.clickList)===null||n===void 0?void 0:n.length),t.dispatchEvent("mousecancel",e,t.cancelList)),t.clickList.length=0},this.visitStart=function(e,n){return!e._flag(n.type)},this.visitEnd=function(e,n){syntheticEvent.raw=n.event,syntheticEvent.type=n.type,syntheticEvent.timeStamp=n.timeStamp,syntheticEvent.abs.x=n.x,syntheticEvent.abs.y=n.y;var r=e.listeners(n.type);if(r){e.matrix().inverse().map(n,syntheticEvent);var s=e===n.root||e.attr("spy")||e.hitTest(syntheticEvent);if(s&&(n.collected&&n.collected.push(e),n.event)){for(var o=!1,a=0;a<r.length;a++)o=r[a].call(e,syntheticEvent)?!0:o;return o}}}}return i.prototype.mount=function(t,e){var n=this;return this.stage=t,this.elem=e,this.ratio=t.viewport().ratio||1,t.on("viewport",function(r){var s;n.ratio=(s=r.ratio)!==null&&s!==void 0?s:n.ratio}),e.addEventListener("touchstart",this.handleStart),e.addEventListener("touchend",this.handleEnd),e.addEventListener("touchmove",this.handleMove),e.addEventListener("touchcancel",this.handleCancel),e.addEventListener("mousedown",this.handleStart),e.addEventListener("mouseup",this.handleEnd),e.addEventListener("mousemove",this.handleMove),document.addEventListener("mouseup",this.handleCancel),window.addEventListener("blur",this.handleCancel),this},i.prototype.unmount=function(){var t=this.elem;return t.removeEventListener("touchstart",this.handleStart),t.removeEventListener("touchend",this.handleEnd),t.removeEventListener("touchmove",this.handleMove),t.removeEventListener("touchcancel",this.handleCancel),t.removeEventListener("mousedown",this.handleStart),t.removeEventListener("mouseup",this.handleEnd),t.removeEventListener("mousemove",this.handleMove),document.removeEventListener("mouseup",this.handleCancel),window.removeEventListener("blur",this.handleCancel),this},i.prototype.localPoint=function(t){var e,n=this.elem,r,s;!((e=t.touches)===null||e===void 0)&&e.length?(r=t.touches[0].clientX,s=t.touches[0].clientY):(r=t.clientX,s=t.clientY);var o=n.getBoundingClientRect();r-=o.left,s-=o.top,r-=n.clientLeft|0,s-=n.clientTop|0,PAYLOAD.x=r*this.ratio,PAYLOAD.y=s*this.ratio},i.prototype.findTargets=function(t,e){var n=PAYLOAD;n.type=t,n.root=this.stage,n.event=null,n.collected=e,n.collected.length=0,this.stage.visit({reverse:!0,visible:!0,start:this.visitStart,end:this.visitEnd},n)},i.prototype.dispatchEvent=function(t,e,n){var r=PAYLOAD;if(r.type=t,r.root=this.stage,r.event=e,r.timeStamp=Date.now(),r.collected=null,t!=="mousemove"&&t!=="touchmove"&&i.DEBUG&&console.debug&&console.debug("pointer:dispatchEvent",r,n==null?void 0:n.length),n){for(;n.length;){var s=n.shift();if(this.visitEnd(s,r))break}n.length=0}else this.stage.visit({reverse:!0,visible:!0,start:this.visitStart,end:this.visitEnd},r)},i.DEBUG=!1,i}();function mount(i){i===void 0&&(i={});var t=new Root;return t.mount(i),t.pointer=new Pointer().mount(t,t.dom),t}var Root=function(i){__extends(t,i);function t(){var e=i.call(this)||this;return e.canvas=null,e.dom=null,e.context=null,e.pixelWidth=-1,e.pixelHeight=-1,e.pixelRatio=1,e.drawingWidth=0,e.drawingHeight=0,e.mounted=!1,e.paused=!1,e.sleep=!1,e.mount=function(n){if(n===void 0&&(n={}),typeof n.canvas=="string"?(e.canvas=document.getElementById(n.canvas),e.canvas||console.error("Canvas element not found: ",n.canvas)):n.canvas instanceof HTMLCanvasElement?e.canvas=n.canvas:n.canvas&&console.error("Unknown value for canvas:",n.canvas),e.canvas||(e.canvas=document.getElementById("cutjs")||document.getElementById("stage")),!e.canvas){console.debug&&console.debug("Creating canvas element..."),e.canvas=document.createElement("canvas"),Object.assign(e.canvas.style,{position:"absolute",display:"block",top:"0",left:"0",bottom:"0",right:"0",width:"100%",height:"100%"});var r=document.body;r.insertBefore(e.canvas,r.firstChild)}e.dom=e.canvas,e.context=e.canvas.getContext("2d"),e.devicePixelRatio=window.devicePixelRatio||1,e.backingStoreRatio=e.context.webkitBackingStorePixelRatio||e.context.mozBackingStorePixelRatio||e.context.msBackingStorePixelRatio||e.context.oBackingStorePixelRatio||e.context.backingStorePixelRatio||1,e.pixelRatio=e.devicePixelRatio/e.backingStoreRatio,e.mounted=!0,e.requestFrame()},e.frameRequested=!1,e.requestFrame=function(){e.frameRequested||(e.frameRequested=!0,requestAnimationFrame(e.onFrame))},e._lastFrameTime=0,e._mo_touch=null,e.onFrame=function(n){if(e.frameRequested=!1,!(!e.mounted||!e.canvas||!e.context)){e.requestFrame();var r=e.canvas.clientWidth,s=e.canvas.clientHeight;(e.pixelWidth!==r||e.pixelHeight!==s)&&(e.pixelWidth=r,e.pixelHeight=s,e.drawingWidth=r*e.pixelRatio,e.drawingHeight=s*e.pixelRatio,(e.canvas.width!==e.drawingWidth||e.canvas.height!==e.drawingHeight)&&(e.canvas.width=e.drawingWidth,e.canvas.height=e.drawingHeight,console.debug&&console.debug("Resize: ["+e.drawingWidth+", "+e.drawingHeight+"] = "+e.pixelRatio+" x ["+e.pixelWidth+", "+e.pixelHeight+"]"),e.viewport({width:e.drawingWidth,height:e.drawingHeight,ratio:e.pixelRatio})));var o=e._lastFrameTime||n,a=n-o;if(!(!e.mounted||e.paused||e.sleep)){e._lastFrameTime=n,e.prerender();var h=e._tick(a,n,o);e._mo_touch!=e._ts_touch?(e._mo_touch=e._ts_touch,e.sleep=!1,e.drawingWidth>0&&e.drawingHeight>0&&(e.context.setTransform(1,0,0,1,0,0),e.context.clearRect(0,0,e.drawingWidth,e.drawingHeight),e.debugDrawAxis>0&&e.renderDebug(e.context),e.render(e.context))):h?e.sleep=!1:e.sleep=!0,stats.fps=a?1e3/a:0}}},e.debugDrawAxis=0,e.label("Root"),e}return t.prototype.renderDebug=function(e){var n=typeof this.debugDrawAxis=="number"?this.debugDrawAxis:10,r=this.matrix();e.setTransform(r.a,r.b,r.c,r.d,r.e,r.f);var s=3/r.a;e.beginPath(),e.moveTo(0,0),e.lineTo(0,.8*n),e.lineTo(-.2*n,.8*n),e.lineTo(0,n),e.lineTo(.2*n,.8*n),e.lineTo(0,.8*n),e.strokeStyle="rgba(93, 173, 226)",e.lineJoin="round",e.lineCap="round",e.lineWidth=s,e.stroke(),e.beginPath(),e.moveTo(0,0),e.lineTo(.8*n,0),e.lineTo(.8*n,-.2*n),e.lineTo(n,0),e.lineTo(.8*n,.2*n),e.lineTo(.8*n,0),e.strokeStyle="rgba(236, 112, 99)",e.lineJoin="round",e.lineCap="round",e.lineWidth=s,e.stroke()},t.prototype.resume=function(){return(this.sleep||this.paused)&&this.requestFrame(),this.paused=!1,this.sleep=!1,this.publish("resume"),this},t.prototype.pause=function(){return this.paused||this.publish("pause"),this.paused=!0,this},t.prototype.touch=function(){return(this.sleep||this.paused)&&this.requestFrame(),this.sleep=!1,i.prototype.touch.call(this)},t.prototype.unmount=function(){var e;return this.mounted=!1,(e=this.pointer)===null||e===void 0||e.unmount(),this},t.prototype.background=function(e){return this.dom&&(this.dom.style.backgroundColor=e),this},t.prototype.viewport=function(e,n,r){if(typeof e>"u")return Object.assign({},this._viewport);if(typeof e=="object"){var s=e;e=s.width,n=s.height,r=s.ratio}if(typeof e=="number"&&typeof n=="number"){this._viewport={width:e,height:n,ratio:typeof r=="number"?r:1},this.viewbox();var o=Object.assign({},this._viewport);this.visit({start:function(a){if(!a._flag("viewport"))return!0;a.publish("viewport",[o])}})}return this},t.prototype.viewbox=function(e,n,r){return typeof e=="number"&&typeof n=="number"?this._viewbox={width:e,height:n,mode:r}:typeof e=="object"&&e!==null&&(this._viewbox=__assign({},e)),this.rescale(),this},t.prototype.camera=function(e){return this._camera=e,this.rescale(),this},t.prototype.rescale=function(){var e=this._viewbox,n=this._viewport,r=this._camera;if(n&&e){var s=n.width,o=n.height,a=isValidFitMode(e.mode)?e.mode:"in-pad",h=e.width,c=e.height;this.pin({width:h,height:c}),this.fit(s,o,a);var _=e.x||0,p=e.y||0,g=(r==null?void 0:r.a)||1,m=(r==null?void 0:r.d)||1,d=(r==null?void 0:r.e)||0,l=(r==null?void 0:r.f)||0,u=this.pin("scaleX"),v=this.pin("scaleY");this.pin("scaleX",u*g),this.pin("scaleY",v*m),this.pin("offsetX",d-_*u*g),this.pin("offsetY",l-p*v*m)}else n&&this.pin({width:n.width,height:n.height});return this},t.prototype.flipX=function(e){return this._pin._directionX=e?-1:1,this},t.prototype.flipY=function(e){return this._pin._directionY=e?-1:1,this},t}(Component),FPS=15;(function(i){__extends(t,i);function t(){var e=i.call(this)||this;return e._texture=null,e._frames=[],e._time=-1,e._repeat=0,e._index=0,e._animTickLastTime=0,e._animTick=function(n,r,s){if(!(e._time<0||e._frames.length<=1)){var o=e._animTickLastTime!=s;if(e._animTickLastTime=r,o||(e._time+=n,e._time<e._ft))return!0;var a=e._time/e._ft|0;return e._time-=a*e._ft,e.moveFrame(a),e._repeat>0&&(e._repeat-=a)<=0?(e.stop(),e._callback&&e._callback(),!1):!0}},e.label("Anim"),e._fps=FPS,e._ft=1e3/e._fps,e.tick(e._animTick,!1),e}return t.prototype.renderTexture=function(e){this._texture&&this._texture.draw(e)},t.prototype.fps=function(e){return typeof e>"u"?this._fps:(this._fps=e>0?e:FPS,this._ft=1e3/this._fps,this)},t.prototype.setFrames=function(e){return this.frames(e)},t.prototype.frames=function(e){return this._index=0,this._frames=texture(e).array(),this.touch(),this},t.prototype.length=function(){return this._frames?this._frames.length:0},t.prototype.gotoFrame=function(e,n){return n===void 0&&(n=!1),this._index=math.wrap(e,this._frames.length)|0,n=n||!this._texture,this._texture=this._frames[this._index],n&&(this.pin("width",this._texture.getWidth()),this.pin("height",this._texture.getHeight())),this.touch(),this},t.prototype.moveFrame=function(e){return this.gotoFrame(this._index+e)},t.prototype.repeat=function(e,n){return this._repeat=e*this._frames.length-1,this._callback=n,this.play(),this},t.prototype.play=function(e){return typeof e<"u"?(this.gotoFrame(e),this._time=0):this._time<0&&(this._time=0),this.touch(),this},t.prototype.stop=function(e){return this._time=-1,typeof e<"u"&&this.gotoFrame(e),this},t})(Component);function monotype(i){return new Monotype().frames(i)}var Monotype=function(i){__extends(t,i);function t(){var e=i.call(this)||this;return e._textures=[],e.label("Monotype"),e}return t.prototype.renderTexture=function(e){if(!(!this._textures||!this._textures.length))for(var n=0,r=this._textures.length;n<r;n++)this._textures[n].draw(e)},t.prototype.setFont=function(e){return this.frames(e)},t.prototype.frames=function(e){if(this._textures=[],typeof e=="string"){var n=texture(e);this._font=function(r){return n.one(r)}}else typeof e=="object"?this._font=function(r){return e[r]}:typeof e=="function"&&(this._font=e);return this},t.prototype.setValue=function(e){return this.value(e)},t.prototype.value=function(e){if(typeof e>"u")return this._value;if(this._value===e)return this;this._value=e,e===null?e="":typeof e!="string"&&!Array.isArray(e)&&(e=e.toString()),this._spacing=this._spacing||0;for(var n=0,r=0,s=0;s<e.length;s++){var o=e[s],a=this._textures[s]=this._font(typeof o=="string"?o:o+"");n+=s>0?this._spacing:0,a.setDestinationCoordinate(n,0),n=n+a.getWidth(),r=Math.max(r,a.getHeight())}return this.pin("width",n),this.pin("height",r),this._textures.length=e.length,this},t}(Component);const WIDTH=4,HEIGHT=4,NEXT_TILE_TIME=1e3,ANIMATE_COLLECT_TIME=600,COLORS=["blue","red","yellow","green","purple"];class TileSprite extends Sprite{constructor(t){super(),this.__memo=Memo.init(),this.__size=t,this.pin({handle:.5})}enter(t){this.__memo.update(t.i,t.j),this.offset(t.i*this.__size,t.j*this.__size),this.scale(.1,.1),this.tween(100).scale(1,1)}slide(t){this.__memo.update(t.i,t.j)&&this.tween(100).offset(t.i*this.__size,t.j*this.__size).scale(1,1)}exit(t,e=!1){if(e){const n=ANIMATE_COLLECT_TIME/6;this.tween(n).offset(t.i*this.__size,t.j*this.__size).scale(1,1).tween(n).pin("alpha",0).tween(n).pin("alpha",1).tween(n).pin("alpha",0).tween(n).pin("alpha",1).tween(n).scale(.1,.1).remove()}else this.tween(100).scale(.1,.1).remove()}}const urlAlphabet="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let nanoid=(i=21)=>{let t="",e=crypto.getRandomValues(new Uint8Array(i|=0));for(;i--;)t+=urlAlphabet[e[i]&63];return t};const clearTimeline=i=>{i.timeline.length=0},stepTimeline=(i,t)=>{const e=i.timeline;if(!e.length)return!1;let n=e[0];if(n.finished&&(e.shift(),n=e[0]),!n)return!1;if(n.started||(n.started=!0),n.step(t),n.finished){const r=e.indexOf(n);e.splice(r,1)}},runTask=(i,t)=>{i.timeline.unshift(...t)};class TimeoutTask{constructor(t,e,n){this.callback=t,this.timeout=e,this.name=n}step(t){if(this.timeout>=0&&(this.timeout-=t,this.timeout<0))return this.finished=!0,this.callback()}toString(){return(this.started?"s":"-")+(this.finished?"f":"-")+" "+this.name+" "+this.timeout}}const timeoutTask=(i,t,e)=>new TimeoutTask(i,t,e);performance.now();const randomColor=()=>COLORS[Math.floor(Math.random()*COLORS.length)];class Cell{constructor(t,e){this.key="cell="+nanoid(8),this.type="cell",this.position={i:0,j:0},this.position.i=t,this.position.j=e}}class Tile{constructor(t,e){this.key="tile="+nanoid(8),this.type="tile",this.position={i:0,j:0},this.position.i=t.i,this.position.j=t.j,this.color=e}}class Board{constructor(){this.tiles=[],this.cells=[],this.cellMap={},this.timeline=[]}}const createBoard=(i,t)=>{const e=new Board;for(let n=0;n<i;n++)for(let r=0;r<t;r++){const s=new Cell(n,r);addCell(e,s)}return e},clearTiles=i=>{for(let t=i.tiles.length-1;t>=0;t--)removeTile(i,i.tiles[t])},slideBoard=(i,t)=>{let e=!1,n=!0;for(;n;){n=!1;for(let r=0;r<i.tiles.length;r++){const s=i.tiles[r];n=moveTile(i,s,t)||n}e=n||e}return e},collectBoard=i=>{const t=[],e=[],n=+new Date;t.length=0;for(let r=0;r<i.tiles.length;r++)e.length=0,matchTile(i,i.tiles[r],n,e),e.length>2&&t.push(...e);return t},matchBoard=(i,t)=>{const e=collectBoard(i);let n=0;for(let r=0;r<e.length;r++){const s=e[r];s.animateExit=t,removeTile(i,s)&&n++}return n},getTile=(i,t,e)=>{const n=getCell(i,t,e);return n?n.tile:void 0},getCell=(i,t,e)=>{const n=t+":"+e;return i.cellMap[n]},addCell=(i,t)=>{const e=t.position.i+":"+t.position.j;return i.cellMap[e]?!1:(i.cellMap[e]=t,i.cells.push(t),!0)},randomEmptyCell=i=>{const t=[];for(let e=i.cells.length-1;e>=0;e--){const n=i.cells[e];!n.tile&&t.push(n)}return t.length?t[Math.random()*t.length|0]:null},insertTile=(i,t)=>{const e=getCell(i,t.position.i,t.position.j);return e?(placeTile(i,t,e),i.tiles.push(t),!0):!1},moveTile=(i,t,e)=>{const n=getCell(i,t.position.i+e.i,t.position.j+e.j);return!n||n.tile?!1:(placeTile(i,t,n),!0)},placeTile=(i,t,e)=>{t.cell&&(t.cell.tile=null,t.cell=null),e.tile=t,t.cell=e,t.position.i=e.position.i,t.position.j=e.position.j},removeTile=(i,t)=>{const e=t.cell;if(!e)return!1;e.tile=null,t.cell=null;const n=i.tiles.indexOf(t);return n>=0?(i.tiles.splice(n,1),!0):!1},matchTile=(i,t,e,n,r)=>{if(!t||t._search==e)return!1;if(typeof r>"u")r=t.color;else if(r!==t.color)return!1;t._search=e,n.push(t),matchTile(i,getTile(i,t.position.i,t.position.j-1),e,n,r),matchTile(i,getTile(i,t.position.i,t.position.j+1),e,n,r),matchTile(i,getTile(i,t.position.i-1,t.position.j),e,n,r),matchTile(i,getTile(i,t.position.i+1,t.position.j),e,n,r)},isGameover=i=>i.cells.length<=i.tiles.length,currentScorePin={alignX:.05,alignY:0,handleX:0,handleY:1,offsetY:-14,alpha:1},maxScorePin={alignX:.95,alignY:0,handleX:1,handleY:1,offsetY:-14,alpha:.3};class Terminal extends Middleware{constructor(){super(),this.size=32,this.lastMaxScore=-1,this.mouseX=0,this.mouseY=0,this.mouseStarted=!1,this.handleViewport=t=>{const e=this.context.stage,n=t.width,r=t.height,s=t.ratio;e.viewbox(Math.max(n/s/2,200),Math.max(r/s/2,250))},this.handleActivate=()=>{const t=this.context.stage;t.on("viewport",this.handleViewport),this.handleViewport(t.viewport()),this.board=component(),this.board.appendTo(t),this.board.pin({width:WIDTH*this.size,height:HEIGHT*this.size,align:.5,handleY:.2,handleX:.5}),this.tiles=component(),this.tiles.appendTo(this.board),this.tiles.offset(this.size/2,this.size/2),this.header=component(),this.header.appendTo(this.board),this.header.pin({width:WIDTH*this.size}),this.logo=sprite("logo"),this.logo.appendTo(this.header),this.logo.pin({offsetX:1,offsetY:-80,scale:1.05}),this.currentScore=monotype("digit"),this.currentScore.appendTo(this.board),this.currentScore.pin(currentScorePin),this.maxScore=monotype("digit"),this.maxScore.appendTo(this.board),this.maxScore.pin(maxScorePin),this.board.on(POINTER_CLICK,()=>{this.context.gameover&&this.emit("user-start")}),t.on(POINTER_DOWN,this.handleMouseStart),t.on(POINTER_MOVE,this.handleMouseMove),t.on(POINTER_UP,this.handleMouseEnd),window.addEventListener("keydown",this.handleKeyDown),this.context.maxScore?this.maxScore.value(this.context.maxScore+"S"):this.maxScore.hide()},this.handleStart=()=>{this.header.tween({duration:1e3}).pin("alpha",.4),this.lastMaxScore>-1&&this.context.maxScore>this.lastMaxScore&&(this.maxScore.tween(200).alpha(0).remove(),this.maxScore=this.currentScore,this.maxScore.value(this.context.maxScore+"S"),this.maxScore.tween().pin(maxScorePin),this.currentScore=monotype("digit"),this.currentScore.appendTo(this.board),this.currentScore.pin(currentScorePin),this.currentScore.value("0").pin(currentScorePin)),this.lastMaxScore=this.context.maxScore||0},this.handleGameover=()=>{this.header.tween({duration:2e3}).pin("alpha",1),this.context.score>=this.context.maxScore&&(this.currentScore.value(this.context.score+"S"),this.maxScore.value(this.lastMaxScore+"s"))},this.handleFrameRender=()=>{this.context.gameover||(this.currentScore.value(this.context.score),this.binder.data([...this.context.board.cells,...this.context.board.tiles]))},this.cellDriver=Driver.create({filter:t=>t.type==="cell",enter:t=>{const e=new TileSprite(this.size);return e.texture("cell"),e.appendTo(this.tiles),e.enter(t.position),e},exit:(t,e)=>{e.exit(t.position)},update:(t,e)=>{}}),this.tileDriver=Driver.create({filter:t=>t.type==="tile",enter:t=>{const e=new TileSprite(this.size);return e.texture(t.color||""),e.appendTo(this.tiles),e.enter(t.position),e},exit:(t,e)=>{e.exit(t.position,t.animateExit)},update:(t,e)=>{e.slide(t.position)}}),this.binder=Binder.create({key:t=>t.key,drivers:[this.cellDriver,this.tileDriver]}),this.handleMouseStart=t=>{this.context.gameover||(this.mouseX=t.x,this.mouseY=t.y,this.mouseStarted=!0)},this.handleMouseMove=t=>{if(!this.mouseStarted)return;const e=t.x-this.mouseX,n=t.y-this.mouseY,r=Math.abs(e),s=Math.abs(n);r>s&&r>this.size/3?(this.emit("user-slide",{i:e>0?1:-1,j:0}),this.mouseStarted=!1):s>r&&s>this.size/3&&(this.emit("user-slide",{i:0,j:n>0?1:-1}),this.mouseStarted=!1)},this.handleMouseEnd=t=>{this.handleMouseMove(t),this.mouseStarted=!1},this.handleKeyDown=t=>{const e=t.keyCode;if(this.context.gameover){if(e==13||e==32)return this.emit("user-start"),!1}else{const n=(e==39?1:0)-(e==37?1:0),r=(e==40?1:0)-(e==38?1:0);if(n||r)return this.emit("user-slide",{i:n,j:r}),!1}},this.on("stage-ready",this.handleActivate),this.on("game-over",this.handleGameover),this.on("game-start",this.handleStart),this.on("frame-render",this.handleFrameRender)}}class FrameLoop extends Middleware{constructor(){super(),this.lastTime=0,this.event={dt:0,now:0},this.handleFrame=()=>{if(!this.activated)return;const t=performance.now(),e=t-this.lastTime;this.lastTime=t,this.event.now=t,this.event.dt=e,this.emit("frame-update",this.event),this.emit("frame-render",this.event),this.requestFrame()},this.requestFrame=()=>{this.activated&&window.requestAnimationFrame(this.handleFrame)},this.on("activate",this.handleActivate),this.on("deactivate",this.handleDeactivate)}handleActivate(){this.lastTime=performance.now(),this.requestFrame()}handleDeactivate(){}}class Gameplay extends Middleware{constructor(){super(),this.handleActivate=()=>{const t=createBoard(WIDTH,HEIGHT);this.context.board=t},this.handleFrameUpdate=t=>{var e,n;this.context.gameover||(stepTimeline(this.context.board,t.dt),this.context.nextTileTimeout>0&&(this.context.nextTileTimeout-=t.dt,this.context.nextTileTimeout<=0&&this.handleNextTimeout()),!this.context.board.tiles.length&&!((n=(e=this.context.board)==null?void 0:e.timeline)!=null&&n.length)&&this.addNewTile())},this.startGame=()=>{this.context.gameover=!1,this.context.score=0,this.context.inserted=0,this.context.nextTileTimeout=400,clearTiles(this.context.board),clearTimeline(this.context.board),this.emit("game-start")},this.handleNextTimeout=()=>{this.addNewTile()},this.resetNextTileTimeout=()=>{this.context.gameover||(this.context.nextTileTimeout=Math.max(NEXT_TILE_TIME-this.context.inserted,400))},this.checkGameover=()=>{this.context.gameover||isGameover(this.context.board)&&(this.context.gameover=!0,clearTimeline(this.context.board),(!this.context.maxScore||this.context.maxScore<this.context.score)&&(this.context.maxScore=this.context.score),this.emit("game-over"))},this.addNewTile=()=>{if(this.context.gameover)return;const t=randomEmptyCell(this.context.board);if(!t)return;const e=new Tile(t.position,randomColor());insertTile(this.context.board,e),this.context.inserted+=1,this.context.nextTileTimeout=-1,runTask(this.context.board,[timeoutTask(()=>{},100,"new-tile-delay"),timeoutTask(()=>this.collectTiles(),0,"new-tile-collect"),timeoutTask(()=>this.checkGameover(),0,"new-tile-check"),timeoutTask(()=>this.resetNextTileTimeout(),0,"new-tile-next")])},this.handleUserSlide=t=>{var n,r;(r=(n=this.context.board)==null?void 0:n.timeline)!=null&&r.length||!slideBoard(this.context.board,t)||(this.context.nextTileTimeout=-1,runTask(this.context.board,[timeoutTask(()=>{},100,"slide-delay"),timeoutTask(()=>this.collectTiles(),0,"slide-collect"),timeoutTask(()=>this.addNewTile(),0,"slide-add")]))},this.collectTiles=()=>{const t=this.context.score<12,e=matchBoard(this.context.board,t);if(!e)return;this.context.score+=e;const n=t?ANIMATE_COLLECT_TIME:0;runTask(this.context.board,[timeoutTask(()=>{},n,"collect-delay")])},this.on("activate",this.handleActivate),this.on("user-start",this.startGame),this.on("main-start",this.startGame),this.on("user-slide",this.handleUserSlide),this.on("frame-update",this.handleFrameUpdate)}}const textImage="/polymatic-example-tilebox/assets/text-DtOoBZQe.png",logoImage="/polymatic-example-tilebox/assets/logo-DjOb43rg.png",tileImage="/polymatic-example-tilebox/assets/tile-CnzgYii_.png";class Loader extends Middleware{constructor(){super(),this.handleActivate=async()=>{await atlas({image:{src:tileImage,ratio:4},ppu:32,textures:{"":{x:0,y:0,width:1,height:1},blue:{x:1,y:0,width:1,height:1},red:{x:2,y:0,width:1,height:1},yellow:{x:3,y:0,width:1,height:1},green:{x:4,y:0,width:1,height:1},purple:{x:5,y:0,width:1,height:1},orange:{x:6,y:0,width:1,height:1},cell:{x:7,y:0,width:1,height:1}}}),await atlas({image:{src:textImage,ratio:4},ppu:16,textures:{digit:{0:{x:0,y:0,width:.775,height:1},1:{x:1,y:0,width:.34375,height:1},2:{x:2,y:0,width:.65625,height:1},3:{x:3,y:0,width:.61875,height:1},4:{x:4,y:0,width:.71875,height:1},5:{x:5,y:0,width:.575,height:1},6:{x:6,y:0,width:.7,height:1},7:{x:7,y:0,width:.6375,height:1},8:{x:8,y:0,width:.65625,height:1},9:{x:9,y:0,width:.7,height:1},"-":{x:10,y:0,width:.49375,height:1},"+":{x:11,y:0,width:.7,height:1},"=":{x:12,y:0,width:.4125,height:1},s:{x:13,y:0,width:1,height:1},S:{x:14,y:0,width:1,height:1},o:{x:13,y:1,width:1,height:1},O:{x:14,y:1,width:1,height:1}}}}),await atlas({image:{src:logoImage,ratio:4},textures:{logo:{x:0,y:0,width:120,height:40}}}),this.context.stage=mount(),this.emit("stage-ready")},this.on("activate",this.handleActivate)}}var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var util,hasRequiredUtil;function requireUtil(){if(hasRequiredUtil)return util;hasRequiredUtil=1;var i=r(),t=s(),e=o(),n=typeof window<"u"?window:commonjsGlobal;util={assign:i,create:t,trim:e,bind:a,slice:h,each:c,map:_,pluck:p,isList:g,isFunction:m,isObject:d,Global:n};function r(){return Object.assign?Object.assign:function(u,v,x,w){for(var y=1;y<arguments.length;y++)c(Object(arguments[y]),function(b,S){u[S]=b});return u}}function s(){if(Object.create)return function(v,x,w,y){var b=h(arguments,1);return i.apply(this,[Object.create(v)].concat(b))};{let u=function(){};var l=u;return function(x,w,y,b){var S=h(arguments,1);return u.prototype=x,i.apply(this,[new u].concat(S))}}}function o(){return String.prototype.trim?function(u){return String.prototype.trim.call(u)}:function(u){return u.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}}function a(l,u){return function(){return u.apply(l,Array.prototype.slice.call(arguments,0))}}function h(l,u){return Array.prototype.slice.call(l,u||0)}function c(l,u){p(l,function(v,x){return u(v,x),!1})}function _(l,u){var v=g(l)?[]:{};return p(l,function(x,w){return v[w]=u(x,w),!1}),v}function p(l,u){if(g(l)){for(var v=0;v<l.length;v++)if(u(l[v],v))return l[v]}else for(var x in l)if(l.hasOwnProperty(x)&&u(l[x],x))return l[x]}function g(l){return l!=null&&typeof l!="function"&&typeof l.length=="number"}function m(l){return l&&{}.toString.call(l)==="[object Function]"}function d(l){return l&&{}.toString.call(l)==="[object Object]"}return util}var storeEngine,hasRequiredStoreEngine;function requireStoreEngine(){if(hasRequiredStoreEngine)return storeEngine;hasRequiredStoreEngine=1;var i=requireUtil(),t=i.slice,e=i.pluck,n=i.each,r=i.bind,s=i.create,o=i.isList,a=i.isFunction,h=i.isObject;storeEngine={createStore:p};var c={version:"2.0.12",enabled:!1,get:function(g,m){var d=this.storage.read(this._namespacePrefix+g);return this._deserialize(d,m)},set:function(g,m){return m===void 0?this.remove(g):(this.storage.write(this._namespacePrefix+g,this._serialize(m)),m)},remove:function(g){this.storage.remove(this._namespacePrefix+g)},each:function(g){var m=this;this.storage.each(function(d,l){g.call(m,m._deserialize(d),(l||"").replace(m._namespaceRegexp,""))})},clearAll:function(){this.storage.clearAll()},hasNamespace:function(g){return this._namespacePrefix=="__storejs_"+g+"_"},createStore:function(){return p.apply(this,arguments)},addPlugin:function(g){this._addPlugin(g)},namespace:function(g){return p(this.storage,this.plugins,g)}};function _(){var g=typeof console>"u"?null:console;if(g){var m=g.warn?g.warn:g.log;m.apply(g,arguments)}}function p(g,m,d){d||(d=""),g&&!o(g)&&(g=[g]),m&&!o(m)&&(m=[m]);var l=d?"__storejs_"+d+"_":"",u=d?new RegExp("^"+l):null,v=/^[a-zA-Z0-9_\-]*$/;if(!v.test(d))throw new Error("store.js namespaces can only have alphanumerics + underscores and dashes");var x={_namespacePrefix:l,_namespaceRegexp:u,_testStorage:function(y){try{var b="__storejs__test__";y.write(b,b);var S=y.read(b)===b;return y.remove(b),S}catch{return!1}},_assignPluginFnProp:function(y,b){var S=this[b];this[b]=function(){var T=t(arguments,0),E=this;function M(){if(S)return n(arguments,function(R,O){T[O]=R}),S.apply(E,T)}var k=[M].concat(T);return y.apply(E,k)}},_serialize:function(y){return JSON.stringify(y)},_deserialize:function(y,b){if(!y)return b;var S="";try{S=JSON.parse(y)}catch{S=y}return S!==void 0?S:b},_addStorage:function(y){this.enabled||this._testStorage(y)&&(this.storage=y,this.enabled=!0)},_addPlugin:function(y){var b=this;if(o(y)){n(y,function(T){b._addPlugin(T)});return}var S=e(this.plugins,function(T){return y===T});if(!S){if(this.plugins.push(y),!a(y))throw new Error("Plugins must be function values that return objects");var A=y.call(this);if(!h(A))throw new Error("Plugins must return an object of function properties");n(A,function(T,E){if(!a(T))throw new Error("Bad plugin property: "+E+" from plugin "+y.name+". Plugins should only return functions.");b._assignPluginFnProp(T,E)})}},addStorage:function(y){_("store.addStorage(storage) is deprecated. Use createStore([storages])"),this._addStorage(y)}},w=s(x,c,{plugins:[]});return w.raw={},n(w,function(y,b){a(y)&&(w.raw[b]=r(w,y))}),n(g,function(y){w._addStorage(y)}),n(m,function(y){w._addPlugin(y)}),w}return storeEngine}var localStorage_1,hasRequiredLocalStorage;function requireLocalStorage(){if(hasRequiredLocalStorage)return localStorage_1;hasRequiredLocalStorage=1;var i=requireUtil(),t=i.Global;localStorage_1={name:"localStorage",read:n,write:r,each:s,remove:o,clearAll:a};function e(){return t.localStorage}function n(h){return e().getItem(h)}function r(h,c){return e().setItem(h,c)}function s(h){for(var c=e().length-1;c>=0;c--){var _=e().key(c);h(n(_),_)}}function o(h){return e().removeItem(h)}function a(){return e().clear()}return localStorage_1}var oldFFGlobalStorage,hasRequiredOldFFGlobalStorage;function requireOldFFGlobalStorage(){if(hasRequiredOldFFGlobalStorage)return oldFFGlobalStorage;hasRequiredOldFFGlobalStorage=1;var i=requireUtil(),t=i.Global;oldFFGlobalStorage={name:"oldFF-globalStorage",read:n,write:r,each:s,remove:o,clearAll:a};var e=t.globalStorage;function n(h){return e[h]}function r(h,c){e[h]=c}function s(h){for(var c=e.length-1;c>=0;c--){var _=e.key(c);h(e[_],_)}}function o(h){return e.removeItem(h)}function a(){s(function(h,c){delete e[h]})}return oldFFGlobalStorage}var oldIEUserDataStorage,hasRequiredOldIEUserDataStorage;function requireOldIEUserDataStorage(){if(hasRequiredOldIEUserDataStorage)return oldIEUserDataStorage;hasRequiredOldIEUserDataStorage=1;var i=requireUtil(),t=i.Global;oldIEUserDataStorage={name:"oldIE-userDataStorage",write:o,read:a,each:h,remove:c,clearAll:_};var e="storejs",n=t.document,r=m(),s=(t.navigator?t.navigator.userAgent:"").match(/ (MSIE 8|MSIE 9|MSIE 10)\./);function o(d,l){if(!s){var u=g(d);r(function(v){v.setAttribute(u,l),v.save(e)})}}function a(d){if(!s){var l=g(d),u=null;return r(function(v){u=v.getAttribute(l)}),u}}function h(d){r(function(l){for(var u=l.XMLDocument.documentElement.attributes,v=u.length-1;v>=0;v--){var x=u[v];d(l.getAttribute(x.name),x.name)}})}function c(d){var l=g(d);r(function(u){u.removeAttribute(l),u.save(e)})}function _(){r(function(d){var l=d.XMLDocument.documentElement.attributes;d.load(e);for(var u=l.length-1;u>=0;u--)d.removeAttribute(l[u].name);d.save(e)})}var p=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");function g(d){return d.replace(/^\d/,"___$&").replace(p,"___")}function m(){if(!n||!n.documentElement||!n.documentElement.addBehavior)return null;var d="script",l,u,v;try{u=new ActiveXObject("htmlfile"),u.open(),u.write("<"+d+">document.w=window</"+d+'><iframe src="/favicon.ico"></iframe>'),u.close(),l=u.w.frames[0].document,v=l.createElement("div")}catch{v=n.createElement("div"),l=n.body}return function(x){var w=[].slice.call(arguments,0);w.unshift(v),l.appendChild(v),v.addBehavior("#default#userData"),v.load(e),x.apply(this,w),l.removeChild(v)}}return oldIEUserDataStorage}var cookieStorage,hasRequiredCookieStorage;function requireCookieStorage(){if(hasRequiredCookieStorage)return cookieStorage;hasRequiredCookieStorage=1;var i=requireUtil(),t=i.Global,e=i.trim;cookieStorage={name:"cookieStorage",read:r,write:o,each:s,remove:a,clearAll:h};var n=t.document;function r(_){if(!_||!c(_))return null;var p="(?:^|.*;\\s*)"+escape(_).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*";return unescape(n.cookie.replace(new RegExp(p),"$1"))}function s(_){for(var p=n.cookie.split(/; ?/g),g=p.length-1;g>=0;g--)if(e(p[g])){var m=p[g].split("="),d=unescape(m[0]),l=unescape(m[1]);_(l,d)}}function o(_,p){_&&(n.cookie=escape(_)+"="+escape(p)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/")}function a(_){!_||!c(_)||(n.cookie=escape(_)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/")}function h(){s(function(_,p){a(p)})}function c(_){return new RegExp("(?:^|;\\s*)"+escape(_).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(n.cookie)}return cookieStorage}var sessionStorage_1,hasRequiredSessionStorage;function requireSessionStorage(){if(hasRequiredSessionStorage)return sessionStorage_1;hasRequiredSessionStorage=1;var i=requireUtil(),t=i.Global;sessionStorage_1={name:"sessionStorage",read:n,write:r,each:s,remove:o,clearAll:a};function e(){return t.sessionStorage}function n(h){return e().getItem(h)}function r(h,c){return e().setItem(h,c)}function s(h){for(var c=e().length-1;c>=0;c--){var _=e().key(c);h(n(_),_)}}function o(h){return e().removeItem(h)}function a(){return e().clear()}return sessionStorage_1}var memoryStorage_1,hasRequiredMemoryStorage;function requireMemoryStorage(){if(hasRequiredMemoryStorage)return memoryStorage_1;hasRequiredMemoryStorage=1,memoryStorage_1={name:"memoryStorage",read:t,write:e,each:n,remove:r,clearAll:s};var i={};function t(o){return i[o]}function e(o,a){i[o]=a}function n(o){for(var a in i)i.hasOwnProperty(a)&&o(i[a],a)}function r(o){delete i[o]}function s(o){i={}}return memoryStorage_1}var all,hasRequiredAll;function requireAll(){return hasRequiredAll||(hasRequiredAll=1,all=[requireLocalStorage(),requireOldFFGlobalStorage(),requireOldIEUserDataStorage(),requireCookieStorage(),requireSessionStorage(),requireMemoryStorage()]),all}var json2$1={},hasRequiredJson2$1;function requireJson2$1(){return hasRequiredJson2$1||(hasRequiredJson2$1=1,typeof JSON!="object"&&(JSON={}),function(){var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;function f(i){return i<10?"0"+i:i}function this_value(){return this.valueOf()}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=this_value,Number.prototype.toJSON=this_value,String.prototype.toJSON=this_value);var gap,indent,meta,rep;function quote(i){return rx_escapable.lastIndex=0,rx_escapable.test(i)?'"'+i.replace(rx_escapable,function(t){var e=meta[t];return typeof e=="string"?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+i+'"'}function str(i,t){var e,n,r,s,o=gap,a,h=t[i];switch(h&&typeof h=="object"&&typeof h.toJSON=="function"&&(h=h.toJSON(i)),typeof rep=="function"&&(h=rep.call(t,i,h)),typeof h){case"string":return quote(h);case"number":return isFinite(h)?String(h):"null";case"boolean":case"null":return String(h);case"object":if(!h)return"null";if(gap+=indent,a=[],Object.prototype.toString.apply(h)==="[object Array]"){for(s=h.length,e=0;e<s;e+=1)a[e]=str(e,h)||"null";return r=a.length===0?"[]":gap?`[
`+gap+a.join(`,
`+gap)+`
`+o+"]":"["+a.join(",")+"]",gap=o,r}if(rep&&typeof rep=="object")for(s=rep.length,e=0;e<s;e+=1)typeof rep[e]=="string"&&(n=rep[e],r=str(n,h),r&&a.push(quote(n)+(gap?": ":":")+r));else for(n in h)Object.prototype.hasOwnProperty.call(h,n)&&(r=str(n,h),r&&a.push(quote(n)+(gap?": ":":")+r));return r=a.length===0?"{}":gap?`{
`+gap+a.join(`,
`+gap)+`
`+o+"}":"{"+a.join(",")+"}",gap=o,r}}typeof JSON.stringify!="function"&&(meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(i,t,e){var n;if(gap="",indent="",typeof e=="number")for(n=0;n<e;n+=1)indent+=" ";else typeof e=="string"&&(indent=e);if(rep=t,t&&typeof t!="function"&&(typeof t!="object"||typeof t.length!="number"))throw new Error("JSON.stringify");return str("",{"":i})}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){var j;function walk(i,t){var e,n,r=i[t];if(r&&typeof r=="object")for(e in r)Object.prototype.hasOwnProperty.call(r,e)&&(n=walk(r,e),n!==void 0?r[e]=n:delete r[e]);return reviver.call(i,t,r)}if(text=String(text),rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(i){return"\\u"+("0000"+i.charCodeAt(0).toString(16)).slice(-4)})),rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}()),json2$1}var json2,hasRequiredJson2;function requireJson2(){if(hasRequiredJson2)return json2;hasRequiredJson2=1,json2=i;function i(){return requireJson2$1(),{}}return json2}var store_legacy,hasRequiredStore_legacy;function requireStore_legacy(){if(hasRequiredStore_legacy)return store_legacy;hasRequiredStore_legacy=1;var i=requireStoreEngine(),t=requireAll(),e=[requireJson2()];return store_legacy=i.createStore(t,e),store_legacy}var store_legacyExports=requireStore_legacy();const store=getDefaultExportFromCjs(store_legacyExports),KEY="tilebox-v1-max";class DataStore extends Middleware{constructor(){super(),this.handleActivate=()=>{const t=store.get(KEY);t>0&&(this.context.maxScore=t)},this.handleGameover=()=>{store.set(KEY,this.context.maxScore)},this.on("activate",this.handleActivate),this.on("game-over",this.handleGameover)}}class MainContext{constructor(){this.score=0,this.inserted=0,this.gameover=!1,this.nextTileTimeout=0,this.maxScore=0}}class Main extends Middleware{constructor(){super(),this.handleStageReady=()=>{this.use(new Terminal),this.use(new Gameplay),this.emit("main-start")},this.use(new Loader),this.use(new FrameLoop),this.use(new DataStore),this.on("stage-ready",this.handleStageReady)}}Middleware.activate(new Main,new MainContext);
