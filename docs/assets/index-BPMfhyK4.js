(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=e(n);fetch(n.href,s)}})();/**
 * Polymatic v0.0.12
 * @copyright Copyright 2026 Ali Shakiba
 * @license Licensed under the MIT (https://github.com/piqnt/polymatic/blob/main/LICENSE.md)
 */function getOption(i){try{const t=localStorage.getItem(i);if(t)return t}catch{}try{const t=sessionStorage.getItem(i);if(t)return t}catch{}}function isEnabled(i,t){let e=getOption(i+"_exclude"),r=getOption(i+"_include");try{if(e&&t.match(e))return!1}catch(n){console.log(n)}try{if(r&&t.match(r))return!0}catch(n){console.log(n)}return!1}function debug(i,t){const e=isEnabled("debug",i),r=isEnabled("trace",i);return e?(...n)=>{t&&!t(...n)||(console.log(i,...n),r&&console.trace())}:()=>{}}function watch(i,t){const e=isEnabled("watch",i),r=isEnabled("trace",i);return e?new Proxy(t,{set(n,s,o,a){return console.debug(i,".",s.toString(),n[s],"↬",o),r&&console.trace(),Reflect.set(n,s,o,a)}}):t}const debugEvent=debug("middleware.event",i=>!(i!=null&&i.endsWith("-move")||i==="hotsyncWorld")),debugMiddleware=debug("middleware.lifecycle");class Middleware{constructor(){this.__handlers={},this.__children=[],this.__parent=null,this._swap=t=>{const e=this.__children,r=[],n=[];for(const s of t)e.indexOf(s)===-1&&n.push(s);for(const s of e)t.indexOf(s)===-1&&r.push(s);this.__children=t;for(const s of r)s.__detach();for(const s of n)s.__attach(this)}}get activated(){return this.__parent&&this.__parent.activated}use(t){this.__children.indexOf(t)===-1&&(this.activated&&t.__attach(this),this.__children.push(t))}unuse(t){const e=this.__children.indexOf(t);e!==-1&&(this.__children.splice(e,1),t==null||t.__detach())}__attach(t){if(!this.__parent){this.__parent=t,debugMiddleware("activate","+",this.constructor.name),this._handle("activate");for(let e=0;e<this.__children.length;e++)this.__children[e].__attach(this)}}__detach(){if(this.__parent){debugMiddleware("deactivate","-",this.constructor.name),this._handle("deactivate");for(let t=0;t<this.__children.length;t++)this.__children[t].__detach();this.__parent=null}}get context(){return this.__parent?this.__parent.context:null}setContext(t){this.__parent?this.__parent.setContext(t):console.error("Middleware is not activated")}on(t,e){if(this.__handlers[t])throw Error(`Handler for ${t} already exists`);this.__handlers[t]=e}_consume(t,e){if(this._handle(t,e))return!0;for(let n=0;n<this.__children.length;n++)if(this.__children[n]._consume(t,e))return!0;return!1}_handle(t,e){if(!this.activated)return;const r=this.__handlers&&this.__handlers[t];return!!(r&&typeof r=="function"&&(debugEvent(t,"→",this.constructor.name,e),r.call(this,e)===!0))}emit(t,e){this.activated&&(debugEvent(t,"↑",this.constructor.name,e),this.__parent?this.__parent.emit(t,e):console.error(Error("Not active!")))}static activate(t,e){return Runtime.activate(t,e)}}class Runtime extends Middleware{constructor(){super(...arguments),this.__handlers={},this.__children=[],this._activated=!1,this.contextUpdateEmit=()=>{this.emit("context-change")}}get activated(){return this._activated}_activate(t){if(!this._activated){t=watch("middleware.context",t),this._context=t,this._activated=!0,this._handle("activate");for(let e=0;e<this.__children.length;e++)this.__children[e].__attach(this)}}_deactivate(){if(this._activated){this._activated=!1,this._handle("deactivate");for(let t=0;t<this.__children.length;t++)this.__children[t].__detach()}}get context(){return this._context}setContext(t){if(typeof t!="function"){console.error("Setter is not a function: ",t);return}t(this.context),clearTimeout(this.contextUpdateEmitTimeout),this.contextUpdateEmitTimeout=setTimeout(this.contextUpdateEmit)}emit(t,e){setTimeout(()=>{this._consume(t,e)})}static activate(t,e){const r=new Runtime;r.use(t),r._activate(e)}static deactivate(t){if("_deactivate"in t&&typeof t._deactivate=="function")return t._deactivate(),!0;const e=t.__parent;return e&&"_deactivate"in e&&typeof e._deactivate=="function"?(e._deactivate(),!0):!1}}class Driver{constructor(){this._componentsById={}}static create(t){return new class extends Driver{constructor(){super(...arguments),this.filter=t.filter,this.enter=t.enter,this.exit=t.exit,this.update=t.update}}}ref(t){return this._componentsById[t]}}class Binder{constructor(){this._drivers=[],this._map={},this._mapBuffer={},this._updateBuffer=[],this._enterBuffer=[],this._exitBuffer=[]}static create(t){return new class extends Binder{constructor(){super(...arguments),this.key=t.key,this._drivers=t.drivers?[...t.drivers]:[]}}}addDriver(t){if(!(t&&t.filter&&t.enter&&t.exit&&t.update))throw"Invalid driver: "+t;return this._drivers.push(t),this}data(t){if(!Array.isArray(t))throw"Invalid data: "+t;this._enterBuffer.length=0,this._exitBuffer.length=0,this._updateBuffer.length=t.length;for(let r=0;r<t.length;r++){const n=t[r];if(typeof n!="object"||n===null)continue;const s=this.key(n);this._map[s]?delete this._map[s]:this._enterBuffer.push(n),this._updateBuffer[r]=n,this._mapBuffer[s]=n}for(const r in this._map)this._exitBuffer.push(this._map[r]),delete this._map[r];const e=this._map;this._map=this._mapBuffer,this._mapBuffer=e;for(let r=0;r<this._exitBuffer.length;r++){const n=this._exitBuffer[r],s=this.key(n);for(const o of this._drivers){if(o.filter(n)){const a=o._componentsById[s];o.exit(n,a)}delete o._componentsById[s]}}for(let r=0;r<this._enterBuffer.length;r++){const n=this._enterBuffer[r],s=this.key(n);for(const o of this._drivers)if(o.filter(n)){const a=o.enter(n);a&&(o._componentsById[s]=a)}}for(let r=0;r<this._updateBuffer.length;r++){if(typeof t[r]!="object"||t[r]===null)continue;const n=this._updateBuffer[r],s=this.key(n);for(const o of this._drivers)if(o.filter(n)){const a=o._componentsById[s];o.update(n,a)}}this._enterBuffer.length=0,this._exitBuffer.length=0,this._updateBuffer.length=0}}class Memo{constructor(){this.memory=[]}static init(...t){const e=new Memo;return t.length&&e.update(...t),e}update(...t){let e=this.memory.length===t.length;for(let r=0;r<t.length;r++)e=e&&this.memory[r]===t[r],this.memory[r]=t[r];return this.memory.length=t.length,!e}clear(){this.memory.length=0}}/**
 * Stage.js v1.0.0-alpha.18
 * @copyright Copyright Ali Shakiba
 * @license Licensed under the MIT (https://github.com/piqnt/stage.js/blob/main/LICENSE.md)
 */var math_random=Math.random,math_sqrt=Math.sqrt;function random(i,t){return typeof i>"u"?(t=1,i=0):typeof t>"u"&&(t=i,i=0),i==t?i:math_random()*(t-i)+i}function wrap(i,t,e){return typeof t>"u"?(e=1,t=0):typeof e>"u"&&(e=t,t=0),e>t?(i=(i-t)%(e-t),i+(i<0?e:t)):(i=(i-e)%(t-e),i+(i<=0?t:e))}function clamp(i,t,e){return i<t?t:i>e?e:i}function length(i,t){return math_sqrt(i*i+t*t)}var math=Object.create(Math);math.random=random;math.wrap=wrap;math.clamp=clamp;math.length=length;math.rotate=wrap;math.limit=clamp;var Matrix=function(){function i(t,e,r,n,s,o){this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,typeof t=="object"?this.reset(t):this.reset(t,e,r,n,s,o)}return i.prototype.toString=function(){return"["+this.a+", "+this.b+", "+this.c+", "+this.d+", "+this.e+", "+this.f+"]"},i.prototype.clone=function(){return new i(this.a,this.b,this.c,this.d,this.e,this.f)},i.prototype.reset=function(t,e,r,n,s,o){return this._dirty=!0,typeof t=="object"?(this.a=t.a,this.d=t.d,this.b=t.b,this.c=t.c,this.e=t.e,this.f=t.f):(this.a=typeof t=="number"?t:1,this.b=typeof e=="number"?e:0,this.c=typeof r=="number"?r:0,this.d=typeof n=="number"?n:1,this.e=typeof s=="number"?s:0,this.f=typeof o=="number"?o:0),this},i.prototype.identity=function(){return this._dirty=!0,this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this},i.prototype.rotate=function(t){if(!t)return this;this._dirty=!0;var e=t?Math.cos(t):1,r=t?Math.sin(t):0,n=e*this.a-r*this.b,s=e*this.b+r*this.a,o=e*this.c-r*this.d,a=e*this.d+r*this.c,h=e*this.e-r*this.f,u=e*this.f+r*this.e;return this.a=n,this.b=s,this.c=o,this.d=a,this.e=h,this.f=u,this},i.prototype.translate=function(t,e){return!t&&!e?this:(this._dirty=!0,this.e+=t,this.f+=e,this)},i.prototype.scale=function(t,e){return!(t-1)&&!(e-1)?this:(this._dirty=!0,this.a*=t,this.b*=e,this.c*=t,this.d*=e,this.e*=t,this.f*=e,this)},i.prototype.skew=function(t,e){if(!t&&!e)return this;this._dirty=!0;var r=this.a+this.b*t,n=this.b+this.a*e,s=this.c+this.d*t,o=this.d+this.c*e,a=this.e+this.f*t,h=this.f+this.e*e;return this.a=r,this.b=n,this.c=s,this.d=o,this.e=a,this.f=h,this},i.prototype.concat=function(t){this._dirty=!0;var e=this.a*t.a+this.b*t.c,r=this.b*t.d+this.a*t.b,n=this.c*t.a+this.d*t.c,s=this.d*t.d+this.c*t.b,o=this.e*t.a+t.e+this.f*t.c,a=this.f*t.d+t.f+this.e*t.b;return this.a=e,this.b=r,this.c=n,this.d=s,this.e=o,this.f=a,this},i.prototype.inverse=function(){if(this._dirty){this._dirty=!1,this.inverted||(this.inverted=new i);var t=this.a*this.d-this.b*this.c;this.inverted.a=this.d/t,this.inverted.b=-this.b/t,this.inverted.c=-this.c/t,this.inverted.d=this.a/t,this.inverted.e=(this.c*this.f-this.e*this.d)/t,this.inverted.f=(this.e*this.b-this.a*this.f)/t}return this.inverted},i.prototype.map=function(t,e){return e=e||{x:0,y:0},e.x=this.a*t.x+this.c*t.y+this.e,e.y=this.b*t.x+this.d*t.y+this.f,e},i.prototype.mapX=function(t,e){return typeof t=="object"&&(e=t.y,t=t.x),this.a*t+this.c*e+this.e},i.prototype.mapY=function(t,e){return typeof t=="object"&&(e=t.y,t=t.x),this.b*t+this.d*e+this.f},i}();/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var extendStatics=function(i,t){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])},extendStatics(i,t)};function __extends(i,t){extendStatics(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var __assign=function(){return __assign=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t},__assign.apply(this,arguments)};function __awaiter(i,t,e,r){function n(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(_){try{u(r.next(_))}catch(p){o(p)}}function h(_){try{u(r.throw(_))}catch(p){o(p)}}function u(_){_.done?s(_.value):n(_.value).then(a,h)}u((r=r.apply(i,[])).next())})}function __generator(i,t){var e={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,n,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(_){return h([u,_])}}function h(u){if(r)throw new TypeError("Generator is already executing.");for(;e;)try{if(r=1,n&&(s=u[0]&2?n.return:u[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,u[1])).done)return s;switch(n=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return e.label++,{value:u[1],done:!1};case 5:e.label++,n=u[1],u=[0];continue;case 7:u=e.ops.pop(),e.trys.pop();continue;default:if(s=e.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){e=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){e.label=u[1];break}if(u[0]===6&&e.label<s[1]){e.label=s[1],s=u;break}if(s&&e.label<s[2]){e.label=s[2],e.ops.push(u);break}s[2]&&e.ops.pop(),e.trys.pop();continue}u=t.call(i,e)}catch(_){u=[6,_],n=0}finally{r=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var objectToString=Object.prototype.toString;function isFn(i){var t=objectToString.call(i);return t==="[object Function]"||t==="[object GeneratorFunction]"||t==="[object AsyncFunction]"}function isHash(i){return objectToString.call(i)==="[object Object]"&&i.constructor===Object}const stats={create:0,tick:0,component:0,draw:0,fps:0};var uid=function(){return Date.now().toString(36)+Math.random().toString(36).slice(2)},Texture=function(){function i(){this.uid="texture:"+uid(),this.sx=0,this.sy=0,this.dx=0,this.dy=0}return i.prototype.setSourceCoordinate=function(t,e){this.sx=t,this.sy=e},i.prototype.setSourceDimension=function(t,e){this.sw=t,this.sh=e},i.prototype.setDestinationCoordinate=function(t,e){this.dx=t,this.dy=e},i.prototype.setDestinationDimension=function(t,e){this.dw=t,this.dh=e},i.prototype.draw=function(t,e,r,n,s,o,a,h,u){var _,p,g,m,d,l,c,v;arguments.length>5?(_=this.sx+e,p=this.sy+r,g=n??this.sw,m=s??this.sh,d=this.dx+o,l=this.dy+a,c=h??this.dw,v=u??this.dh):arguments.length>1?(_=this.sx,p=this.sy,g=this.sw,m=this.sh,d=this.dx+e,l=this.dy+r,c=n??this.dw,v=s??this.dh):(_=this.sx,p=this.sy,g=this.sw,m=this.sh,d=this.dx,l=this.dy,c=this.dw,v=this.dh),this.drawWithNormalizedArgs(t,_,p,g,m,d,l,c,v)},i}(),ImageTexture=function(i){__extends(t,i);function t(e,r){var n=i.call(this)||this;return n._pixelRatio=1,n.padding=0,typeof e=="object"&&n.setSourceImage(e,r),n}return t.prototype.setSourceImage=function(e,r){r===void 0&&(r=1),this._source=e,this._pixelRatio=r},t.prototype.setPadding=function(e){this.padding=e},t.prototype.getWidth=function(){return this._source.width/this._pixelRatio+(this.padding+this.padding)},t.prototype.getHeight=function(){return this._source.height/this._pixelRatio+(this.padding+this.padding)},t.prototype.prerender=function(e){return!1},t.prototype.drawWithNormalizedArgs=function(e,r,n,s,o,a,h,u,_){var p=this._source;if(!(p===null||typeof p!="object")){s=s??this._source.width/this._pixelRatio,o=o??this._source.height/this._pixelRatio,u=u??s,_=_??o,a+=this.padding,h+=this.padding;var g=r*this._pixelRatio,m=n*this._pixelRatio,d=s*this._pixelRatio,l=o*this._pixelRatio;try{stats.draw++,e.drawImage(p,g,m,d,l,a,h,u,_)}catch(c){this._draw_failed||(console.log("Unable to draw: ",p),console.log(c),this._draw_failed=!0)}}},t}(Texture),PipeTexture=function(i){__extends(t,i);function t(e){var r=i.call(this)||this;return r._source=e,r}return t.prototype.setSourceTexture=function(e){this._source=e},t.prototype.getWidth=function(){var e,r;return(r=(e=this.dw)!==null&&e!==void 0?e:this.sw)!==null&&r!==void 0?r:this._source.getWidth()},t.prototype.getHeight=function(){var e,r;return(r=(e=this.dh)!==null&&e!==void 0?e:this.sh)!==null&&r!==void 0?r:this._source.getHeight()},t.prototype.prerender=function(e){return this._source.prerender(e)},t.prototype.drawWithNormalizedArgs=function(e,r,n,s,o,a,h,u,_){var p=this._source;p===null||typeof p!="object"||p.draw(e,r,n,s,o,a,h,u,_)},t}(Texture),Atlas=function(i){__extends(t,i);function t(e){e===void 0&&(e={});var r=i.call(this)||this;return r.pipeSpriteTexture=function(n){var s=r._map,o=r._ppu,a=r._trim;if(n){n=Object.assign({},n),isFn(s)&&(n=s(n)),o!=1&&(n.x*=o,n.y*=o,n.width*=o,n.height*=o,n.top*=o,n.bottom*=o,n.left*=o,n.right*=o),a!=0&&(n.x+=a,n.y+=a,n.width-=2*a,n.height-=2*a,n.top-=a,n.bottom-=a,n.left-=a,n.right-=a);var h=new PipeTexture(r);return h.top=n.top,h.bottom=n.bottom,h.left=n.left,h.right=n.right,h.setSourceCoordinate(n.x,n.y),h.setSourceDimension(n.width,n.height),h}},r.findSpriteDefinition=function(n){var s=r._textures;if(s){if(isFn(s))return s(n);if(isHash(s))return s[n]}},r.select=function(n){if(!n)return new TextureSelection(new PipeTexture(r));var s=r.findSpriteDefinition(n);if(s)return new TextureSelection(s,r)},r.name=e.name,r._ppu=e.ppu||e.ratio||1,r._trim=e.trim||0,r._map=e.map||e.filter,r._textures=e.textures,typeof e.image=="object"&&isHash(e.image)?("src"in e.image?r._imageSrc=e.image.src:"url"in e.image&&(r._imageSrc=e.image.url),typeof e.image.ratio=="number"&&(r._pixelRatio=e.image.ratio)):(typeof e.imagePath=="string"?r._imageSrc=e.imagePath:typeof e.image=="string"&&(r._imageSrc=e.image),typeof e.imageRatio=="number"&&(r._pixelRatio=e.imageRatio)),deprecatedWarning(e),r}return t.prototype.load=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(r){switch(r.label){case 0:return this._imageSrc?[4,asyncLoadImage(this._imageSrc)]:[3,2];case 1:e=r.sent(),this.setSourceImage(e,this._pixelRatio),r.label=2;case 2:return[2]}})})},t}(ImageTexture);function asyncLoadImage(i){return console.debug&&console.debug("Loading image: "+i),new Promise(function(t,e){var r=new Image;r.onload=function(){console.debug&&console.debug("Image loaded: "+i),t(r)},r.onerror=function(n){console.error("Loading failed: "+i),e(n)},r.src=i})}function deprecatedWarning(i){"filter"in i&&console.warn("'filter' field of atlas definition is deprecated"),"cutouts"in i&&console.warn("'cutouts' field of atlas definition is deprecated"),"sprites"in i&&console.warn("'sprites' field of atlas definition is deprecated"),"factory"in i&&console.warn("'factory' field of atlas definition is deprecated"),"ratio"in i&&console.warn("'ratio' field of atlas definition is deprecated"),"imagePath"in i&&console.warn("'imagePath' field of atlas definition is deprecated"),"imageRatio"in i&&console.warn("'imageRatio' field of atlas definition is deprecated"),typeof i.image=="object"&&"url"in i.image&&console.warn("'image.url' field of atlas definition is deprecated")}function isAtlasSpriteDefinition(i){return typeof i=="object"&&isHash(i)&&typeof i.width=="number"&&typeof i.height=="number"}var TextureSelection=function(){function i(t,e){this.selection=t,this.atlas=e}return i.prototype.resolve=function(t,e){if(t){if(Array.isArray(t))return this.resolve(t[0]);if(t instanceof Texture)return t;if(isAtlasSpriteDefinition(t))return this.atlas?this.atlas.pipeSpriteTexture(t):NO_TEXTURE;if(typeof t=="object"&&isHash(t)&&typeof e<"u")return this.resolve(t[e]);if(typeof t=="function"&&isFn(t))return this.resolve(t(e));if(typeof t=="string")return this.atlas?this.resolve(this.atlas.findSpriteDefinition(t)):NO_TEXTURE}else return NO_TEXTURE},i.prototype.one=function(t){return this.resolve(this.selection,t)},i.prototype.array=function(t){var e=Array.isArray(t)?t:[];if(Array.isArray(this.selection))for(var r=0;r<this.selection.length;r++)e[r]=this.resolve(this.selection[r]);else e[0]=this.resolve(this.selection);return e},i}(),NO_TEXTURE=new(function(i){__extends(t,i);function t(){var e=i.call(this)||this;return e.setSourceDimension(0,0),e}return t.prototype.getWidth=function(){return 0},t.prototype.getHeight=function(){return 0},t.prototype.prerender=function(e){return!1},t.prototype.drawWithNormalizedArgs=function(e,r,n,s,o,a,h,u,_){},t.prototype.setSourceCoordinate=function(e,r){},t.prototype.setSourceDimension=function(e,r){},t.prototype.setDestinationCoordinate=function(e,r){},t.prototype.setDestinationDimension=function(e,r){},t.prototype.draw=function(){},t}(Texture)),NO_SELECTION=new TextureSelection(NO_TEXTURE),ATLAS_MEMO_BY_NAME={},ATLAS_ARRAY=[];function atlas(i){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return i instanceof Atlas?t=i:t=new Atlas(i),t.name&&(ATLAS_MEMO_BY_NAME[t.name]=t),ATLAS_ARRAY.push(t),[4,t.load()];case 1:return e.sent(),[2,t]}})})}function texture(i){if(typeof i!="string")return new TextureSelection(i);var t=null,e=i.indexOf(":");if(e>0&&i.length>e+1){var r=ATLAS_MEMO_BY_NAME[i.slice(0,e)];t=r&&r.select(i.slice(e+1))}if(!t){var n=ATLAS_MEMO_BY_NAME[i];t=n&&n.select()}if(!t)for(var s=0;s<ATLAS_ARRAY.length&&(t=ATLAS_ARRAY[s].select(i),!t);s++);return t||(console.error("Texture not found: "+i),t=NO_SELECTION),t}var ResizableTexture=function(i){__extends(t,i);function t(e,r){var n=i.call(this)||this;return n._source=e,n._resizeMode=r,n}return t.prototype.getWidth=function(){var e;return(e=this.dw)!==null&&e!==void 0?e:this._source.getWidth()},t.prototype.getHeight=function(){var e;return(e=this.dh)!==null&&e!==void 0?e:this._source.getHeight()},t.prototype.prerender=function(e){return!1},t.prototype.drawWithNormalizedArgs=function(e,r,n,s,o,a,h,u,_){var p=this._source;if(!(p===null||typeof p!="object")){var g=u,m=_,d=Number.isFinite(p.left)?p.left:0,l=Number.isFinite(p.right)?p.right:0,c=Number.isFinite(p.top)?p.top:0,v=Number.isFinite(p.bottom)?p.bottom:0,x=p.getWidth()-d-l,w=p.getHeight()-c-v;if(this._innerSize||(g=Math.max(g-d-l,0),m=Math.max(m-c-v,0)),c>0&&d>0&&p.draw(e,0,0,d,c,0,0,d,c),v>0&&d>0&&p.draw(e,0,w+c,d,v,0,m+c,d,v),c>0&&l>0&&p.draw(e,x+d,0,l,c,g+d,0,l,c),v>0&&l>0&&p.draw(e,x+d,w+c,l,v,g+d,m+c,l,v),this._resizeMode==="stretch")c>0&&p.draw(e,d,0,x,c,d,0,g,c),v>0&&p.draw(e,d,w+c,x,v,d,m+c,g,v),d>0&&p.draw(e,0,c,d,w,0,c,d,m),l>0&&p.draw(e,x+d,c,l,w,g+d,c,l,m),p.draw(e,d,c,x,w,d,c,g,m);else if(this._resizeMode==="tile")for(var y=d,b=g,S=void 0;b>0;){S=Math.min(x,b),b-=x;for(var M=c,T=m,E=void 0;T>0;)E=Math.min(w,T),T-=w,p.draw(e,d,c,S,E,y,M,S,E),b<=0&&(d&&p.draw(e,0,c,d,E,0,M,d,E),l&&p.draw(e,x+d,c,l,E,y+S,M,l,E)),M+=E;c&&p.draw(e,d,0,S,c,y,0,S,c),v&&p.draw(e,d,w+c,S,v,y,M,S,v),y+=S}}},t}(Texture);function getDevicePixelRatio(){return typeof window<"u"&&window.devicePixelRatio||1}function isValidFitMode(i){return i&&(i==="cover"||i==="contain"||i==="fill"||i==="in"||i==="in-pad"||i==="out"||i==="out-crop")}var iid$1=0,Pin=function(){function i(t){this.uid="pin:"+uid(),this._directionX=1,this._directionY=1,this._owner=t,this._parent=null,this._relativeMatrix=new Matrix,this._absoluteMatrix=new Matrix,this.reset()}return i.prototype.reset=function(){this._textureAlpha=1,this._alpha=1,this._width=0,this._height=0,this._scaleX=1,this._scaleY=1,this._skewX=0,this._skewY=0,this._rotation=0,this._pivoted=!1,this._pivotX=0,this._pivotY=0,this._handled=!1,this._handleX=0,this._handleY=0,this._aligned=!1,this._alignX=0,this._alignY=0,this._offsetX=0,this._offsetY=0,this._boxX=0,this._boxY=0,this._boxWidth=this._width,this._boxHeight=this._height,this._ts_translate=++iid$1,this._ts_transform=++iid$1,this._ts_matrix=++iid$1},i.prototype._update=function(){return this._parent=this._owner._parent&&this._owner._parent._pin,this._handled&&this._mo_handle!=this._ts_transform&&(this._mo_handle=this._ts_transform,this._ts_translate=++iid$1),this._aligned&&this._parent&&this._mo_align!=this._parent._ts_transform&&(this._mo_align=this._parent._ts_transform,this._ts_translate=++iid$1),this},i.prototype.toString=function(){return this._owner+" ("+(this._parent?this._parent._owner:null)+")"},i.prototype.absoluteMatrix=function(){this._update();var t=Math.max(this._ts_transform,this._ts_translate,this._parent?this._parent._ts_matrix:0);if(this._mo_abs==t)return this._absoluteMatrix;this._mo_abs=t;var e=this._absoluteMatrix;return e.reset(this.relativeMatrix()),this._parent&&e.concat(this._parent._absoluteMatrix),this._ts_matrix=++iid$1,e},i.prototype.relativeMatrix=function(){this._update();var t=Math.max(this._ts_transform,this._ts_translate,this._parent?this._parent._ts_transform:0);if(this._mo_rel==t)return this._relativeMatrix;this._mo_rel=t;var e=this._relativeMatrix;if(e.identity(),this._pivoted&&e.translate(-this._pivotX*this._width,-this._pivotY*this._height),e.scale(this._scaleX*this._directionX,this._scaleY*this._directionY),e.skew(this._skewX,this._skewY),e.rotate(this._rotation),this._pivoted&&e.translate(this._pivotX*this._width,this._pivotY*this._height),this._pivoted)this._boxX=0,this._boxY=0,this._boxWidth=this._width,this._boxHeight=this._height;else{var r=void 0,n=void 0;e.a>0&&e.c>0||e.a<0&&e.c<0?(r=0,n=e.a*this._width+e.c*this._height):(r=e.a*this._width,n=e.c*this._height),r>n?(this._boxX=n,this._boxWidth=r-n):(this._boxX=r,this._boxWidth=n-r),e.b>0&&e.d>0||e.b<0&&e.d<0?(r=0,n=e.b*this._width+e.d*this._height):(r=e.b*this._width,n=e.d*this._height),r>n?(this._boxY=n,this._boxHeight=r-n):(this._boxY=r,this._boxHeight=n-r)}return this._x=this._offsetX,this._y=this._offsetY,this._x-=this._boxX+this._handleX*this._boxWidth*this._directionX,this._y-=this._boxY+this._handleY*this._boxHeight*this._directionY,this._aligned&&this._parent&&(this._parent.relativeMatrix(),this._x+=this._alignX*this._parent._width,this._y+=this._alignY*this._parent._height),e.translate(this._x,this._y),this._relativeMatrix},i.prototype.get=function(t){if(typeof getters[t]=="function")return getters[t](this)},i.prototype.set=function(t,e){if(typeof t=="string")typeof setters[t]=="function"&&typeof e<"u"&&setters[t](this,e);else if(typeof t=="object")for(e in t)typeof setters[e]=="function"&&typeof t[e]<"u"&&setters[e](this,t[e],t);return this._owner&&(this._owner._ts_pin=++iid$1,this._owner.touch()),this},i.prototype.fit=function(t,e,r){this._ts_transform=++iid$1,r==="contain"&&(r="in-pad"),r==="cover"&&(r="out-crop"),typeof t=="number"&&(this._scaleX=t/this._unscaled_width,this._width=this._unscaled_width),typeof e=="number"&&(this._scaleY=e/this._unscaled_height,this._height=this._unscaled_height),typeof t=="number"&&typeof e=="number"&&typeof r=="string"&&(r==="fill"||(r==="out"||r==="out-crop"?this._scaleX=this._scaleY=Math.max(this._scaleX,this._scaleY):(r==="in"||r==="in-pad")&&(this._scaleX=this._scaleY=Math.min(this._scaleX,this._scaleY))),(r==="out-crop"||r==="in-pad")&&(this._width=t/this._scaleX,this._height=e/this._scaleY))},i}(),getters={alpha:function(i){return i._alpha},textureAlpha:function(i){return i._textureAlpha},width:function(i){return i._width},height:function(i){return i._height},boxWidth:function(i){return i._boxWidth},boxHeight:function(i){return i._boxHeight},scaleX:function(i){return i._scaleX},scaleY:function(i){return i._scaleY},skewX:function(i){return i._skewX},skewY:function(i){return i._skewY},rotation:function(i){return i._rotation},pivotX:function(i){return i._pivotX},pivotY:function(i){return i._pivotY},offsetX:function(i){return i._offsetX},offsetY:function(i){return i._offsetY},alignX:function(i){return i._alignX},alignY:function(i){return i._alignY},handleX:function(i){return i._handleX},handleY:function(i){return i._handleY}},setters={alpha:function(i,t){i._alpha=t},textureAlpha:function(i,t){i._textureAlpha=t},width:function(i,t){i._unscaled_width=t,i._width=t,i._ts_transform=++iid$1},height:function(i,t){i._unscaled_height=t,i._height=t,i._ts_transform=++iid$1},scale:function(i,t){i._scaleX=t,i._scaleY=t,i._ts_transform=++iid$1},scaleX:function(i,t){i._scaleX=t,i._ts_transform=++iid$1},scaleY:function(i,t){i._scaleY=t,i._ts_transform=++iid$1},skew:function(i,t){i._skewX=t,i._skewY=t,i._ts_transform=++iid$1},skewX:function(i,t){i._skewX=t,i._ts_transform=++iid$1},skewY:function(i,t){i._skewY=t,i._ts_transform=++iid$1},rotation:function(i,t){i._rotation=t,i._ts_transform=++iid$1},pivot:function(i,t){i._pivotX=t,i._pivotY=t,i._pivoted=!0,i._ts_transform=++iid$1},pivotX:function(i,t){i._pivotX=t,i._pivoted=!0,i._ts_transform=++iid$1},pivotY:function(i,t){i._pivotY=t,i._pivoted=!0,i._ts_transform=++iid$1},offset:function(i,t){i._offsetX=t,i._offsetY=t,i._ts_translate=++iid$1},offsetX:function(i,t){i._offsetX=t,i._ts_translate=++iid$1},offsetY:function(i,t){i._offsetY=t,i._ts_translate=++iid$1},align:function(i,t){this.alignX(i,t),this.alignY(i,t)},alignX:function(i,t){i._alignX=t,i._aligned=!0,i._ts_translate=++iid$1,this.handleX(i,t)},alignY:function(i,t){i._alignY=t,i._aligned=!0,i._ts_translate=++iid$1,this.handleY(i,t)},handle:function(i,t){this.handleX(i,t),this.handleY(i,t)},handleX:function(i,t){i._handleX=t,i._handled=!0,i._ts_translate=++iid$1},handleY:function(i,t){i._handleY=t,i._handled=!0,i._ts_translate=++iid$1},resizeMode:function(i,t,e){e&&(t=="in"?t="in-pad":t=="out"&&(t="out-crop"),i.fit(e.resizeWidth,e.resizeHeight,t))},resizeWidth:function(i,t,e){(!e||!e.resizeMode)&&i.fit(t,null)},resizeHeight:function(i,t,e){(!e||!e.resizeMode)&&i.fit(null,t)},scaleMode:function(i,t,e){e&&i.fit(e.scaleWidth,e.scaleHeight,t)},scaleWidth:function(i,t,e){(!e||!e.scaleMode)&&i.fit(t,null)},scaleHeight:function(i,t,e){(!e||!e.scaleMode)&&i.fit(null,t)},matrix:function(i,t){this.scaleX(i,t.a),this.skewX(i,t.c/t.d),this.skewY(i,t.b/t.a),this.scaleY(i,t.d),this.offsetX(i,t.e),this.offsetY(i,t.f),this.rotation(i,0)}};function IDENTITY(i){return i}var LOOKUP_CACHE={},MODE_BY_NAME={},EASE_BY_NAME={},Easing=function(){function i(){}return i.get=function(t,e){if(e=e||IDENTITY,typeof t=="function")return t;if(typeof t!="string")return e;var r=LOOKUP_CACHE[t];if(r)return r;var n=/^(\w+)(-(in|out|in-out|out-in))?(\((.*)\))?$/i.exec(t);if(!n||!n.length)return e;var s=n[1],o=EASE_BY_NAME[s],a=n[3],h=MODE_BY_NAME[a],u=n[5];if(!o)r=e;else if("fn"in o&&typeof o.fn=="function")r=o.fn;else if("fc"in o&&typeof o.fc=="function"){var _=u?u.replace(/\s+/,"").split(","):void 0;r=o.fc.apply(o.fc,_)}else r=e;return h&&(r=h(r)),LOOKUP_CACHE[t]=r,r},i}();function addMode(i,t){MODE_BY_NAME[i]=t}function addEaseFn(i){for(var t=i.name.split(/\s+/),e=0;e<t.length;e++){var r=t[e];r&&(EASE_BY_NAME[r]=i)}}addMode("in",function(i){return i});addMode("out",function(i){return function(t){return 1-i(1-t)}});addMode("in-out",function(i){return function(t){return t<.5?i(2*t)/2:1-i(2*(1-t))/2}});addMode("out-in",function(i){return function(t){return t<.5?1-i(2*(1-t))/2:i(2*t)/2}});addEaseFn({name:"linear",fn:function(i){return i}});addEaseFn({name:"quad",fn:function(i){return i*i}});addEaseFn({name:"cubic",fn:function(i){return i*i*i}});addEaseFn({name:"quart",fn:function(i){return i*i*i*i}});addEaseFn({name:"quint",fn:function(i){return i*i*i*i*i}});addEaseFn({name:"sin sine",fn:function(i){return 1-Math.cos(i*Math.PI/2)}});addEaseFn({name:"exp expo",fn:function(i){return i==0?0:Math.pow(2,10*(i-1))}});addEaseFn({name:"circle circ",fn:function(i){return 1-Math.sqrt(1-i*i)}});addEaseFn({name:"bounce",fn:function(i){return i<1/2.75?7.5625*i*i:i<2/2.75?7.5625*(i-=1.5/2.75)*i+.75:i<2.5/2.75?7.5625*(i-=2.25/2.75)*i+.9375:7.5625*(i-=2.625/2.75)*i+.984375}});addEaseFn({name:"poly",fc:function(i){return function(t){return Math.pow(t,i)}}});addEaseFn({name:"elastic",fc:function(i,t){t=t||.45,i=i||1;var e=t/(2*Math.PI)*Math.asin(1/i);return function(r){return 1+i*Math.pow(2,-10*r)*Math.sin((r-e)*(2*Math.PI)/t)}}});addEaseFn({name:"back",fc:function(i){return i=typeof i<"u"?i:1.70158,function(t){return t*t*((i+1)*t-i)}}});var Transition=function(){function i(t,e){e===void 0&&(e={}),this.uid="transition:"+uid(),this._ending=[],this._end={},this._duration=e.duration||400,this._delay=e.delay||0,this._owner=t,this._time=0}return i.prototype.tick=function(t,e,r,n){if(this._time+=e,!(this._time<this._delay)){var s=this._time-this._delay;if(!this._start){this._start={};for(var o in this._end)this._start[o]=this._owner.pin(o)}var a=Math.min(s/this._duration,1),h=a>=1;typeof this._easing=="function"&&(a=this._easing(a));var u=1-a;for(var o in this._end)this._owner.pin(o,this._start[o]*u+this._end[o]*a);return h}},i.prototype.finish=function(){var t=this;return this._ending.forEach(function(e){try{e.call(t._owner)}catch(r){console.error(r)}}),this._next},i.prototype.tween=function(t,e){var r;return typeof t=="object"&&t!==null?r=t:(r={},typeof t=="number"&&(r.duration=t,typeof e=="number"&&(r.delay=e))),this._next=new i(this._owner,r)},i.prototype.duration=function(t){return this._duration=t,this},i.prototype.delay=function(t){return this._delay=t,this},i.prototype.ease=function(t){return this._easing=Easing.get(t),this},i.prototype.done=function(t){return this._ending.push(t),this},i.prototype.hide=function(){return this._ending.push(function(){this.hide()}),this._hide=!0,this},i.prototype.remove=function(){return this._ending.push(function(){this.remove()}),this._remove=!0,this},i.prototype.pin=function(t,e){if(typeof t=="object")for(var r in t)pinning(this._owner,this._end,r,t[r]);else typeof e<"u"&&pinning(this._owner,this._end,t,e);return this},i.prototype.then=function(t){return this.done(t),this},i.prototype.clear=function(t){return this},i.prototype.size=function(t,e){return this.pin("width",t),this.pin("height",e),this},i.prototype.width=function(t){return typeof t>"u"?this.pin("width"):(this.pin("width",t),this)},i.prototype.height=function(t){return typeof t>"u"?this.pin("height"):(this.pin("height",t),this)},i.prototype.offset=function(t,e){return typeof t=="object"&&(e=t.y,t=t.x),this.pin("offsetX",t),this.pin("offsetY",e),this},i.prototype.rotate=function(t){return this.pin("rotation",t),this},i.prototype.skew=function(t,e){return typeof t=="object"?(e=t.y,t=t.x):typeof e>"u"&&(e=t),this.pin("skewX",t),this.pin("skewY",e),this},i.prototype.scale=function(t,e){return typeof t=="object"?(e=t.y,t=t.x):typeof e>"u"&&(e=t),this.pin("scaleX",t),this.pin("scaleY",e),this},i.prototype.alpha=function(t,e){return this.pin("alpha",t),typeof e<"u"&&this.pin("textureAlpha",e),this},i}();function pinning(i,t,e,r){typeof i.pin(e)=="number"?t[e]=r:typeof i.pin(e+"X")=="number"&&typeof i.pin(e+"Y")=="number"&&(t[e+"X"]=r,t[e+"Y"]=r)}var iid=0;stats.create=0;function assertType(i){if(i&&i instanceof Component)return i;throw"Invalid component: "+i}function component(){return new Component}var Component=function(){function i(){var t=this;this.uid="component:"+uid(),this._label="",this._parent=null,this._next=null,this._prev=null,this._first=null,this._last=null,this._visible=!0,this._alpha=1,this._padding=0,this._spacing=0,this._pin=new Pin(this),this._listeners={},this._attrs={},this._flags={},this._transitions=[],this._tickBefore=[],this._tickAfter=[],this.MAX_ELAPSE=1/0,this.renderedBefore=!1,this._transitionTickInitied=!1,this._transitionTickLastTime=0,this._transitionTick=function(e,r,n){if(!t._transitions.length)return!1;var s=t._transitionTickLastTime!==n;if(t._transitionTickLastTime=r,s)return!0;var o=t._transitions[0],a=o.tick(t,e,r,n);if(a){o===t._transitions[0]&&t._transitions.shift();var h=o.finish();h&&t._transitions.unshift(h)}return!0},stats.create++,this instanceof i&&this.label(this.constructor.name)}return i.prototype.matrix=function(t){return t===void 0&&(t=!1),t===!0?this._pin.relativeMatrix():this._pin.absoluteMatrix()},i.prototype.getPixelRatio=function(){var t,e=(t=this._parent)===null||t===void 0?void 0:t.matrix(),r=e?Math.max(Math.abs(e.a),Math.abs(e.b))/getDevicePixelRatio():1;return r},i.prototype.getDevicePixelRatio=function(){var t,e=(t=this._parent)===null||t===void 0?void 0:t.matrix(),r=e?Math.max(Math.abs(e.a),Math.abs(e.b)):1;return r},i.prototype.getLogicalPixelRatio=function(){return this.getDevicePixelRatio()/getDevicePixelRatio()},i.prototype.pin=function(t,e){if(typeof t=="object")return this._pin.set(t),this;if(typeof t=="string")return typeof e>"u"?this._pin.get(t):(this._pin.set(t,e),this);if(typeof t>"u")return this._pin},i.prototype.fit=function(t,e,r){return typeof t=="object"&&(r=e,e=t.y,t=t.x),this._pin.fit(t,e,r),this},i.prototype.scaleTo=function(t,e,r){return this.fit(t,e,r)},i.prototype.toString=function(){return"["+this._label+"]"},i.prototype.id=function(t){return typeof t>"u"?this._label:(this._label=t,this)},i.prototype.label=function(t){return typeof t>"u"?this._label:(this._label=t,this)},i.prototype.attr=function(t,e){return typeof e>"u"?this._attrs!==null?this._attrs[t]:void 0:((this._attrs!==null?this._attrs:this._attrs={})[t]=e,this)},i.prototype.visible=function(t){return typeof t>"u"?this._visible:(this._visible=t,this._parent&&(this._parent._ts_children=++iid),this._ts_pin=++iid,this.touch(),this)},i.prototype.hide=function(){return this.visible(!1),this},i.prototype.show=function(){return this.visible(!0),this},i.prototype.parent=function(){return this._parent},i.prototype.next=function(t){for(var e=this._next;e&&t&&!e._visible;)e=e._next;return e},i.prototype.prev=function(t){for(var e=this._prev;e&&t&&!e._visible;)e=e._prev;return e},i.prototype.first=function(t){for(var e=this._first;e&&t&&!e._visible;)e=e._next;return e},i.prototype.last=function(t){for(var e=this._last;e&&t&&!e._visible;)e=e._prev;return e},i.prototype.visit=function(t,e){var r=t.reverse,n=t.visible;if(!(t.start&&t.start(this,e))){for(var s,o=r?this.last(n):this.first(n);s=o;)if(o=r?s.prev(n):s.next(n),s.visit(t,e))return!0;return t.end&&t.end(this,e)}},i.prototype.append=function(t,e){if(Array.isArray(t))for(var r=0;r<t.length;r++)i.append(this,t[r]);else if(typeof e<"u")for(var r=0;r<arguments.length;r++)i.append(this,arguments[r]);else typeof t<"u"&&i.append(this,t);return this},i.prototype.prepend=function(t,e){if(Array.isArray(t))for(var r=t.length-1;r>=0;r--)i.prepend(this,t[r]);else if(typeof e<"u")for(var r=arguments.length-1;r>=0;r--)i.prepend(this,arguments[r]);else typeof t<"u"&&i.prepend(this,t);return this},i.prototype.appendTo=function(t){return i.append(t,this),this},i.prototype.prependTo=function(t){return i.prepend(t,this),this},i.prototype.insertNext=function(t,e){if(Array.isArray(t))for(var r=0;r<t.length;r++)i.insertAfter(t[r],this);else if(typeof e<"u")for(var r=0;r<arguments.length;r++)i.insertAfter(arguments[r],this);else typeof t<"u"&&i.insertAfter(t,this);return this},i.prototype.insertPrev=function(t,e){if(Array.isArray(t))for(var r=t.length-1;r>=0;r--)i.insertBefore(t[r],this);else if(typeof e<"u")for(var r=arguments.length-1;r>=0;r--)i.insertBefore(arguments[r],this);else typeof t<"u"&&i.insertBefore(t,this);return this},i.prototype.insertAfter=function(t){return i.insertAfter(this,t),this},i.prototype.insertBefore=function(t){return i.insertBefore(this,t),this},i.append=function(t,e){assertType(e),assertType(t),e.remove(),t._last&&(t._last._next=e,e._prev=t._last),e._parent=t,t._last=e,t._first||(t._first=e),e._parent._flag(e,!0),e._ts_parent=++iid,t._ts_children=++iid,t.touch()},i.prepend=function(t,e){assertType(e),assertType(t),e.remove(),t._first&&(t._first._prev=e,e._next=t._first),e._parent=t,t._first=e,t._last||(t._last=e),e._parent._flag(e,!0),e._ts_parent=++iid,t._ts_children=++iid,t.touch()},i.insertBefore=function(t,e){assertType(t),assertType(e),t.remove();var r=e._parent,n=e._prev;r&&(e._prev=t,n&&(n._next=t)||r&&(r._first=t),t._parent=r,t._prev=n,t._next=e,t._parent._flag(t,!0),t._ts_parent=++iid,t.touch())},i.insertAfter=function(t,e){assertType(t),assertType(e),t.remove();var r=e._parent,n=e._next;r&&(e._next=t,n&&(n._prev=t)||r&&(r._last=t),t._parent=r,t._prev=e,t._next=n,t._parent._flag(t,!0),t._ts_parent=++iid,t.touch())},i.prototype.remove=function(t,e){if(typeof t<"u"){if(Array.isArray(t))for(var r=0;r<t.length;r++)assertType(t[r]).remove();else if(typeof e<"u")for(var r=0;r<arguments.length;r++)assertType(arguments[r]).remove();else assertType(t).remove();return this}return this._prev&&(this._prev._next=this._next),this._next&&(this._next._prev=this._prev),this._parent&&(this._parent._first===this&&(this._parent._first=this._next),this._parent._last===this&&(this._parent._last=this._prev),this._parent._flag(this,!1),this._parent._ts_children=++iid,this._parent.touch()),this._prev=this._next=this._parent=null,this._ts_parent=++iid,this},i.prototype.empty=function(){for(var t=null,e=this._first;t=e;)e=t._next,t._prev=t._next=t._parent=null,this._flag(t,!1);return this._first=this._last=null,this._ts_children=++iid,this.touch(),this},i.prototype.touch=function(){return this._ts_touch=++iid,this._parent&&this._parent.touch(),this},i.prototype._flag=function(t,e){if(typeof e>"u")return this._flags!==null&&this._flags[t]||0;if(typeof t=="string"&&(e?(this._flags=this._flags||{},!this._flags[t]&&this._parent&&this._parent._flag(t,!0),this._flags[t]=(this._flags[t]||0)+1):this._flags&&this._flags[t]>0&&(this._flags[t]==1&&this._parent&&this._parent._flag(t,!1),this._flags[t]=this._flags[t]-1)),typeof t=="object"&&t._flags)for(var r in t._flags)t._flags[r]>0&&this._flag(r,e);return this},i.prototype.hitTest=function(t){var e=this._pin._width,r=this._pin._height;return t.x>=0&&t.x<=e&&t.y>=0&&t.y<=r},i.prototype.prerender=function(){if(this._visible){this.prerenderTexture();for(var t,e=this._first;t=e;)e=t._next,t.prerender()}},i.prototype.prerenderTexture=function(){},i.prototype.render=function(t){if(this._visible){stats.component++;var e=this.matrix();t.setTransform(e.a,e.b,e.c,e.d,e.e,e.f),this._alpha=this._pin._alpha*(this._parent?this._parent._alpha:1);var r=this._pin._textureAlpha*this._alpha;t.globalAlpha!=r&&(t.globalAlpha=r),this.renderedBefore||this.prerenderTexture(),this.renderedBefore=!0,this.renderTexture(t),t.globalAlpha!=this._alpha&&(t.globalAlpha=this._alpha);for(var n,s=this._first;n=s;)s=n._next,n.render(t)}},i.prototype.renderTexture=function(t){},i.prototype._tick=function(t,e,r){if(this._visible){t>this.MAX_ELAPSE&&(t=this.MAX_ELAPSE);var n=!1;if(this._tickBefore!==null)for(var s=0;s<this._tickBefore.length;s++){stats.tick++;var o=this._tickBefore[s];n=o.call(this,t,e,r)===!0||n}for(var a,h=this._first;a=h;)h=a._next,a._flag("_tick")&&(n=a._tick(t,e,r)===!0?!0:n);if(this._tickAfter!==null)for(var s=0;s<this._tickAfter.length;s++){stats.tick++;var o=this._tickAfter[s];n=o.call(this,t,e,r)===!0||n}return n}},i.prototype.tick=function(t,e){var r,n;if(e===void 0&&(e=!1),typeof t=="function"){e?(this._tickBefore===null&&(this._tickBefore=[]),this._tickBefore.push(t)):(this._tickAfter===null&&(this._tickAfter=[]),this._tickAfter.push(t));var s=((r=this._tickAfter)===null||r===void 0?void 0:r.length)>0||((n=this._tickBefore)===null||n===void 0?void 0:n.length)>0;this._flag("_tick",s)}},i.prototype.untick=function(t){if(typeof t=="function"){var e;this._tickBefore!==null&&(e=this._tickBefore.indexOf(t))>=0&&this._tickBefore.splice(e,1),this._tickAfter!==null&&(e=this._tickAfter.indexOf(t))>=0&&this._tickAfter.splice(e,1)}},i.prototype.timeout=function(t,e){this.setTimeout(t,e)},i.prototype.setTimeout=function(t,e){function r(n){if((e-=n)<0)this.untick(r),t.call(this);else return!0}return this.tick(r),r},i.prototype.clearTimeout=function(t){this.untick(t)},i.prototype.on=function(t,e){if(!t||!t.length||typeof e!="function")return this;if(typeof t!="string"&&typeof t.join=="function")for(var r=0;r<t.length;r++)this.on(t[r],e);else if(typeof t=="string"&&t.indexOf(" ")>-1){t=t.match(/\S+/g);for(var r=0;r<t.length;r++)this._on(t[r],e)}else typeof t=="string"&&this._on(t,e);return this},i.prototype._on=function(t,e){typeof t!="string"&&typeof e!="function"||(this._listeners[t]=this._listeners[t]||[],this._listeners[t].push(e),this._flag(t,!0))},i.prototype.off=function(t,e){if(!t||!t.length||typeof e!="function")return this;if(typeof t!="string"&&typeof t.join=="function")for(var r=0;r<t.length;r++)this.off(t[r],e);else if(typeof t=="string"&&t.indexOf(" ")>-1){t=t.match(/\S+/g);for(var r=0;r<t.length;r++)this._off(t[r],e)}else typeof t=="string"&&this._off(t,e);return this},i.prototype._off=function(t,e){if(!(typeof t!="string"&&typeof e!="function")){var r=this._listeners[t];if(!(!r||!r.length)){var n=r.indexOf(e);n>=0&&(r.splice(n,1),this._flag(t,!1))}}},i.prototype.listeners=function(t){return this._listeners[t]},i.prototype.publish=function(t,e){var r=this.listeners(t);if(!r||!r.length)return 0;for(var n=0;n<r.length;n++)r[n].apply(this,e);return r.length},i.prototype.trigger=function(t,e){return this.publish(t,e),this},i.prototype.size=function(t,e){return this.pin("width",t),this.pin("height",e),this},i.prototype.width=function(t){return typeof t>"u"?this.pin("width"):(this.pin("width",t),this)},i.prototype.height=function(t){return typeof t>"u"?this.pin("height"):(this.pin("height",t),this)},i.prototype.offset=function(t,e){return typeof t=="object"&&(e=t.y,t=t.x),this.pin("offsetX",t),this.pin("offsetY",e),this},i.prototype.rotate=function(t){return this.pin("rotation",t),this},i.prototype.skew=function(t,e){return typeof t=="object"?(e=t.y,t=t.x):typeof e>"u"&&(e=t),this.pin("skewX",t),this.pin("skewY",e),this},i.prototype.scale=function(t,e){return typeof t=="object"?(e=t.y,t=t.x):typeof e>"u"&&(e=t),this.pin("scaleX",t),this.pin("scaleY",e),this},i.prototype.alpha=function(t,e){return this.pin("alpha",t),typeof e<"u"&&this.pin("textureAlpha",e),this},i.prototype.tween=function(t,e,r){var n;typeof t=="object"&&t!==null?n=t:(n={},typeof t=="number"?(n.duration=t,typeof e=="number"?(n.delay=e,typeof r=="boolean"&&(n.append=r)):typeof e=="boolean"&&(n.append=e)):typeof t=="boolean"&&(n.append=t)),this._transitionTickInitied||(this.tick(this._transitionTick,!0),this._transitionTickInitied=!0),this.touch(),n.append||(this._transitions.length=0);var s=new Transition(this,n);return this._transitions.push(s),s},i.prototype.row=function(t){return this.align("row",t),this},i.prototype.column=function(t){return this.align("column",t),this},i.prototype.align=function(t,e){var r=this;return this._padding=this._padding,this._spacing=this._spacing,this._layoutTicker&&this.untick(this._layoutTicker),this.tick(this._layoutTicker=function(){if(r._mo_seq!=r._ts_touch){r._mo_seq=r._ts_touch;var n=r._mo_seqAlign!=r._ts_children;r._mo_seqAlign=r._ts_children;for(var s=0,o=0,a,h=r.first(!0),u=!0;a=h;){h=a.next(!0),a.matrix(!0);var _=a.pin("boxWidth"),p=a.pin("boxHeight");t=="column"?(!u&&(o+=r._spacing),a.pin("offsetY")!=o&&a.pin("offsetY",o),s=Math.max(s,_),o=o+p,n&&a.pin("alignX",e)):t=="row"&&(!u&&(s+=r._spacing),a.pin("offsetX")!=s&&a.pin("offsetX",s),s=s+_,o=Math.max(o,p),n&&a.pin("alignY",e)),u=!1}s+=2*r._padding,o+=2*r._padding,r.pin("width")!=s&&r.pin("width",s),r.pin("height")!=o&&r.pin("height",o)}}),this},i.prototype.box=function(){return this.minimize()},i.prototype.layer=function(){return this.maximize()},i.prototype.minimize=function(){var t=this;return this._padding=this._padding,this._layoutTicker&&this.untick(this._layoutTicker),this.tick(this._layoutTicker=function(){if(t._mo_box!=t._ts_touch){t._mo_box=t._ts_touch;for(var e=0,r=0,n,s=t.first(!0);n=s;){s=n.next(!0),n.matrix(!0);var o=n.pin("boxWidth"),a=n.pin("boxHeight");e=Math.max(e,o),r=Math.max(r,a)}e+=2*t._padding,r+=2*t._padding,t.pin("width")!=e&&t.pin("width",e),t.pin("height")!=r&&t.pin("height",r)}}),this},i.prototype.maximize=function(){var t=this;return this._layoutTicker&&this.untick(this._layoutTicker),this.tick(this._layoutTicker=function(){var e=t.parent();if(e){var r=e.pin("width");t.pin("width")!=r&&t.pin("width",r);var n=e.pin("height");t.pin("height")!=n&&t.pin("height",n)}},!0),this},i.prototype.padding=function(t){return this._padding=t,this},i.prototype.spacing=function(t){return this._spacing=t,this},i}();function sprite(i){var t=new Sprite;return i&&t.texture(i),t}var Sprite=function(i){__extends(t,i);function t(){var e=i.call(this)||this;return e._texture=null,e._image=null,e._tiled=!1,e._stretched=!1,e.prerenderContext={},e.label("Sprite"),e}return t.prototype.texture=function(e){return this._image=texture(e).one(),this._image?(this.pin("width",this._image.getWidth()),this.pin("height",this._image.getHeight()),this._tiled?this._texture=new ResizableTexture(this._image,"tile"):this._stretched?this._texture=new ResizableTexture(this._image,"stretch"):this._texture=new PipeTexture(this._image)):(this.pin("width",0),this.pin("height",0),this._texture=null),this},t.prototype.image=function(e){return this.texture(e)},t.prototype.tile=function(e){this._tiled=!0;var r=new ResizableTexture(this._image,"tile");return this._texture=r,this},t.prototype.stretch=function(e){this._stretched=!0;var r=new ResizableTexture(this._image,"stretch");return this._texture=r,this},t.prototype.prerenderTexture=function(){if(this._image){var e=this.getDevicePixelRatio();this.prerenderContext.pixelRatio=e;var r=this._image.prerender(this.prerenderContext);if(r===!0){var n=this._image.getWidth(),s=this._image.getHeight();this.size(n,s)}}},t.prototype.renderTexture=function(e){this._texture&&(this._texture._resizeMode&&(this._texture.dw=this.pin("width"),this._texture.dh=this.pin("height")),this._texture.draw(e))},t}(Component);(function(i){__extends(t,i);function t(){var e=i.call(this,document.createElement("canvas"))||this;return e._lastPixelRatio=0,e}return t.prototype.setSize=function(e,r,n){n===void 0&&(n=1),this._source.width=e*n,this._source.height=r*n,this._pixelRatio=n},t.prototype.getContext=function(e,r){return e===void 0&&(e="2d"),this._source.getContext(e,r)},t.prototype.getDevicePixelRatio=function(){return this._lastPixelRatio},t.prototype.getOptimalPixelRatio=function(){return this.getDevicePixelRatio()},t.prototype.setMemoizer=function(e){this._memoizer=e},t.prototype.setDrawer=function(e){this._drawer=e},t.prototype.prerender=function(e){var r=e.pixelRatio,n=this._lastPixelRatio,s=n/r,o=n===0||s>1.25||s<.8;o&&(this._lastPixelRatio=r);var a=this._memoizer?this._memoizer.call(this):null,h=this._lastMemoKey!==a;if(o||h)return this._lastMemoKey=a,this._lastPixelRatio=r,typeof this._drawer=="function"&&this._drawer.call(this),!0},t.prototype.size=function(e,r,n){return this.setSize(e,r,n),this},t.prototype.context=function(e,r){return e===void 0&&(e="2d"),this.getContext(e,r)},t.prototype.canvas=function(e){return typeof e=="function"?e.call(this,this.getContext()):typeof e>"u"&&typeof this._drawer=="function"&&this._drawer.call(this),this},t})(ImageTexture);var POINTER_CLICK="click",POINTER_DOWN="touchstart mousedown",POINTER_MOVE="touchmove mousemove",POINTER_UP="touchend mouseup",EventPoint=function(){function i(){}return i.prototype.clone=function(t){return t?(t.x=this.x,t.y=this.y):t={x:this.x,y:this.y},t},i.prototype.toString=function(){return(this.x|0)+"x"+(this.y|0)},i}(),PointerSyntheticEvent=function(){function i(){this.abs=new EventPoint}return i.prototype.clone=function(t){return t?(t.x=this.x,t.y=this.y):t={x:this.x,y:this.y},t},i.prototype.toString=function(){return this.type+": "+(this.x|0)+"x"+(this.y|0)},i}(),VisitPayload=function(){function i(){this.type="",this.x=0,this.y=0,this.timeStamp=-1,this.event=null,this.root=null,this.collected=null}return i.prototype.toString=function(){return this.type+": "+(this.x|0)+"x"+(this.y|0)},i}(),syntheticEvent=new PointerSyntheticEvent,PAYLOAD=new VisitPayload,Pointer=function(){function i(){var t=this;this.ratio=1,this.clickList=[],this.cancelList=[],this.handleStart=function(e){i.DEBUG&&console.debug&&console.debug("pointer-start",e.type),e.preventDefault(),t.localPoint(e),t.dispatchEvent(e.type,e),t.findTargets("click",t.clickList),t.findTargets("mousecancel",t.cancelList)},this.handleMove=function(e){e.preventDefault(),t.localPoint(e),t.dispatchEvent(e.type,e)},this.handleEnd=function(e){var r;e.preventDefault(),i.DEBUG&&console.debug&&console.debug("pointer-end",e.type),t.dispatchEvent(e.type,e),t.clickList.length&&(i.DEBUG&&console.debug&&console.debug("pointer-click: ",e.type,(r=t.clickList)===null||r===void 0?void 0:r.length),t.dispatchEvent("click",e,t.clickList)),t.cancelList.length=0},this.handleCancel=function(e){var r;t.cancelList.length&&(i.DEBUG&&console.debug&&console.debug("pointer-cancel",e.type,(r=t.clickList)===null||r===void 0?void 0:r.length),t.dispatchEvent("mousecancel",e,t.cancelList)),t.clickList.length=0},this.visitStart=function(e,r){return!e._flag(r.type)},this.visitEnd=function(e,r){syntheticEvent.raw=r.event,syntheticEvent.type=r.type,syntheticEvent.timeStamp=r.timeStamp,syntheticEvent.abs.x=r.x,syntheticEvent.abs.y=r.y;var n=e.listeners(r.type);if(n){e.matrix().inverse().map(r,syntheticEvent);var s=e===r.root||e.attr("spy")||e.hitTest(syntheticEvent);if(s&&(r.collected&&r.collected.push(e),r.event)){for(var o=!1,a=0;a<n.length;a++)o=n[a].call(e,syntheticEvent)?!0:o;return o}}}}return i.prototype.mount=function(t,e){var r=this;return this.stage=t,this.elem=e,this.ratio=t.viewport().ratio||1,t.on("viewport",function(n){var s;r.ratio=(s=n.ratio)!==null&&s!==void 0?s:r.ratio}),e.addEventListener("touchstart",this.handleStart),e.addEventListener("touchend",this.handleEnd),e.addEventListener("touchmove",this.handleMove),e.addEventListener("touchcancel",this.handleCancel),e.addEventListener("mousedown",this.handleStart),e.addEventListener("mouseup",this.handleEnd),e.addEventListener("mousemove",this.handleMove),document.addEventListener("mouseup",this.handleCancel),window.addEventListener("blur",this.handleCancel),this},i.prototype.unmount=function(){var t=this.elem;return t.removeEventListener("touchstart",this.handleStart),t.removeEventListener("touchend",this.handleEnd),t.removeEventListener("touchmove",this.handleMove),t.removeEventListener("touchcancel",this.handleCancel),t.removeEventListener("mousedown",this.handleStart),t.removeEventListener("mouseup",this.handleEnd),t.removeEventListener("mousemove",this.handleMove),document.removeEventListener("mouseup",this.handleCancel),window.removeEventListener("blur",this.handleCancel),this},i.prototype.localPoint=function(t){var e,r=this.elem,n,s;!((e=t.touches)===null||e===void 0)&&e.length?(n=t.touches[0].clientX,s=t.touches[0].clientY):(n=t.clientX,s=t.clientY);var o=r.getBoundingClientRect();n-=o.left,s-=o.top,n-=r.clientLeft|0,s-=r.clientTop|0,PAYLOAD.x=n*this.ratio,PAYLOAD.y=s*this.ratio},i.prototype.findTargets=function(t,e){var r=PAYLOAD;r.type=t,r.root=this.stage,r.event=null,r.collected=e,r.collected.length=0,this.stage.visit({reverse:!0,visible:!0,start:this.visitStart,end:this.visitEnd},r)},i.prototype.dispatchEvent=function(t,e,r){var n=PAYLOAD;if(n.type=t,n.root=this.stage,n.event=e,n.timeStamp=Date.now(),n.collected=null,t!=="mousemove"&&t!=="touchmove"&&i.DEBUG&&console.debug&&console.debug("pointer:dispatchEvent",n,r==null?void 0:r.length),r){for(;r.length;){var s=r.shift();if(this.visitEnd(s,n))break}r.length=0}else this.stage.visit({reverse:!0,visible:!0,start:this.visitStart,end:this.visitEnd},n)},i.DEBUG=!1,i}();function mount(i){i===void 0&&(i={});var t=new Root;return t.mount(i),t.pointer=new Pointer().mount(t,t.dom),t}var Root=function(i){__extends(t,i);function t(){var e=i.call(this)||this;return e.canvas=null,e.dom=null,e.context=null,e.pixelWidth=-1,e.pixelHeight=-1,e.pixelRatio=1,e.drawingWidth=0,e.drawingHeight=0,e.mounted=!1,e.paused=!1,e.sleep=!1,e.mount=function(r){if(r===void 0&&(r={}),typeof r.canvas=="string"?(e.canvas=document.getElementById(r.canvas),e.canvas||console.error("Canvas element not found: ",r.canvas)):r.canvas instanceof HTMLCanvasElement?e.canvas=r.canvas:r.canvas&&console.error("Unknown value for canvas:",r.canvas),e.canvas||(e.canvas=document.getElementById("cutjs")||document.getElementById("stage")),!e.canvas){console.debug&&console.debug("Creating canvas element..."),e.canvas=document.createElement("canvas"),Object.assign(e.canvas.style,{position:"absolute",display:"block",top:"0",left:"0",bottom:"0",right:"0",width:"100%",height:"100%"});var n=document.body;n.insertBefore(e.canvas,n.firstChild)}e.dom=e.canvas,e.context=e.canvas.getContext("2d"),e.devicePixelRatio=window.devicePixelRatio||1,e.backingStoreRatio=e.context.webkitBackingStorePixelRatio||e.context.mozBackingStorePixelRatio||e.context.msBackingStorePixelRatio||e.context.oBackingStorePixelRatio||e.context.backingStorePixelRatio||1,e.pixelRatio=e.devicePixelRatio/e.backingStoreRatio,e.mounted=!0,e.requestFrame()},e.frameRequested=!1,e.requestFrame=function(){e.frameRequested||(e.frameRequested=!0,requestAnimationFrame(e.onFrame))},e._lastFrameTime=0,e._mo_touch=null,e.onFrame=function(r){if(e.frameRequested=!1,!(!e.mounted||!e.canvas||!e.context)){e.requestFrame();var n=e.canvas.clientWidth,s=e.canvas.clientHeight;(e.pixelWidth!==n||e.pixelHeight!==s)&&(e.pixelWidth=n,e.pixelHeight=s,e.drawingWidth=n*e.pixelRatio,e.drawingHeight=s*e.pixelRatio,(e.canvas.width!==e.drawingWidth||e.canvas.height!==e.drawingHeight)&&(e.canvas.width=e.drawingWidth,e.canvas.height=e.drawingHeight,console.debug&&console.debug("Resize: ["+e.drawingWidth+", "+e.drawingHeight+"] = "+e.pixelRatio+" x ["+e.pixelWidth+", "+e.pixelHeight+"]"),e.viewport({width:e.drawingWidth,height:e.drawingHeight,ratio:e.pixelRatio})));var o=e._lastFrameTime||r,a=r-o;if(!(!e.mounted||e.paused||e.sleep)){e._lastFrameTime=r,e.prerender();var h=e._tick(a,r,o);e._mo_touch!=e._ts_touch?(e._mo_touch=e._ts_touch,e.sleep=!1,e.drawingWidth>0&&e.drawingHeight>0&&(e.context.setTransform(1,0,0,1,0,0),e.context.clearRect(0,0,e.drawingWidth,e.drawingHeight),e.debugDrawAxis>0&&e.renderDebug(e.context),e.render(e.context))):h?e.sleep=!1:e.sleep=!0,stats.fps=a?1e3/a:0}}},e.debugDrawAxis=0,e.label("Root"),e}return t.prototype.renderDebug=function(e){var r=typeof this.debugDrawAxis=="number"?this.debugDrawAxis:10,n=this.matrix();e.setTransform(n.a,n.b,n.c,n.d,n.e,n.f);var s=3/n.a;e.beginPath(),e.moveTo(0,0),e.lineTo(0,.8*r),e.lineTo(-.2*r,.8*r),e.lineTo(0,r),e.lineTo(.2*r,.8*r),e.lineTo(0,.8*r),e.strokeStyle="rgba(93, 173, 226)",e.lineJoin="round",e.lineCap="round",e.lineWidth=s,e.stroke(),e.beginPath(),e.moveTo(0,0),e.lineTo(.8*r,0),e.lineTo(.8*r,-.2*r),e.lineTo(r,0),e.lineTo(.8*r,.2*r),e.lineTo(.8*r,0),e.strokeStyle="rgba(236, 112, 99)",e.lineJoin="round",e.lineCap="round",e.lineWidth=s,e.stroke()},t.prototype.resume=function(){return(this.sleep||this.paused)&&this.requestFrame(),this.paused=!1,this.sleep=!1,this.publish("resume"),this},t.prototype.pause=function(){return this.paused||this.publish("pause"),this.paused=!0,this},t.prototype.touch=function(){return(this.sleep||this.paused)&&this.requestFrame(),this.sleep=!1,i.prototype.touch.call(this)},t.prototype.unmount=function(){var e;return this.mounted=!1,(e=this.pointer)===null||e===void 0||e.unmount(),this},t.prototype.background=function(e){return this.dom&&(this.dom.style.backgroundColor=e),this},t.prototype.viewport=function(e,r,n){if(typeof e>"u")return Object.assign({},this._viewport);if(typeof e=="object"){var s=e;e=s.width,r=s.height,n=s.ratio}if(typeof e=="number"&&typeof r=="number"){this._viewport={width:e,height:r,ratio:typeof n=="number"?n:1},this.viewbox();var o=Object.assign({},this._viewport);this.visit({start:function(a){if(!a._flag("viewport"))return!0;a.publish("viewport",[o])}})}return this},t.prototype.viewbox=function(e,r,n){return typeof e=="number"&&typeof r=="number"?this._viewbox={width:e,height:r,mode:n}:typeof e=="object"&&e!==null&&(this._viewbox=__assign({},e)),this.rescale(),this},t.prototype.camera=function(e){return this._camera=e,this.rescale(),this},t.prototype.rescale=function(){var e=this._viewbox,r=this._viewport,n=this._camera;if(r&&e){var s=r.width,o=r.height,a=isValidFitMode(e.mode)?e.mode:"in-pad",h=e.width,u=e.height;this.pin({width:h,height:u}),this.fit(s,o,a);var _=e.x||0,p=e.y||0,g=(n==null?void 0:n.a)||1,m=(n==null?void 0:n.d)||1,d=(n==null?void 0:n.e)||0,l=(n==null?void 0:n.f)||0,c=this.pin("scaleX"),v=this.pin("scaleY");this.pin("scaleX",c*g),this.pin("scaleY",v*m),this.pin("offsetX",d-_*c*g),this.pin("offsetY",l-p*v*m)}else r&&this.pin({width:r.width,height:r.height});return this},t.prototype.flipX=function(e){return this._pin._directionX=e?-1:1,this},t.prototype.flipY=function(e){return this._pin._directionY=e?-1:1,this},t}(Component),FPS=15;(function(i){__extends(t,i);function t(){var e=i.call(this)||this;return e._texture=null,e._frames=[],e._time=-1,e._repeat=0,e._index=0,e._animTickLastTime=0,e._animTick=function(r,n,s){if(!(e._time<0||e._frames.length<=1)){var o=e._animTickLastTime!=s;if(e._animTickLastTime=n,o||(e._time+=r,e._time<e._ft))return!0;var a=e._time/e._ft|0;return e._time-=a*e._ft,e.moveFrame(a),e._repeat>0&&(e._repeat-=a)<=0?(e.stop(),e._callback&&e._callback(),!1):!0}},e.label("Anim"),e._fps=FPS,e._ft=1e3/e._fps,e.tick(e._animTick,!1),e}return t.prototype.renderTexture=function(e){this._texture&&this._texture.draw(e)},t.prototype.fps=function(e){return typeof e>"u"?this._fps:(this._fps=e>0?e:FPS,this._ft=1e3/this._fps,this)},t.prototype.setFrames=function(e){return this.frames(e)},t.prototype.frames=function(e){return this._index=0,this._frames=texture(e).array(),this.touch(),this},t.prototype.length=function(){return this._frames?this._frames.length:0},t.prototype.gotoFrame=function(e,r){return r===void 0&&(r=!1),this._index=math.wrap(e,this._frames.length)|0,r=r||!this._texture,this._texture=this._frames[this._index],r&&(this.pin("width",this._texture.getWidth()),this.pin("height",this._texture.getHeight())),this.touch(),this},t.prototype.moveFrame=function(e){return this.gotoFrame(this._index+e)},t.prototype.repeat=function(e,r){return this._repeat=e*this._frames.length-1,this._callback=r,this.play(),this},t.prototype.play=function(e){return typeof e<"u"?(this.gotoFrame(e),this._time=0):this._time<0&&(this._time=0),this.touch(),this},t.prototype.stop=function(e){return this._time=-1,typeof e<"u"&&this.gotoFrame(e),this},t})(Component);function monotype(i){return new Monotype().frames(i)}var Monotype=function(i){__extends(t,i);function t(){var e=i.call(this)||this;return e._textures=[],e.label("Monotype"),e}return t.prototype.renderTexture=function(e){if(!(!this._textures||!this._textures.length))for(var r=0,n=this._textures.length;r<n;r++)this._textures[r].draw(e)},t.prototype.setFont=function(e){return this.frames(e)},t.prototype.frames=function(e){if(this._textures=[],typeof e=="string"){var r=texture(e);this._font=function(n){return r.one(n)}}else typeof e=="object"?this._font=function(n){return e[n]}:typeof e=="function"&&(this._font=e);return this},t.prototype.setValue=function(e){return this.value(e)},t.prototype.value=function(e){if(typeof e>"u")return this._value;if(this._value===e)return this;this._value=e,e===null?e="":typeof e!="string"&&!Array.isArray(e)&&(e=e.toString()),this._spacing=this._spacing||0;for(var r=0,n=0,s=0;s<e.length;s++){var o=e[s],a=this._textures[s]=this._font(typeof o=="string"?o:o+"");r+=s>0?this._spacing:0,a.setDestinationCoordinate(r,0),r=r+a.getWidth(),n=Math.max(n,a.getHeight())}return this.pin("width",r),this.pin("height",n),this._textures.length=e.length,this},t}(Component);const WIDTH=4,HEIGHT=4,NEXT_TILE_TIME=1e3,ANIMATE_COLLECT_TIME=600,COLORS=["blue","red","yellow","green","purple"];class TileSprite extends Sprite{constructor(t){super(),this.__memo=Memo.init(),this.__size=t,this.pin({handle:.5})}enter(t){this.__memo.update(t.i,t.j),this.offset(t.i*this.__size,t.j*this.__size),this.scale(.1,.1),this.tween(100).scale(1,1)}slide(t){this.__memo.update(t.i,t.j)&&this.tween(100).offset(t.i*this.__size,t.j*this.__size).scale(1,1)}exit(t,e=!1){if(e){const r=ANIMATE_COLLECT_TIME/6;this.tween(r).offset(t.i*this.__size,t.j*this.__size).scale(1,1).tween(r).pin("alpha",0).tween(r).pin("alpha",1).tween(r).pin("alpha",0).tween(r).pin("alpha",1).tween(r).scale(.1,.1).remove()}else this.tween(100).scale(.1,.1).remove()}}const urlAlphabet="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let nanoid=(i=21)=>{let t="",e=crypto.getRandomValues(new Uint8Array(i|=0));for(;i--;)t+=urlAlphabet[e[i]&63];return t};const randomColor=()=>COLORS[Math.floor(Math.random()*5)];class Cell{constructor(t,e){this.key="cell="+nanoid(8),this.type="cell",this.position={i:0,j:0},this.position.i=t,this.position.j=e}}class Tile{constructor(t,e){this.key="tile="+nanoid(8),this.type="tile",this.position={i:0,j:0},this.position.i=t.i,this.position.j=t.j,this.color=e}}class Board{constructor(){this.tiles=[],this.cells=[],this.cellMap={}}}const createBoard=(i,t)=>{const e=new Board;for(let r=0;r<i;r++)for(let n=0;n<t;n++){const s=new Cell(r,n);addCell(e,s)}return e},clearTiles=i=>{for(let t=i.tiles.length-1;t>=0;t--)removeTile(i,i.tiles[t])},slideBoard=(i,t)=>{let e=!1,r=!0;for(;r;){r=!1;for(let n=0;n<i.tiles.length;n++){const s=i.tiles[n];r=moveTile(i,s,t)||r}e=r||e}return e},collectBoard=i=>{const t=[],e=[],r=+new Date;t.length=0;for(let n=0;n<i.tiles.length;n++)e.length=0,matchTile(i,i.tiles[n],r,e),e.length>2&&t.push(...e);return t},matchBoard=(i,t)=>{const e=collectBoard(i);let r=0;for(let n=0;n<e.length;n++){const s=e[n];s.animateExit=t,removeTile(i,s)&&r++}return r},getTile=(i,t,e)=>{const r=getCell(i,t,e);return r?r.tile:void 0},getCell=(i,t,e)=>{const r=t+":"+e;return i.cellMap[r]},addCell=(i,t)=>{const e=t.position.i+":"+t.position.j;return i.cellMap[e]?!1:(i.cellMap[e]=t,i.cells.push(t),!0)},randomEmptyCell=i=>{const t=[];for(let e=i.cells.length-1;e>=0;e--){const r=i.cells[e];!r.tile&&t.push(r)}return t.length?t[Math.random()*t.length|0]:null},insertTile=(i,t)=>{const e=getCell(i,t.position.i,t.position.j);return e?(placeTile(i,t,e),i.tiles.push(t),!0):!1},moveTile=(i,t,e)=>{const r=getCell(i,t.position.i+e.i,t.position.j+e.j);return!r||r.tile?!1:(placeTile(i,t,r),!0)},placeTile=(i,t,e)=>{t.cell&&(t.cell.tile=null,t.cell=null),e.tile=t,t.cell=e,t.position.i=e.position.i,t.position.j=e.position.j},removeTile=(i,t)=>{const e=t.cell;if(!e)return!1;e.tile=null,t.cell=null;const r=i.tiles.indexOf(t);return r>=0?(i.tiles.splice(r,1),!0):!1},matchTile=(i,t,e,r,n)=>{if(!t||t._search==e)return!1;if(typeof n>"u")n=t.color;else if(n!==t.color)return!1;t._search=e,r.push(t),matchTile(i,getTile(i,t.position.i,t.position.j-1),e,r,n),matchTile(i,getTile(i,t.position.i,t.position.j+1),e,r,n),matchTile(i,getTile(i,t.position.i-1,t.position.j),e,r,n),matchTile(i,getTile(i,t.position.i+1,t.position.j),e,r,n)},isGameover=i=>i.cells.length<=i.tiles.length,currentScorePin={alignX:.05,alignY:0,handleX:0,handleY:1,offsetY:-14,alpha:1},maxScorePin={alignX:.95,alignY:0,handleX:1,handleY:1,offsetY:-14,alpha:.3};class Terminal extends Middleware{constructor(){super(),this.size=32,this.lastMaxScore=-1,this.mouseX=0,this.mouseY=0,this.mouseStarted=!1,this.handleViewport=t=>{const e=this.context.stage,r=t.width,n=t.height,s=t.ratio;e.viewbox(Math.max(r/s/2,200),Math.max(n/s/2,250))},this.handleActivate=()=>{const t=this.context.stage;t.on("viewport",this.handleViewport),this.handleViewport(t.viewport()),this.board=component(),this.board.appendTo(t),this.board.pin({width:WIDTH*this.size,height:HEIGHT*this.size,align:.5,handleY:.2,handleX:.5}),this.tiles=component(),this.tiles.appendTo(this.board),this.tiles.offset(this.size/2,this.size/2),this.header=component(),this.header.appendTo(this.board),this.header.pin({width:WIDTH*this.size}),this.logo=sprite("logo"),this.logo.appendTo(this.header),this.logo.pin({offsetX:1,offsetY:-80,scale:1.05}),this.arrow=sprite("arrow"),this.arrow.appendTo(this.board),this.arrow.pin({alignX:.5,alignY:1.15,handleX:.5,handleY:.5}),this.arrow.hide(),this.currentScore=monotype("digit"),this.currentScore.appendTo(this.board),this.currentScore.pin(currentScorePin),this.maxScore=monotype("digit"),this.maxScore.appendTo(this.board),this.maxScore.pin(maxScorePin),this.board.on(POINTER_CLICK,()=>{this.context.gameover&&this.emit("user-start")}),t.on(POINTER_DOWN,this.handleMouseStart),t.on(POINTER_MOVE,this.handleMouseMove),t.on(POINTER_UP,this.handleMouseEnd),window.addEventListener("keydown",this.handleKeyDown),this.context.maxScore?this.maxScore.value(this.context.maxScore+"S"):this.maxScore.value("S")},this.handleStart=()=>{this.header.tween({duration:1e3}).pin("alpha",.4),this.lastMaxScore>-1&&this.context.maxScore>this.lastMaxScore&&(this.maxScore.tween(200).alpha(0).remove(),this.maxScore=this.currentScore,this.maxScore.value(this.context.maxScore+"S"),this.maxScore.tween().pin(maxScorePin),this.currentScore=monotype("digit"),this.currentScore.appendTo(this.board),this.currentScore.pin(currentScorePin),this.currentScore.value("0").pin(currentScorePin)),this.lastMaxScore=this.context.maxScore||0},this.handleGameover=()=>{this.header.tween({duration:2e3}).pin("alpha",1),this.context.score>=this.context.maxScore&&(this.currentScore.value(this.context.score+"S"),this.maxScore.value(this.lastMaxScore+"s"))},this.handleFrameRender=()=>{this.context.gameover||(this.currentScore.value(this.context.score),this.binder.data([...this.context.board.cells,...this.context.board.tiles]))},this.cellDriver=Driver.create({filter:t=>t.type==="cell",enter:t=>{const e=new TileSprite(this.size);return e.texture("cell"),e.appendTo(this.tiles),e.enter(t.position),e},exit:(t,e)=>{e.exit(t.position)},update:(t,e)=>{}}),this.tileDriver=Driver.create({filter:t=>t.type==="tile",enter:t=>{const e=new TileSprite(this.size);return e.texture(t.color||""),e.appendTo(this.tiles),e.enter(t.position),e},exit:(t,e)=>{e.exit(t.position,t.animateExit)},update:(t,e)=>{e.slide(t.position)}}),this.binder=Binder.create({key:t=>t.key}).addDriver(this.cellDriver).addDriver(this.tileDriver),this.handleInstruct=t=>{if(!t){this.arrow.hide().tween();return}const e=t.i,r=t.j;this.arrow.show(),this.arrow.rotate(Math.atan2(r,e)),this.arrow.offset(-5*e,-5*r),this.arrow.tween({duration:500}).offset(5*e,5*r).tween({duration:200}).offset(-5*e,-5*r).done(()=>this.handleInstruct(t))},this.handleMouseStart=t=>{this.context.gameover||(this.mouseX=t.x,this.mouseY=t.y,this.mouseStarted=!0)},this.handleMouseMove=t=>{if(!this.mouseStarted)return;const e=t.x-this.mouseX,r=t.y-this.mouseY,n=Math.abs(e),s=Math.abs(r);n>s&&n>this.size/3?(this.emit("user-slide",{i:e>0?1:-1,j:0}),this.mouseStarted=!1):s>n&&s>this.size/3&&(this.emit("user-slide",{i:0,j:r>0?1:-1}),this.mouseStarted=!1)},this.handleMouseEnd=t=>{this.handleMouseMove(t),this.mouseStarted=!1},this.handleKeyDown=t=>{const e=t.keyCode;if(this.context.gameover){if(e==13||e==32)return this.emit("user-start"),!1}else{const r=(e==39?1:0)-(e==37?1:0),n=(e==40?1:0)-(e==38?1:0);if(r||n)return this.emit("user-slide",{i:r,j:n}),!1}},this.on("stage-ready",this.handleActivate),this.on("game-over",this.handleGameover),this.on("game-start",this.handleStart),this.on("frame-render",this.handleFrameRender)}}class TimelineManager extends Middleware{constructor(){super(),this.handleFrameUpdate=({dt:t})=>{var r,n,s,o;if(!((r=this.context.timeline)!=null&&r.length))return;const e=this.context.timeline[0];typeof e.timeout!="number"&&(e.timeout=e.start(),(typeof e.timeout!="number"||e.timeout<0)&&(this.context.timeline.shift(),logTimeline(this.context),e.timeout===0&&((n=e.finish)==null||n.call(e)))),(s=e.update)==null||s.call(e,t),e.timeout-=t,e.timeout<=0&&(this.context.timeline.shift(),logTimeline(this.context),(o=e.finish)==null||o.call(e))},this.on("frame-update",this.handleFrameUpdate)}}const clearTimeline=i=>{var e;let t;for(;t=i.timeline.pop();)(e=t.cancel)==null||e.call(t)},queueEvent=(i,t)=>{i.timeline.push(t)};performance.now();const logTimeline=(i,t)=>{};class Gameplay extends Middleware{constructor(){super(),this.handleActivate=()=>{const t=createBoard(WIDTH,HEIGHT);this.setContext(e=>{e.board=t})},this.startGame=()=>{this.context.gameover=!1,this.context.score=0,this.context.inserted=0,clearTiles(this.context.board),clearTimeline(this.context),queueEvent(this.context,{name:"start-game",start:()=>0,finish:()=>{this.emit("game-start"),this.awaitUserMove()}})},this.awaitUserMove=()=>{this.context.gameover||queueEvent(this.context,{name:"await-user",start:()=>Math.max(NEXT_TILE_TIME-this.context.inserted,200),finish:()=>{this.addNewTile()}})},this.checkGameover=()=>{this.context.gameover||!isGameover(this.context.board)||(this.context.gameover=!0,clearTimeline(this.context),(!this.context.maxScore||this.context.maxScore<this.context.score)&&(this.context.maxScore=this.context.score),this.emit("game-over"))},this.addNewTile=()=>{queueEvent(this.context,{name:"new-tile",start:()=>{if(this.context.gameover)return;let t;const e=randomEmptyCell(this.context.board);if(e)return t=new Tile(e.position,randomColor()),insertTile(this.context.board,t),this.context.inserted+=1,100},finish:()=>{this.collectTiles(),this.checkGameover(),!this.context.gameover&&this.awaitUserMove()}})},this.handleUserSlide=t=>{var r;((r=this.context.timeline[0])==null?void 0:r.name)!=="await-user"||!slideBoard(this.context.board,t)||(clearTimeline(this.context),queueEvent(this.context,{name:"slide-board",start:()=>100,finish:()=>{this.collectTiles(),this.addNewTile()}}))},this.collectTiles=()=>{queueEvent(this.context,{name:"collect-tiles",start:()=>{const t=this.context.score<12,e=matchBoard(this.context.board,t);if(e)return this.context.score+=e,t?ANIMATE_COLLECT_TIME:0},finish:()=>{this.context.board.tiles.length||(clearTimeline(this.context),this.addNewTile())}})},this.on("activate",this.handleActivate),this.on("user-start",this.startGame),this.on("main-start",this.startGame),this.on("user-slide",this.handleUserSlide)}}const textImage="/polymatic-example-tilebox/assets/text-Bxoditdu.png",logoImage="/polymatic-example-tilebox/assets/logo-DjOb43rg.png",tileImage="/polymatic-example-tilebox/assets/tile-CnzgYii_.png";class Loader extends Middleware{constructor(){super(),this.handleActivate=async()=>{await atlas({image:{src:tileImage,ratio:4},ppu:32,textures:{"":{x:0,y:0,width:1,height:1},blue:{x:1,y:0,width:1,height:1},red:{x:2,y:0,width:1,height:1},yellow:{x:3,y:0,width:1,height:1},green:{x:4,y:0,width:1,height:1},purple:{x:5,y:0,width:1,height:1},orange:{x:6,y:0,width:1,height:1},cell:{x:7,y:0,width:1,height:1}}}),await atlas({image:{src:textImage,ratio:4},ppu:16,textures:{digit:{0:{x:0,y:0,width:.775,height:1},1:{x:1,y:0,width:.34375,height:1},2:{x:2,y:0,width:.65625,height:1},3:{x:3,y:0,width:.61875,height:1},4:{x:4,y:0,width:.71875,height:1},5:{x:5,y:0,width:.575,height:1},6:{x:6,y:0,width:.7,height:1},7:{x:7,y:0,width:.6375,height:1},8:{x:8,y:0,width:.65625,height:1},9:{x:9,y:0,width:.7,height:1},"-":{x:10,y:0,width:.49375,height:1},"+":{x:11,y:0,width:.7,height:1},"=":{x:12,y:0,width:.4125,height:1},s:{x:12.8125,y:0,width:1.125,height:1},S:{x:13.8125,y:0,width:1.125,height:1},o:{x:14,y:1,width:1,height:1},O:{x:15,y:1,width:1,height:1}}}}),await atlas({image:{src:logoImage,ratio:4},textures:{logo:{x:0,y:0,width:120,height:40}}}),this.context.stage=mount(),this.emit("stage-ready")},this.on("activate",this.handleActivate)}}var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var util,hasRequiredUtil;function requireUtil(){if(hasRequiredUtil)return util;hasRequiredUtil=1;var i=n(),t=s(),e=o(),r=typeof window<"u"?window:commonjsGlobal;util={assign:i,create:t,trim:e,bind:a,slice:h,each:u,map:_,pluck:p,isList:g,isFunction:m,isObject:d,Global:r};function n(){return Object.assign?Object.assign:function(c,v,x,w){for(var y=1;y<arguments.length;y++)u(Object(arguments[y]),function(b,S){c[S]=b});return c}}function s(){if(Object.create)return function(v,x,w,y){var b=h(arguments,1);return i.apply(this,[Object.create(v)].concat(b))};{let c=function(){};var l=c;return function(x,w,y,b){var S=h(arguments,1);return c.prototype=x,i.apply(this,[new c].concat(S))}}}function o(){return String.prototype.trim?function(c){return String.prototype.trim.call(c)}:function(c){return c.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}}function a(l,c){return function(){return c.apply(l,Array.prototype.slice.call(arguments,0))}}function h(l,c){return Array.prototype.slice.call(l,c||0)}function u(l,c){p(l,function(v,x){return c(v,x),!1})}function _(l,c){var v=g(l)?[]:{};return p(l,function(x,w){return v[w]=c(x,w),!1}),v}function p(l,c){if(g(l)){for(var v=0;v<l.length;v++)if(c(l[v],v))return l[v]}else for(var x in l)if(l.hasOwnProperty(x)&&c(l[x],x))return l[x]}function g(l){return l!=null&&typeof l!="function"&&typeof l.length=="number"}function m(l){return l&&{}.toString.call(l)==="[object Function]"}function d(l){return l&&{}.toString.call(l)==="[object Object]"}return util}var storeEngine,hasRequiredStoreEngine;function requireStoreEngine(){if(hasRequiredStoreEngine)return storeEngine;hasRequiredStoreEngine=1;var i=requireUtil(),t=i.slice,e=i.pluck,r=i.each,n=i.bind,s=i.create,o=i.isList,a=i.isFunction,h=i.isObject;storeEngine={createStore:p};var u={version:"2.0.12",enabled:!1,get:function(g,m){var d=this.storage.read(this._namespacePrefix+g);return this._deserialize(d,m)},set:function(g,m){return m===void 0?this.remove(g):(this.storage.write(this._namespacePrefix+g,this._serialize(m)),m)},remove:function(g){this.storage.remove(this._namespacePrefix+g)},each:function(g){var m=this;this.storage.each(function(d,l){g.call(m,m._deserialize(d),(l||"").replace(m._namespaceRegexp,""))})},clearAll:function(){this.storage.clearAll()},hasNamespace:function(g){return this._namespacePrefix=="__storejs_"+g+"_"},createStore:function(){return p.apply(this,arguments)},addPlugin:function(g){this._addPlugin(g)},namespace:function(g){return p(this.storage,this.plugins,g)}};function _(){var g=typeof console>"u"?null:console;if(g){var m=g.warn?g.warn:g.log;m.apply(g,arguments)}}function p(g,m,d){d||(d=""),g&&!o(g)&&(g=[g]),m&&!o(m)&&(m=[m]);var l=d?"__storejs_"+d+"_":"",c=d?new RegExp("^"+l):null,v=/^[a-zA-Z0-9_\-]*$/;if(!v.test(d))throw new Error("store.js namespaces can only have alphanumerics + underscores and dashes");var x={_namespacePrefix:l,_namespaceRegexp:c,_testStorage:function(y){try{var b="__storejs__test__";y.write(b,b);var S=y.read(b)===b;return y.remove(b),S}catch{return!1}},_assignPluginFnProp:function(y,b){var S=this[b];this[b]=function(){var T=t(arguments,0),E=this;function A(){if(S)return r(arguments,function(O,P){T[P]=O}),S.apply(E,T)}var R=[A].concat(T);return y.apply(E,R)}},_serialize:function(y){return JSON.stringify(y)},_deserialize:function(y,b){if(!y)return b;var S="";try{S=JSON.parse(y)}catch{S=y}return S!==void 0?S:b},_addStorage:function(y){this.enabled||this._testStorage(y)&&(this.storage=y,this.enabled=!0)},_addPlugin:function(y){var b=this;if(o(y)){r(y,function(T){b._addPlugin(T)});return}var S=e(this.plugins,function(T){return y===T});if(!S){if(this.plugins.push(y),!a(y))throw new Error("Plugins must be function values that return objects");var M=y.call(this);if(!h(M))throw new Error("Plugins must return an object of function properties");r(M,function(T,E){if(!a(T))throw new Error("Bad plugin property: "+E+" from plugin "+y.name+". Plugins should only return functions.");b._assignPluginFnProp(T,E)})}},addStorage:function(y){_("store.addStorage(storage) is deprecated. Use createStore([storages])"),this._addStorage(y)}},w=s(x,u,{plugins:[]});return w.raw={},r(w,function(y,b){a(y)&&(w.raw[b]=n(w,y))}),r(g,function(y){w._addStorage(y)}),r(m,function(y){w._addPlugin(y)}),w}return storeEngine}var localStorage_1,hasRequiredLocalStorage;function requireLocalStorage(){if(hasRequiredLocalStorage)return localStorage_1;hasRequiredLocalStorage=1;var i=requireUtil(),t=i.Global;localStorage_1={name:"localStorage",read:r,write:n,each:s,remove:o,clearAll:a};function e(){return t.localStorage}function r(h){return e().getItem(h)}function n(h,u){return e().setItem(h,u)}function s(h){for(var u=e().length-1;u>=0;u--){var _=e().key(u);h(r(_),_)}}function o(h){return e().removeItem(h)}function a(){return e().clear()}return localStorage_1}var oldFFGlobalStorage,hasRequiredOldFFGlobalStorage;function requireOldFFGlobalStorage(){if(hasRequiredOldFFGlobalStorage)return oldFFGlobalStorage;hasRequiredOldFFGlobalStorage=1;var i=requireUtil(),t=i.Global;oldFFGlobalStorage={name:"oldFF-globalStorage",read:r,write:n,each:s,remove:o,clearAll:a};var e=t.globalStorage;function r(h){return e[h]}function n(h,u){e[h]=u}function s(h){for(var u=e.length-1;u>=0;u--){var _=e.key(u);h(e[_],_)}}function o(h){return e.removeItem(h)}function a(){s(function(h,u){delete e[h]})}return oldFFGlobalStorage}var oldIEUserDataStorage,hasRequiredOldIEUserDataStorage;function requireOldIEUserDataStorage(){if(hasRequiredOldIEUserDataStorage)return oldIEUserDataStorage;hasRequiredOldIEUserDataStorage=1;var i=requireUtil(),t=i.Global;oldIEUserDataStorage={name:"oldIE-userDataStorage",write:o,read:a,each:h,remove:u,clearAll:_};var e="storejs",r=t.document,n=m(),s=(t.navigator?t.navigator.userAgent:"").match(/ (MSIE 8|MSIE 9|MSIE 10)\./);function o(d,l){if(!s){var c=g(d);n(function(v){v.setAttribute(c,l),v.save(e)})}}function a(d){if(!s){var l=g(d),c=null;return n(function(v){c=v.getAttribute(l)}),c}}function h(d){n(function(l){for(var c=l.XMLDocument.documentElement.attributes,v=c.length-1;v>=0;v--){var x=c[v];d(l.getAttribute(x.name),x.name)}})}function u(d){var l=g(d);n(function(c){c.removeAttribute(l),c.save(e)})}function _(){n(function(d){var l=d.XMLDocument.documentElement.attributes;d.load(e);for(var c=l.length-1;c>=0;c--)d.removeAttribute(l[c].name);d.save(e)})}var p=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");function g(d){return d.replace(/^\d/,"___$&").replace(p,"___")}function m(){if(!r||!r.documentElement||!r.documentElement.addBehavior)return null;var d="script",l,c,v;try{c=new ActiveXObject("htmlfile"),c.open(),c.write("<"+d+">document.w=window</"+d+'><iframe src="/favicon.ico"></iframe>'),c.close(),l=c.w.frames[0].document,v=l.createElement("div")}catch{v=r.createElement("div"),l=r.body}return function(x){var w=[].slice.call(arguments,0);w.unshift(v),l.appendChild(v),v.addBehavior("#default#userData"),v.load(e),x.apply(this,w),l.removeChild(v)}}return oldIEUserDataStorage}var cookieStorage,hasRequiredCookieStorage;function requireCookieStorage(){if(hasRequiredCookieStorage)return cookieStorage;hasRequiredCookieStorage=1;var i=requireUtil(),t=i.Global,e=i.trim;cookieStorage={name:"cookieStorage",read:n,write:o,each:s,remove:a,clearAll:h};var r=t.document;function n(_){if(!_||!u(_))return null;var p="(?:^|.*;\\s*)"+escape(_).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*";return unescape(r.cookie.replace(new RegExp(p),"$1"))}function s(_){for(var p=r.cookie.split(/; ?/g),g=p.length-1;g>=0;g--)if(e(p[g])){var m=p[g].split("="),d=unescape(m[0]),l=unescape(m[1]);_(l,d)}}function o(_,p){_&&(r.cookie=escape(_)+"="+escape(p)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/")}function a(_){!_||!u(_)||(r.cookie=escape(_)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/")}function h(){s(function(_,p){a(p)})}function u(_){return new RegExp("(?:^|;\\s*)"+escape(_).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(r.cookie)}return cookieStorage}var sessionStorage_1,hasRequiredSessionStorage;function requireSessionStorage(){if(hasRequiredSessionStorage)return sessionStorage_1;hasRequiredSessionStorage=1;var i=requireUtil(),t=i.Global;sessionStorage_1={name:"sessionStorage",read:r,write:n,each:s,remove:o,clearAll:a};function e(){return t.sessionStorage}function r(h){return e().getItem(h)}function n(h,u){return e().setItem(h,u)}function s(h){for(var u=e().length-1;u>=0;u--){var _=e().key(u);h(r(_),_)}}function o(h){return e().removeItem(h)}function a(){return e().clear()}return sessionStorage_1}var memoryStorage_1,hasRequiredMemoryStorage;function requireMemoryStorage(){if(hasRequiredMemoryStorage)return memoryStorage_1;hasRequiredMemoryStorage=1,memoryStorage_1={name:"memoryStorage",read:t,write:e,each:r,remove:n,clearAll:s};var i={};function t(o){return i[o]}function e(o,a){i[o]=a}function r(o){for(var a in i)i.hasOwnProperty(a)&&o(i[a],a)}function n(o){delete i[o]}function s(o){i={}}return memoryStorage_1}var all,hasRequiredAll;function requireAll(){return hasRequiredAll||(hasRequiredAll=1,all=[requireLocalStorage(),requireOldFFGlobalStorage(),requireOldIEUserDataStorage(),requireCookieStorage(),requireSessionStorage(),requireMemoryStorage()]),all}var json2$1={},hasRequiredJson2$1;function requireJson2$1(){return hasRequiredJson2$1||(hasRequiredJson2$1=1,typeof JSON!="object"&&(JSON={}),function(){var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;function f(i){return i<10?"0"+i:i}function this_value(){return this.valueOf()}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=this_value,Number.prototype.toJSON=this_value,String.prototype.toJSON=this_value);var gap,indent,meta,rep;function quote(i){return rx_escapable.lastIndex=0,rx_escapable.test(i)?'"'+i.replace(rx_escapable,function(t){var e=meta[t];return typeof e=="string"?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+i+'"'}function str(i,t){var e,r,n,s,o=gap,a,h=t[i];switch(h&&typeof h=="object"&&typeof h.toJSON=="function"&&(h=h.toJSON(i)),typeof rep=="function"&&(h=rep.call(t,i,h)),typeof h){case"string":return quote(h);case"number":return isFinite(h)?String(h):"null";case"boolean":case"null":return String(h);case"object":if(!h)return"null";if(gap+=indent,a=[],Object.prototype.toString.apply(h)==="[object Array]"){for(s=h.length,e=0;e<s;e+=1)a[e]=str(e,h)||"null";return n=a.length===0?"[]":gap?`[
`+gap+a.join(`,
`+gap)+`
`+o+"]":"["+a.join(",")+"]",gap=o,n}if(rep&&typeof rep=="object")for(s=rep.length,e=0;e<s;e+=1)typeof rep[e]=="string"&&(r=rep[e],n=str(r,h),n&&a.push(quote(r)+(gap?": ":":")+n));else for(r in h)Object.prototype.hasOwnProperty.call(h,r)&&(n=str(r,h),n&&a.push(quote(r)+(gap?": ":":")+n));return n=a.length===0?"{}":gap?`{
`+gap+a.join(`,
`+gap)+`
`+o+"}":"{"+a.join(",")+"}",gap=o,n}}typeof JSON.stringify!="function"&&(meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(i,t,e){var r;if(gap="",indent="",typeof e=="number")for(r=0;r<e;r+=1)indent+=" ";else typeof e=="string"&&(indent=e);if(rep=t,t&&typeof t!="function"&&(typeof t!="object"||typeof t.length!="number"))throw new Error("JSON.stringify");return str("",{"":i})}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){var j;function walk(i,t){var e,r,n=i[t];if(n&&typeof n=="object")for(e in n)Object.prototype.hasOwnProperty.call(n,e)&&(r=walk(n,e),r!==void 0?n[e]=r:delete n[e]);return reviver.call(i,t,n)}if(text=String(text),rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(i){return"\\u"+("0000"+i.charCodeAt(0).toString(16)).slice(-4)})),rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}()),json2$1}var json2,hasRequiredJson2;function requireJson2(){if(hasRequiredJson2)return json2;hasRequiredJson2=1,json2=i;function i(){return requireJson2$1(),{}}return json2}var store_legacy,hasRequiredStore_legacy;function requireStore_legacy(){if(hasRequiredStore_legacy)return store_legacy;hasRequiredStore_legacy=1;var i=requireStoreEngine(),t=requireAll(),e=[requireJson2()];return store_legacy=i.createStore(t,e),store_legacy}var store_legacyExports=requireStore_legacy();const store=getDefaultExportFromCjs(store_legacyExports),KEY="tilebox-v1-max";class DataStore extends Middleware{constructor(){super(),this.handleActivate=()=>{const t=store.get(KEY);t>0&&(this.context.maxScore=t)},this.handleGameover=()=>{store.set(KEY,this.context.maxScore)},this.on("activate",this.handleActivate),this.on("game-over",this.handleGameover)}}class FrameLoop extends Middleware{constructor(){super(),this.lastTime=0,this.event={dt:0,now:0},this.handleFrame=()=>{if(!this.activated)return;const t=performance.now(),e=t-this.lastTime;this.lastTime=t,this.event.now=t,this.event.dt=e,this.emit("frame-update",this.event),this.emit("frame-render",this.event),this.requestFrame()},this.requestFrame=()=>{this.activated&&window.requestAnimationFrame(this.handleFrame)},this.on("activate",this.handleActivate),this.on("deactivate",this.handleDeactivate)}handleActivate(){this.lastTime=performance.now(),this.requestFrame()}handleDeactivate(){}}class MainContext{constructor(){this.score=0,this.inserted=0,this.gameover=!1,this.maxScore=0,this.timeline=[]}}class Main extends Middleware{constructor(){super(),this.handleStageReady=()=>{this.use(new Terminal),this.use(new Gameplay),this.emit("main-start")},this.use(new Loader),this.use(new FrameLoop),this.use(new TimelineManager),this.use(new DataStore),this.on("stage-ready",this.handleStageReady)}}Middleware.activate(new Main,new MainContext);
